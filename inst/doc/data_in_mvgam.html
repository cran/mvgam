<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Nicholas J Clark" />

<meta name="date" content="2024-05-09" />

<title>Formatting data for use in mvgam</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Formatting data for use in mvgam</h1>
<h4 class="author">Nicholas J Clark</h4>
<h4 class="date">2024-05-09</h4>


<div id="TOC">
<ul>
<li><a href="#required-long-data-format" id="toc-required-long-data-format">Required <em>long</em> data
format</a>
<ul>
<li><a href="#series-as-a-factor-variable" id="toc-series-as-a-factor-variable"><code>series</code> as a
<code>factor</code> variable</a></li>
<li><a href="#a-single-outcome-variable" id="toc-a-single-outcome-variable">A single outcome variable</a></li>
<li><a href="#a-time-variable" id="toc-a-time-variable">A
<code>time</code> variable</a></li>
<li><a href="#irregular-sampling-intervals" id="toc-irregular-sampling-intervals">Irregular sampling
intervals?</a></li>
</ul></li>
<li><a href="#checking-data-with-get_mvgam_priors" id="toc-checking-data-with-get_mvgam_priors">Checking data with
<code>get_mvgam_priors</code></a>
<ul>
<li><a href="#covariates-with-no-nas" id="toc-covariates-with-no-nas">Covariates with no
<code>NA</code>s</a></li>
</ul></li>
<li><a href="#plotting-with-plot_mvgam_series" id="toc-plotting-with-plot_mvgam_series">Plotting with
<code>plot_mvgam_series</code></a></li>
<li><a href="#example-with-neon-tick-data" id="toc-example-with-neon-tick-data">Example with NEON tick
data</a></li>
<li><a href="#interested-in-contributing" id="toc-interested-in-contributing">Interested in contributing?</a></li>
</ul>
</div>

<p>This vignette gives an example of how to take raw data and format it
for use in <code>mvgam</code>. This is not an exhaustive example, as
data can be recorded and stored in a variety of ways, which requires
different approaches to wrangle the data into the necessary format for
<code>mvgam</code>. For full details on the basic <code>mvgam</code>
functionality, please see <a href="https://nicholasjclark.github.io/mvgam/articles/mvgam_overview.html">the
introductory vignette</a>.</p>
<div id="required-long-data-format" class="section level2">
<h2>Required <em>long</em> data format</h2>
<p>Manipulating the data into a ‘long’ format is necessary for modelling
in <code>mvgam</code>. By ‘long’ format, we mean that each
<code>series x time</code> observation needs to have its own entry in
the <code>dataframe</code> or <code>list</code> object that we wish to
use as data for modelling. A simple example can be viewed by simulating
data using the <code>sim_mvgam</code> function. See
<code>?sim_mvgam</code> for more details</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>simdat <span class="ot">&lt;-</span> <span class="fu">sim_mvgam</span>(<span class="at">n_series =</span> <span class="dv">4</span>, <span class="at">T =</span> <span class="dv">24</span>, <span class="at">prop_missing =</span> <span class="fl">0.2</span>)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">head</span>(simdat<span class="sc">$</span>data_train, <span class="dv">16</span>)</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="co">#&gt;     y season year   series time</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="co">#&gt; 1   1      1    1 series_1    1</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="co">#&gt; 2   2      1    1 series_2    1</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="co">#&gt; 3   2      1    1 series_3    1</span></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="co">#&gt; 4   1      1    1 series_4    1</span></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="co">#&gt; 5  NA      2    1 series_1    2</span></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a><span class="co">#&gt; 6   0      2    1 series_2    2</span></span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a><span class="co">#&gt; 7  NA      2    1 series_3    2</span></span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a><span class="co">#&gt; 8   0      2    1 series_4    2</span></span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a><span class="co">#&gt; 9   0      3    1 series_1    3</span></span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a><span class="co">#&gt; 10  2      3    1 series_2    3</span></span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a><span class="co">#&gt; 11  0      3    1 series_3    3</span></span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a><span class="co">#&gt; 12  1      3    1 series_4    3</span></span>
<span id="cb1-16"><a href="#cb1-16" tabindex="-1"></a><span class="co">#&gt; 13 NA      4    1 series_1    4</span></span>
<span id="cb1-17"><a href="#cb1-17" tabindex="-1"></a><span class="co">#&gt; 14 NA      4    1 series_2    4</span></span>
<span id="cb1-18"><a href="#cb1-18" tabindex="-1"></a><span class="co">#&gt; 15  1      4    1 series_3    4</span></span>
<span id="cb1-19"><a href="#cb1-19" tabindex="-1"></a><span class="co">#&gt; 16  2      4    1 series_4    4</span></span></code></pre></div>
<div id="series-as-a-factor-variable" class="section level3">
<h3><code>series</code> as a <code>factor</code> variable</h3>
<p>Notice how we have four different time series in these simulated
data, and we have identified the series-level indicator as a
<code>factor</code> variable.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="fu">class</span>(simdat<span class="sc">$</span>data_train<span class="sc">$</span>series)</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="co">#&gt; [1] &quot;factor&quot;</span></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="fu">levels</span>(simdat<span class="sc">$</span>data_train<span class="sc">$</span>series)</span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="co">#&gt; [1] &quot;series_1&quot; &quot;series_2&quot; &quot;series_3&quot; &quot;series_4&quot;</span></span></code></pre></div>
<p>It is important that the number of levels matches the number of
unique series in the data to ensure indexing across series works
properly in the underlying modelling functions. Several of the main
workhorse functions in the package (including <code>mvgam()</code> and
<code>get_mvgam_priors()</code>) will give an error if this is not the
case, but it may be worth checking anyway:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="fu">all</span>(<span class="fu">levels</span>(simdat<span class="sc">$</span>data_train<span class="sc">$</span>series) <span class="sc">%in%</span> <span class="fu">unique</span>(simdat<span class="sc">$</span>data_train<span class="sc">$</span>series))</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>Note that you can technically supply data that does not have a
<code>series</code> indicator, and the package will assume that you are
only using a single time series. But again, it is better to have this
included so there is no confusion.</p>
</div>
<div id="a-single-outcome-variable" class="section level3">
<h3>A single outcome variable</h3>
<p>You may also have notices that we do not spread the
<code>numeric / integer</code>-classed outcome variable into different
columns. Rather, there is only a single column for the outcome variable,
labelled <code>y</code> in these simulated data (though the outcome does
not have to be labelled <code>y</code>). This is another important
requirement in <code>mvgam</code>, but it shouldn’t be too unfamiliar to
<code>R</code> users who frequently use modelling packages such as
<code>lme4</code>, <code>mgcv</code>, <code>brms</code> or the many
other regression modelling packages out there. The advantage of this
format is that it is now very easy to specify effects that vary among
time series:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">glm</span>(y <span class="sc">~</span> series <span class="sc">+</span> time,</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>            <span class="at">data =</span> simdat<span class="sc">$</span>data_train,</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>            <span class="at">family =</span> <span class="fu">poisson</span>()))</span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a><span class="co">#&gt; Call:</span></span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a><span class="co">#&gt; glm(formula = y ~ series + time, family = poisson(), data = simdat$data_train)</span></span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a><span class="co">#&gt; Coefficients:</span></span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a><span class="co">#&gt;                Estimate Std. Error z value Pr(&gt;|z|)   </span></span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a><span class="co">#&gt; (Intercept)     0.66272    0.23921   2.770   0.0056 **</span></span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a><span class="co">#&gt; seriesseries_2  0.22551    0.23720   0.951   0.3417   </span></span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a><span class="co">#&gt; seriesseries_3  0.03122    0.24810   0.126   0.8998   </span></span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a><span class="co">#&gt; seriesseries_4  0.23036    0.23745   0.970   0.3320   </span></span>
<span id="cb4-14"><a href="#cb4-14" tabindex="-1"></a><span class="co">#&gt; time            0.00939    0.01576   0.596   0.5512   </span></span>
<span id="cb4-15"><a href="#cb4-15" tabindex="-1"></a><span class="co">#&gt; ---</span></span>
<span id="cb4-16"><a href="#cb4-16" tabindex="-1"></a><span class="co">#&gt; Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></span>
<span id="cb4-17"><a href="#cb4-17" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb4-18"><a href="#cb4-18" tabindex="-1"></a><span class="co">#&gt; (Dispersion parameter for poisson family taken to be 1)</span></span>
<span id="cb4-19"><a href="#cb4-19" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb4-20"><a href="#cb4-20" tabindex="-1"></a><span class="co">#&gt;     Null deviance: 115.79  on 59  degrees of freedom</span></span>
<span id="cb4-21"><a href="#cb4-21" tabindex="-1"></a><span class="co">#&gt; Residual deviance: 113.87  on 55  degrees of freedom</span></span>
<span id="cb4-22"><a href="#cb4-22" tabindex="-1"></a><span class="co">#&gt;   (12 observations deleted due to missingness)</span></span>
<span id="cb4-23"><a href="#cb4-23" tabindex="-1"></a><span class="co">#&gt; AIC: 261.2</span></span>
<span id="cb4-24"><a href="#cb4-24" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb4-25"><a href="#cb4-25" tabindex="-1"></a><span class="co">#&gt; Number of Fisher Scoring iterations: 5</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">gam</span>(y <span class="sc">~</span> series <span class="sc">+</span> <span class="fu">s</span>(time, <span class="at">by =</span> series),</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>            <span class="at">data =</span> simdat<span class="sc">$</span>data_train,</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>            <span class="at">family =</span> <span class="fu">poisson</span>()))</span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a><span class="co">#&gt; Family: poisson </span></span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a><span class="co">#&gt; Link function: log </span></span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a><span class="co">#&gt; Formula:</span></span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a><span class="co">#&gt; y ~ series + s(time, by = series)</span></span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a><span class="co">#&gt; Parametric coefficients:</span></span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a><span class="co">#&gt;                Estimate Std. Error z value Pr(&gt;|z|)  </span></span>
<span id="cb5-13"><a href="#cb5-13" tabindex="-1"></a><span class="co">#&gt; (Intercept)      0.1701     0.3241   0.525   0.5997  </span></span>
<span id="cb5-14"><a href="#cb5-14" tabindex="-1"></a><span class="co">#&gt; seriesseries_2   0.6108     0.3783   1.615   0.1063  </span></span>
<span id="cb5-15"><a href="#cb5-15" tabindex="-1"></a><span class="co">#&gt; seriesseries_3   0.5974     0.3698   1.616   0.1062  </span></span>
<span id="cb5-16"><a href="#cb5-16" tabindex="-1"></a><span class="co">#&gt; seriesseries_4   0.6933     0.3695   1.876   0.0606 .</span></span>
<span id="cb5-17"><a href="#cb5-17" tabindex="-1"></a><span class="co">#&gt; ---</span></span>
<span id="cb5-18"><a href="#cb5-18" tabindex="-1"></a><span class="co">#&gt; Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></span>
<span id="cb5-19"><a href="#cb5-19" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-20"><a href="#cb5-20" tabindex="-1"></a><span class="co">#&gt; Approximate significance of smooth terms:</span></span>
<span id="cb5-21"><a href="#cb5-21" tabindex="-1"></a><span class="co">#&gt;                          edf Ref.df Chi.sq p-value  </span></span>
<span id="cb5-22"><a href="#cb5-22" tabindex="-1"></a><span class="co">#&gt; s(time):seriesseries_1 8.004  8.712 18.052  0.0311 *</span></span>
<span id="cb5-23"><a href="#cb5-23" tabindex="-1"></a><span class="co">#&gt; s(time):seriesseries_2 6.822  7.906 13.501  0.0919 .</span></span>
<span id="cb5-24"><a href="#cb5-24" tabindex="-1"></a><span class="co">#&gt; s(time):seriesseries_3 1.000  1.000  0.911  0.3400  </span></span>
<span id="cb5-25"><a href="#cb5-25" tabindex="-1"></a><span class="co">#&gt; s(time):seriesseries_4 3.498  4.333 12.185  0.0212 *</span></span>
<span id="cb5-26"><a href="#cb5-26" tabindex="-1"></a><span class="co">#&gt; ---</span></span>
<span id="cb5-27"><a href="#cb5-27" tabindex="-1"></a><span class="co">#&gt; Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></span>
<span id="cb5-28"><a href="#cb5-28" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-29"><a href="#cb5-29" tabindex="-1"></a><span class="co">#&gt; R-sq.(adj) =  0.323   Deviance explained = 53.4%</span></span>
<span id="cb5-30"><a href="#cb5-30" tabindex="-1"></a><span class="co">#&gt; UBRE = 0.67586  Scale est. = 1         n = 60</span></span></code></pre></div>
<p>Depending on the observation families you plan to use when building
models, there may be some restrictions that need to be satisfied within
the outcome variable. For example, a Beta regression can only handle
proportional data, so values <code>&gt;= 1</code> or
<code>&lt;= 0</code> are not allowed. Likewise, a Poisson regression can
only handle non-negative integers. Most regression functions in
<code>R</code> will assume the user knows all of this and so will not
issue any warnings or errors if you choose the wrong distribution, but
often this ends up leading to some unhelpful error from an optimizer
that is difficult to interpret and diagnose. <code>mvgam</code> will
attempt to provide some errors if you do something that is simply not
allowed. For example, we can simulate data from a zero-centred Gaussian
distribution (ensuring that some of our values will be
<code>&lt; 1</code>) and attempt a Beta regression in <code>mvgam</code>
using the <code>betar</code> family:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a>gauss_dat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">outcome =</span> <span class="fu">rnorm</span>(<span class="dv">10</span>),</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>                        <span class="at">series =</span> <span class="fu">factor</span>(<span class="st">&#39;series1&#39;</span>,</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>                                        <span class="at">levels =</span> <span class="st">&#39;series1&#39;</span>),</span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>                        <span class="at">time =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)</span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>gauss_dat</span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a><span class="co">#&gt;        outcome  series time</span></span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a><span class="co">#&gt; 1   1.47861412 series1    1</span></span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a><span class="co">#&gt; 2   0.66514221 series1    2</span></span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a><span class="co">#&gt; 3  -1.28876390 series1    3</span></span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a><span class="co">#&gt; 4  -0.66525713 series1    4</span></span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a><span class="co">#&gt; 5  -0.33403782 series1    5</span></span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a><span class="co">#&gt; 6  -0.53151573 series1    6</span></span>
<span id="cb6-13"><a href="#cb6-13" tabindex="-1"></a><span class="co">#&gt; 7  -0.02939463 series1    7</span></span>
<span id="cb6-14"><a href="#cb6-14" tabindex="-1"></a><span class="co">#&gt; 8   0.67704160 series1    8</span></span>
<span id="cb6-15"><a href="#cb6-15" tabindex="-1"></a><span class="co">#&gt; 9   0.53028655 series1    9</span></span>
<span id="cb6-16"><a href="#cb6-16" tabindex="-1"></a><span class="co">#&gt; 10 -1.52837062 series1   10</span></span></code></pre></div>
<p>A call to <code>gam</code> using the <code>mgcv</code> package leads
to a model that actually fits (though it does give an unhelpful warning
message):</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="fu">gam</span>(outcome <span class="sc">~</span> time,</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>    <span class="at">family =</span> <span class="fu">betar</span>(),</span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>    <span class="at">data =</span> gauss_dat)</span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a><span class="co">#&gt; Warning in family$saturated.ll(y, prior.weights, theta): saturated likelihood</span></span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a><span class="co">#&gt; may be inaccurate</span></span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a><span class="co">#&gt; Family: Beta regression(0.135) </span></span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a><span class="co">#&gt; Link function: logit </span></span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a><span class="co">#&gt; Formula:</span></span>
<span id="cb7-11"><a href="#cb7-11" tabindex="-1"></a><span class="co">#&gt; outcome ~ time</span></span>
<span id="cb7-12"><a href="#cb7-12" tabindex="-1"></a><span class="co">#&gt; Total model degrees of freedom 2 </span></span>
<span id="cb7-13"><a href="#cb7-13" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-14"><a href="#cb7-14" tabindex="-1"></a><span class="co">#&gt; REML score: -177.4533</span></span></code></pre></div>
<p>But the same call to <code>mvgam</code> gives us something more
useful:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="fu">mvgam</span>(outcome <span class="sc">~</span> time,</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>      <span class="at">family =</span> <span class="fu">betar</span>(),</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>      <span class="at">data =</span> gauss_dat)</span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a><span class="co">#&gt; Error: Values &lt;= 0 not allowed for beta responses</span></span></code></pre></div>
<p>Please see <code>?mvgam_families</code> for more information on the
types of responses that the package can handle and their
restrictions</p>
</div>
<div id="a-time-variable" class="section level3">
<h3>A <code>time</code> variable</h3>
<p>The other requirement for most models that can be fit in
<code>mvgam</code> is a <code>numeric / integer</code>-classed variable
labelled <code>time</code>. This ensures the modelling software knows
how to arrange the time series when building models. This setup still
allows us to formulate multivariate time series models. If you plan to
use any of the autoregressive dynamic trend functions available in
<code>mvgam</code> (see <code>?mvgam_trends</code> for details of
available dynamic processes), you will need to ensure your time series
are entered with a fixed sampling interval (i.e. the time between
timesteps 1 and 2 should be the same as the time between timesteps 2 and
3, etc…). But note that you can have missing observations for some (or
all) series. <code>mvgam</code> will check this for you, but again it is
useful to ensure you have no missing timepoint x series combinations in
your data. You can generally do this with a simple <code>dplyr</code>
call:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="co"># A function to ensure all timepoints within a sequence are identical</span></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>all_times_avail <span class="ot">=</span> <span class="cf">function</span>(time, min_time, max_time){</span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>    <span class="fu">identical</span>(<span class="fu">as.numeric</span>(<span class="fu">sort</span>(time)),</span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a>              <span class="fu">as.numeric</span>(<span class="fu">seq.int</span>(<span class="at">from =</span> min_time, <span class="at">to =</span> max_time)))</span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a>}</span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a><span class="co"># Get min and max times from the data</span></span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a>min_time <span class="ot">&lt;-</span> <span class="fu">min</span>(simdat<span class="sc">$</span>data_train<span class="sc">$</span>time)</span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a>max_time <span class="ot">&lt;-</span> <span class="fu">max</span>(simdat<span class="sc">$</span>data_train<span class="sc">$</span>time)</span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a></span>
<span id="cb9-11"><a href="#cb9-11" tabindex="-1"></a><span class="co"># Check that all times are recorded for each series</span></span>
<span id="cb9-12"><a href="#cb9-12" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">series =</span> simdat<span class="sc">$</span>data_train<span class="sc">$</span>series,</span>
<span id="cb9-13"><a href="#cb9-13" tabindex="-1"></a>           <span class="at">time =</span> simdat<span class="sc">$</span>data_train<span class="sc">$</span>time) <span class="sc">%&gt;%</span></span>
<span id="cb9-14"><a href="#cb9-14" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">group_by</span>(series) <span class="sc">%&gt;%</span></span>
<span id="cb9-15"><a href="#cb9-15" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">all_there =</span> <span class="fu">all_times_avail</span>(time,</span>
<span id="cb9-16"><a href="#cb9-16" tabindex="-1"></a>                                                 min_time,</span>
<span id="cb9-17"><a href="#cb9-17" tabindex="-1"></a>                                                 max_time)) <span class="ot">-&gt;</span> checked_times</span>
<span id="cb9-18"><a href="#cb9-18" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">any</span>(checked_times<span class="sc">$</span>all_there <span class="sc">==</span> <span class="cn">FALSE</span>)){</span>
<span id="cb9-19"><a href="#cb9-19" tabindex="-1"></a>  <span class="fu">warning</span>(<span class="st">&quot;One or more series in is missing observations for one or more timepoints&quot;</span>)</span>
<span id="cb9-20"><a href="#cb9-20" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb9-21"><a href="#cb9-21" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&#39;All series have observations at all timepoints :)&#39;</span>)</span>
<span id="cb9-22"><a href="#cb9-22" tabindex="-1"></a>}</span>
<span id="cb9-23"><a href="#cb9-23" tabindex="-1"></a><span class="co">#&gt; All series have observations at all timepoints :)</span></span></code></pre></div>
<p>Note that models which use dynamic components will assume that
smaller values of <code>time</code> are <em>older</em>
(i.e. <code>time = 1</code> came <em>before</em> <code>time = 2</code>,
etc…)</p>
</div>
<div id="irregular-sampling-intervals" class="section level3">
<h3>Irregular sampling intervals?</h3>
<p>Most <code>mvgam</code> trend models expect <code>time</code> to be
measured in discrete, evenly-spaced intervals (i.e. one measurement per
week, or one per year, for example; though missing values are allowed).
But please note that irregularly sampled time intervals are allowed, in
which case the <code>CAR()</code> trend model (continuous time
autoregressive) is appropriate. You can see an example of this kind of
model in the <strong>Examples</strong> section in <code>?CAR</code>. You
can also use <code>trend_model = &#39;None&#39;</code> (the default in
<code>mvgam()</code>) and instead use a Gaussian Process to model
temporal variation for irregularly-sampled time series. See the
<code>?brms::gp</code> for details</p>
</div>
</div>
<div id="checking-data-with-get_mvgam_priors" class="section level2">
<h2>Checking data with <code>get_mvgam_priors</code></h2>
<p>The <code>get_mvgam_priors</code> function is designed to return
information about the parameters in a model whose prior distributions
can be modified by the user. But in doing so, it will perform a series
of checks to ensure the data are formatted properly. It can therefore be
very useful to new users for ensuring there isn’t anything strange going
on in the data setup. For example, we can replicate the steps taken
above (to check factor levels and timepoint x series combinations) with
a single call to <code>get_mvgam_priors</code>. Here we first simulate
some data in which some of the timepoints in the <code>time</code>
variable are not included in the data:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a>bad_times <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">time =</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">16</span>, <span class="at">by =</span> <span class="dv">2</span>),</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>                        <span class="at">series =</span> <span class="fu">factor</span>(<span class="st">&#39;series_1&#39;</span>),</span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a>                        <span class="at">outcome =</span> <span class="fu">rnorm</span>(<span class="dv">8</span>))</span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a>bad_times</span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a><span class="co">#&gt;   time   series    outcome</span></span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a><span class="co">#&gt; 1    1 series_1 -0.4313989</span></span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a><span class="co">#&gt; 2    3 series_1 -1.5537678</span></span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a><span class="co">#&gt; 3    5 series_1  1.0315560</span></span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a><span class="co">#&gt; 4    7 series_1  0.8438992</span></span>
<span id="cb10-10"><a href="#cb10-10" tabindex="-1"></a><span class="co">#&gt; 5    9 series_1 -0.3758622</span></span>
<span id="cb10-11"><a href="#cb10-11" tabindex="-1"></a><span class="co">#&gt; 6   11 series_1  1.6854502</span></span>
<span id="cb10-12"><a href="#cb10-12" tabindex="-1"></a><span class="co">#&gt; 7   13 series_1 -1.0580686</span></span>
<span id="cb10-13"><a href="#cb10-13" tabindex="-1"></a><span class="co">#&gt; 8   15 series_1 -0.7285234</span></span></code></pre></div>
<p>Next we call <code>get_mvgam_priors</code> by simply specifying an
intercept-only model, which is enough to trigger all the checks:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="fu">get_mvgam_priors</span>(outcome <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a>                 <span class="at">data =</span> bad_times,</span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a>                 <span class="at">family =</span> <span class="fu">gaussian</span>())</span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a><span class="co">#&gt; Error: One or more series in data is missing observations for one or more timepoints</span></span></code></pre></div>
<p>This error is useful as it tells us where the problem is. There are
many ways to fill in missing timepoints, so the correct way will have to
be left up to the user. But if you don’t have any covariates, it should
be pretty easy using <code>expand.grid</code>:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a>bad_times <span class="sc">%&gt;%</span></span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">right_join</span>(<span class="fu">expand.grid</span>(<span class="at">time =</span> <span class="fu">seq</span>(<span class="fu">min</span>(bad_times<span class="sc">$</span>time),</span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a>                                           <span class="fu">max</span>(bad_times<span class="sc">$</span>time)),</span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a>                                <span class="at">series =</span> <span class="fu">factor</span>(<span class="fu">unique</span>(bad_times<span class="sc">$</span>series),</span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a>                                                <span class="at">levels =</span> <span class="fu">levels</span>(bad_times<span class="sc">$</span>series)))) <span class="sc">%&gt;%</span></span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(time) <span class="ot">-&gt;</span> good_times</span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a><span class="co">#&gt; Joining with `by = join_by(time, series)`</span></span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a>good_times</span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a><span class="co">#&gt;    time   series    outcome</span></span>
<span id="cb12-10"><a href="#cb12-10" tabindex="-1"></a><span class="co">#&gt; 1     1 series_1 -0.4313989</span></span>
<span id="cb12-11"><a href="#cb12-11" tabindex="-1"></a><span class="co">#&gt; 2     2 series_1         NA</span></span>
<span id="cb12-12"><a href="#cb12-12" tabindex="-1"></a><span class="co">#&gt; 3     3 series_1 -1.5537678</span></span>
<span id="cb12-13"><a href="#cb12-13" tabindex="-1"></a><span class="co">#&gt; 4     4 series_1         NA</span></span>
<span id="cb12-14"><a href="#cb12-14" tabindex="-1"></a><span class="co">#&gt; 5     5 series_1  1.0315560</span></span>
<span id="cb12-15"><a href="#cb12-15" tabindex="-1"></a><span class="co">#&gt; 6     6 series_1         NA</span></span>
<span id="cb12-16"><a href="#cb12-16" tabindex="-1"></a><span class="co">#&gt; 7     7 series_1  0.8438992</span></span>
<span id="cb12-17"><a href="#cb12-17" tabindex="-1"></a><span class="co">#&gt; 8     8 series_1         NA</span></span>
<span id="cb12-18"><a href="#cb12-18" tabindex="-1"></a><span class="co">#&gt; 9     9 series_1 -0.3758622</span></span>
<span id="cb12-19"><a href="#cb12-19" tabindex="-1"></a><span class="co">#&gt; 10   10 series_1         NA</span></span>
<span id="cb12-20"><a href="#cb12-20" tabindex="-1"></a><span class="co">#&gt; 11   11 series_1  1.6854502</span></span>
<span id="cb12-21"><a href="#cb12-21" tabindex="-1"></a><span class="co">#&gt; 12   12 series_1         NA</span></span>
<span id="cb12-22"><a href="#cb12-22" tabindex="-1"></a><span class="co">#&gt; 13   13 series_1 -1.0580686</span></span>
<span id="cb12-23"><a href="#cb12-23" tabindex="-1"></a><span class="co">#&gt; 14   14 series_1         NA</span></span>
<span id="cb12-24"><a href="#cb12-24" tabindex="-1"></a><span class="co">#&gt; 15   15 series_1 -0.7285234</span></span></code></pre></div>
<p>Now the call to <code>get_mvgam_priors</code>, using our filled in
data, should work:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="fu">get_mvgam_priors</span>(outcome <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a>                 <span class="at">data =</span> good_times,</span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a>                 <span class="at">family =</span> <span class="fu">gaussian</span>())</span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a><span class="co">#&gt;                             param_name param_length           param_info</span></span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a><span class="co">#&gt; 1                          (Intercept)            1          (Intercept)</span></span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a><span class="co">#&gt; 2 vector&lt;lower=0&gt;[n_series] sigma_obs;            1 observation error sd</span></span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a><span class="co">#&gt;                                    prior                  example_change</span></span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a><span class="co">#&gt; 1 (Intercept) ~ student_t(3, -0.4, 2.5);     (Intercept) ~ normal(0, 1);</span></span>
<span id="cb13-9"><a href="#cb13-9" tabindex="-1"></a><span class="co">#&gt; 2      sigma_obs ~ student_t(3, 0, 2.5); sigma_obs ~ normal(-0.25, 0.9);</span></span>
<span id="cb13-10"><a href="#cb13-10" tabindex="-1"></a><span class="co">#&gt;   new_lowerbound new_upperbound</span></span>
<span id="cb13-11"><a href="#cb13-11" tabindex="-1"></a><span class="co">#&gt; 1             NA             NA</span></span>
<span id="cb13-12"><a href="#cb13-12" tabindex="-1"></a><span class="co">#&gt; 2             NA             NA</span></span></code></pre></div>
<p>This function should also pick up on misaligned factor levels for the
<code>series</code> variable. We can check this by again simulating,
this time adding an additional factor level that is not included in the
data:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a>bad_levels <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">time =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>,</span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a>                        <span class="at">series =</span> <span class="fu">factor</span>(<span class="st">&#39;series_1&#39;</span>,</span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a>                                        <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&#39;series_1&#39;</span>,</span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a>                                                   <span class="st">&#39;series_2&#39;</span>)),</span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a>                        <span class="at">outcome =</span> <span class="fu">rnorm</span>(<span class="dv">8</span>))</span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" tabindex="-1"></a><span class="fu">levels</span>(bad_levels<span class="sc">$</span>series)</span>
<span id="cb14-8"><a href="#cb14-8" tabindex="-1"></a><span class="co">#&gt; [1] &quot;series_1&quot; &quot;series_2&quot;</span></span></code></pre></div>
<p>Another call to <code>get_mvgam_priors</code> brings up a useful
error:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="fu">get_mvgam_priors</span>(outcome <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a>                 <span class="at">data =</span> bad_levels,</span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a>                 <span class="at">family =</span> <span class="fu">gaussian</span>())</span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a><span class="co">#&gt; Error: Mismatch between factor levels of &quot;series&quot; and unique values of &quot;series&quot;</span></span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a><span class="co">#&gt; Use</span></span>
<span id="cb15-6"><a href="#cb15-6" tabindex="-1"></a><span class="co">#&gt;   `setdiff(levels(data$series), unique(data$series))` </span></span>
<span id="cb15-7"><a href="#cb15-7" tabindex="-1"></a><span class="co">#&gt; and</span></span>
<span id="cb15-8"><a href="#cb15-8" tabindex="-1"></a><span class="co">#&gt;   `intersect(levels(data$series), unique(data$series))`</span></span>
<span id="cb15-9"><a href="#cb15-9" tabindex="-1"></a><span class="co">#&gt; for guidance</span></span></code></pre></div>
<p>Following the message’s advice tells us there is a level for
<code>series_2</code> in the <code>series</code> variable, but there are
no observations for this series in the data:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="fu">setdiff</span>(<span class="fu">levels</span>(bad_levels<span class="sc">$</span>series), <span class="fu">unique</span>(bad_levels<span class="sc">$</span>series))</span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a><span class="co">#&gt; [1] &quot;series_2&quot;</span></span></code></pre></div>
<p>Re-assigning the levels fixes the issue:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a>bad_levels <span class="sc">%&gt;%</span></span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">series =</span> <span class="fu">droplevels</span>(series)) <span class="ot">-&gt;</span> good_levels</span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a><span class="fu">levels</span>(good_levels<span class="sc">$</span>series)</span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a><span class="co">#&gt; [1] &quot;series_1&quot;</span></span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a><span class="fu">get_mvgam_priors</span>(outcome <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a>                 <span class="at">data =</span> good_levels,</span>
<span id="cb18-3"><a href="#cb18-3" tabindex="-1"></a>                 <span class="at">family =</span> <span class="fu">gaussian</span>())</span>
<span id="cb18-4"><a href="#cb18-4" tabindex="-1"></a><span class="co">#&gt;                             param_name param_length           param_info</span></span>
<span id="cb18-5"><a href="#cb18-5" tabindex="-1"></a><span class="co">#&gt; 1                          (Intercept)            1          (Intercept)</span></span>
<span id="cb18-6"><a href="#cb18-6" tabindex="-1"></a><span class="co">#&gt; 2 vector&lt;lower=0&gt;[n_series] sigma_obs;            1 observation error sd</span></span>
<span id="cb18-7"><a href="#cb18-7" tabindex="-1"></a><span class="co">#&gt;                                   prior                   example_change</span></span>
<span id="cb18-8"><a href="#cb18-8" tabindex="-1"></a><span class="co">#&gt; 1 (Intercept) ~ student_t(3, 0.5, 2.5);      (Intercept) ~ normal(0, 1);</span></span>
<span id="cb18-9"><a href="#cb18-9" tabindex="-1"></a><span class="co">#&gt; 2     sigma_obs ~ student_t(3, 0, 2.5); sigma_obs ~ normal(-0.59, 0.61);</span></span>
<span id="cb18-10"><a href="#cb18-10" tabindex="-1"></a><span class="co">#&gt;   new_lowerbound new_upperbound</span></span>
<span id="cb18-11"><a href="#cb18-11" tabindex="-1"></a><span class="co">#&gt; 1             NA             NA</span></span>
<span id="cb18-12"><a href="#cb18-12" tabindex="-1"></a><span class="co">#&gt; 2             NA             NA</span></span></code></pre></div>
<div id="covariates-with-no-nas" class="section level3">
<h3>Covariates with no <code>NA</code>s</h3>
<p>Covariates can be used in models just as you would when using
<code>mgcv</code> (see <code>?formula.gam</code> for details of the
formula syntax). But although the outcome variable can have
<code>NA</code>s, covariates cannot. Most regression software will
silently drop any raws in the model matrix that have <code>NA</code>s,
which is not helpful when debugging. Both the <code>mvgam</code> and
<code>get_mvgam_priors</code> functions will run some simple checks for
you, and hopefully will return useful errors if it finds in missing
values:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a>miss_dat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">outcome =</span> <span class="fu">rnorm</span>(<span class="dv">10</span>),</span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a>                       <span class="at">cov =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="fu">rnorm</span>(<span class="dv">9</span>)),</span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a>                       <span class="at">series =</span> <span class="fu">factor</span>(<span class="st">&#39;series1&#39;</span>,</span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a>                                       <span class="at">levels =</span> <span class="st">&#39;series1&#39;</span>),</span>
<span id="cb19-5"><a href="#cb19-5" tabindex="-1"></a>                       <span class="at">time =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)</span>
<span id="cb19-6"><a href="#cb19-6" tabindex="-1"></a>miss_dat</span>
<span id="cb19-7"><a href="#cb19-7" tabindex="-1"></a><span class="co">#&gt;       outcome        cov  series time</span></span>
<span id="cb19-8"><a href="#cb19-8" tabindex="-1"></a><span class="co">#&gt; 1  -0.3926197         NA series1    1</span></span>
<span id="cb19-9"><a href="#cb19-9" tabindex="-1"></a><span class="co">#&gt; 2  -0.1127277  1.3171518 series1    2</span></span>
<span id="cb19-10"><a href="#cb19-10" tabindex="-1"></a><span class="co">#&gt; 3  -1.5022493 -0.5112159 series1    3</span></span>
<span id="cb19-11"><a href="#cb19-11" tabindex="-1"></a><span class="co">#&gt; 4   1.2718119 -1.5898549 series1    4</span></span>
<span id="cb19-12"><a href="#cb19-12" tabindex="-1"></a><span class="co">#&gt; 5   0.3792046 -1.5860549 series1    5</span></span>
<span id="cb19-13"><a href="#cb19-13" tabindex="-1"></a><span class="co">#&gt; 6   1.0253017 -1.4026850 series1    6</span></span>
<span id="cb19-14"><a href="#cb19-14" tabindex="-1"></a><span class="co">#&gt; 7  -1.1546050 -0.6485981 series1    7</span></span>
<span id="cb19-15"><a href="#cb19-15" tabindex="-1"></a><span class="co">#&gt; 8  -0.1498811 -0.7392203 series1    8</span></span>
<span id="cb19-16"><a href="#cb19-16" tabindex="-1"></a><span class="co">#&gt; 9   2.0924367  0.5155418 series1    9</span></span>
<span id="cb19-17"><a href="#cb19-17" tabindex="-1"></a><span class="co">#&gt; 10 -0.5269962 -1.2443386 series1   10</span></span></code></pre></div>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a><span class="fu">get_mvgam_priors</span>(outcome <span class="sc">~</span> cov,</span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a>                 <span class="at">data =</span> miss_dat,</span>
<span id="cb20-3"><a href="#cb20-3" tabindex="-1"></a>                 <span class="at">family =</span> <span class="fu">gaussian</span>())</span>
<span id="cb20-4"><a href="#cb20-4" tabindex="-1"></a><span class="co">#&gt; Error: Missing values found in data predictors:</span></span>
<span id="cb20-5"><a href="#cb20-5" tabindex="-1"></a><span class="co">#&gt;  Error in na.fail.default(structure(list(outcome = c(-0.392619741341104, : missing values in object</span></span></code></pre></div>
<p>Just like with the <code>mgcv</code> package, <code>mvgam</code> can
also accept data as a <code>list</code> object. This is useful if you
want to set up <a href="https://rdrr.io/cran/mgcv/man/linear.functional.terms.html">linear
functional predictors</a> or even distributed lag predictors. The checks
run by <code>mvgam</code> should still work on these data. Here we
change the <code>cov</code> predictor to be a <code>matrix</code>:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a>miss_dat <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">outcome =</span> <span class="fu">rnorm</span>(<span class="dv">10</span>),</span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a>                 <span class="at">series =</span> <span class="fu">factor</span>(<span class="st">&#39;series1&#39;</span>,</span>
<span id="cb21-3"><a href="#cb21-3" tabindex="-1"></a>                                 <span class="at">levels =</span> <span class="st">&#39;series1&#39;</span>),</span>
<span id="cb21-4"><a href="#cb21-4" tabindex="-1"></a>                 <span class="at">time =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)</span>
<span id="cb21-5"><a href="#cb21-5" tabindex="-1"></a>miss_dat<span class="sc">$</span>cov <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">rnorm</span>(<span class="dv">50</span>), <span class="at">ncol =</span> <span class="dv">5</span>, <span class="at">nrow =</span> <span class="dv">10</span>)</span>
<span id="cb21-6"><a href="#cb21-6" tabindex="-1"></a>miss_dat<span class="sc">$</span>cov[<span class="dv">2</span>,<span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span></span></code></pre></div>
<p>A call to <code>mvgam</code> returns the same error:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a><span class="fu">get_mvgam_priors</span>(outcome <span class="sc">~</span> cov,</span>
<span id="cb22-2"><a href="#cb22-2" tabindex="-1"></a>                 <span class="at">data =</span> miss_dat,</span>
<span id="cb22-3"><a href="#cb22-3" tabindex="-1"></a>                 <span class="at">family =</span> <span class="fu">gaussian</span>())</span>
<span id="cb22-4"><a href="#cb22-4" tabindex="-1"></a><span class="co">#&gt; Error: Missing values found in data predictors:</span></span>
<span id="cb22-5"><a href="#cb22-5" tabindex="-1"></a><span class="co">#&gt;  Error in na.fail.default(structure(list(outcome = c(-0.494366970739628, : missing values in object</span></span></code></pre></div>
</div>
</div>
<div id="plotting-with-plot_mvgam_series" class="section level2">
<h2>Plotting with <code>plot_mvgam_series</code></h2>
<p>Plotting the data is a useful way to ensure everything looks ok, once
you’ve gone throug the above checks on factor levels and timepoint x
series combinations. The <code>plot_mvgam_series</code> function will
take supplied data and plot either a series of line plots (if you choose
<code>series = &#39;all&#39;</code>) or a set of plots to describe the
distribution for a single time series. For example, to plot all of the
time series in our data, and highlight a single series in each plot, we
can use:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a><span class="fu">plot_mvgam_series</span>(<span class="at">data =</span> simdat<span class="sc">$</span>data_train, </span>
<span id="cb23-2"><a href="#cb23-2" tabindex="-1"></a>                  <span class="at">y =</span> <span class="st">&#39;y&#39;</span>, </span>
<span id="cb23-3"><a href="#cb23-3" tabindex="-1"></a>                  <span class="at">series =</span> <span class="st">&#39;all&#39;</span>)</span></code></pre></div>
<p><img src="data:image/png;base64,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" alt="Plotting time series features for GAM models in mvgam" width="60%" style="display: block; margin: auto;" /></p>
<p>Or we can look more closely at the distribution for the first time
series:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a><span class="fu">plot_mvgam_series</span>(<span class="at">data =</span> simdat<span class="sc">$</span>data_train, </span>
<span id="cb24-2"><a href="#cb24-2" tabindex="-1"></a>                  <span class="at">y =</span> <span class="st">&#39;y&#39;</span>, </span>
<span id="cb24-3"><a href="#cb24-3" tabindex="-1"></a>                  <span class="at">series =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="data:image/png;base64,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" alt="Plotting time series features for GAM models in mvgam" width="60%" style="display: block; margin: auto;" /></p>
<p>If you have split your data into training and testing folds (i.e. for
forecast evaluation), you can include the test data in your plots:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a><span class="fu">plot_mvgam_series</span>(<span class="at">data =</span> simdat<span class="sc">$</span>data_train,</span>
<span id="cb25-2"><a href="#cb25-2" tabindex="-1"></a>                  <span class="at">newdata =</span> simdat<span class="sc">$</span>data_test,</span>
<span id="cb25-3"><a href="#cb25-3" tabindex="-1"></a>                  <span class="at">y =</span> <span class="st">&#39;y&#39;</span>, </span>
<span id="cb25-4"><a href="#cb25-4" tabindex="-1"></a>                  <span class="at">series =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="data:image/png;base64,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" alt="Plotting time series features for GAM models in mvgam" width="60%" style="display: block; margin: auto;" /></p>
</div>
<div id="example-with-neon-tick-data" class="section level2">
<h2>Example with NEON tick data</h2>
<p>To give one example of how data can be reformatted for
<code>mvgam</code> modelling, we will use observations from the National
Ecological Observatory Network (NEON) tick drag cloth samples.
<em>Ixodes scapularis</em> is a widespread tick species capable of
transmitting a diversity of parasites to animals and humans, many of
which are zoonotic. Due to the medical and ecological importance of this
tick species, a common goal is to understand factors that influence
their abundances. The NEON field team carries out standardised <a href="https://www.neonscience.org/data-collection/ticks" target="_blank">long-term monitoring of tick abundances as well as other
important indicators of ecological change</a>. Nymphal abundance of
<em>I. scapularis</em> is routinely recorded across NEON plots using a
field sampling method called drag cloth sampling, which is a common
method for sampling ticks in the landscape. Field researchers sample
ticks by dragging a large cloth behind themselves through terrain that
is suspected of harboring ticks, usually working in a grid-like pattern.
The sites have been sampled since 2014, resulting in a rich dataset of
nymph abundance time series. These tick time series show strong
seasonality and incorporate many of the challenging features associated
with ecological data including overdispersion, high proportions of
missingness and irregular sampling in time, making them useful for
exploring the utility of dynamic GAMs.</p>
<p>We begin by loading NEON tick data for the years 2014 - 2021, which
were downloaded from NEON and prepared as described in <a href="https://besjournals.onlinelibrary.wiley.com/doi/full/10.1111/2041-210X.13974" target="_blank">Clark &amp; Wells 2022</a>. You can read a bit about the
data using the call <code>?all_neon_tick_data</code></p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;all_neon_tick_data&quot;</span>)</span>
<span id="cb26-2"><a href="#cb26-2" tabindex="-1"></a><span class="fu">str</span>(dplyr<span class="sc">::</span><span class="fu">ungroup</span>(all_neon_tick_data))</span>
<span id="cb26-3"><a href="#cb26-3" tabindex="-1"></a><span class="co">#&gt; tibble [3,505 × 24] (S3: tbl_df/tbl/data.frame)</span></span>
<span id="cb26-4"><a href="#cb26-4" tabindex="-1"></a><span class="co">#&gt;  $ Year                : num [1:3505] 2015 2015 2015 2015 2015 ...</span></span>
<span id="cb26-5"><a href="#cb26-5" tabindex="-1"></a><span class="co">#&gt;  $ epiWeek             : chr [1:3505] &quot;37&quot; &quot;38&quot; &quot;39&quot; &quot;40&quot; ...</span></span>
<span id="cb26-6"><a href="#cb26-6" tabindex="-1"></a><span class="co">#&gt;  $ yearWeek            : chr [1:3505] &quot;201537&quot; &quot;201538&quot; &quot;201539&quot; &quot;201540&quot; ...</span></span>
<span id="cb26-7"><a href="#cb26-7" tabindex="-1"></a><span class="co">#&gt;  $ plotID              : chr [1:3505] &quot;BLAN_005&quot; &quot;BLAN_005&quot; &quot;BLAN_005&quot; &quot;BLAN_005&quot; ...</span></span>
<span id="cb26-8"><a href="#cb26-8" tabindex="-1"></a><span class="co">#&gt;  $ siteID              : chr [1:3505] &quot;BLAN&quot; &quot;BLAN&quot; &quot;BLAN&quot; &quot;BLAN&quot; ...</span></span>
<span id="cb26-9"><a href="#cb26-9" tabindex="-1"></a><span class="co">#&gt;  $ nlcdClass           : chr [1:3505] &quot;deciduousForest&quot; &quot;deciduousForest&quot; &quot;deciduousForest&quot; &quot;deciduousForest&quot; ...</span></span>
<span id="cb26-10"><a href="#cb26-10" tabindex="-1"></a><span class="co">#&gt;  $ decimalLatitude     : num [1:3505] 39.1 39.1 39.1 39.1 39.1 ...</span></span>
<span id="cb26-11"><a href="#cb26-11" tabindex="-1"></a><span class="co">#&gt;  $ decimalLongitude    : num [1:3505] -78 -78 -78 -78 -78 ...</span></span>
<span id="cb26-12"><a href="#cb26-12" tabindex="-1"></a><span class="co">#&gt;  $ elevation           : num [1:3505] 168 168 168 168 168 ...</span></span>
<span id="cb26-13"><a href="#cb26-13" tabindex="-1"></a><span class="co">#&gt;  $ totalSampledArea    : num [1:3505] 162 NA NA NA 162 NA NA NA NA 164 ...</span></span>
<span id="cb26-14"><a href="#cb26-14" tabindex="-1"></a><span class="co">#&gt;  $ amblyomma_americanum: num [1:3505] NA NA NA NA NA NA NA NA NA NA ...</span></span>
<span id="cb26-15"><a href="#cb26-15" tabindex="-1"></a><span class="co">#&gt;  $ ixodes_scapularis   : num [1:3505] 2 NA NA NA 0 NA NA NA NA 0 ...</span></span>
<span id="cb26-16"><a href="#cb26-16" tabindex="-1"></a><span class="co">#&gt;  $ time                : Date[1:3505], format: &quot;2015-09-13&quot; &quot;2015-09-20&quot; ...</span></span>
<span id="cb26-17"><a href="#cb26-17" tabindex="-1"></a><span class="co">#&gt;  $ RHMin_precent       : num [1:3505] NA NA NA NA NA NA NA NA NA NA ...</span></span>
<span id="cb26-18"><a href="#cb26-18" tabindex="-1"></a><span class="co">#&gt;  $ RHMin_variance      : num [1:3505] NA NA NA NA NA NA NA NA NA NA ...</span></span>
<span id="cb26-19"><a href="#cb26-19" tabindex="-1"></a><span class="co">#&gt;  $ RHMax_precent       : num [1:3505] NA NA NA NA NA NA NA NA NA NA ...</span></span>
<span id="cb26-20"><a href="#cb26-20" tabindex="-1"></a><span class="co">#&gt;  $ RHMax_variance      : num [1:3505] NA NA NA NA NA NA NA NA NA NA ...</span></span>
<span id="cb26-21"><a href="#cb26-21" tabindex="-1"></a><span class="co">#&gt;  $ airTempMin_degC     : num [1:3505] NA NA NA NA NA NA NA NA NA NA ...</span></span>
<span id="cb26-22"><a href="#cb26-22" tabindex="-1"></a><span class="co">#&gt;  $ airTempMin_variance : num [1:3505] NA NA NA NA NA NA NA NA NA NA ...</span></span>
<span id="cb26-23"><a href="#cb26-23" tabindex="-1"></a><span class="co">#&gt;  $ airTempMax_degC     : num [1:3505] NA NA NA NA NA NA NA NA NA NA ...</span></span>
<span id="cb26-24"><a href="#cb26-24" tabindex="-1"></a><span class="co">#&gt;  $ airTempMax_variance : num [1:3505] NA NA NA NA NA NA NA NA NA NA ...</span></span>
<span id="cb26-25"><a href="#cb26-25" tabindex="-1"></a><span class="co">#&gt;  $ soi                 : num [1:3505] -18.4 -17.9 -23.5 -28.4 -25.9 ...</span></span>
<span id="cb26-26"><a href="#cb26-26" tabindex="-1"></a><span class="co">#&gt;  $ cum_sdd             : num [1:3505] 173 173 173 173 173 ...</span></span>
<span id="cb26-27"><a href="#cb26-27" tabindex="-1"></a><span class="co">#&gt;  $ cum_gdd             : num [1:3505] 1129 1129 1129 1129 1129 ...</span></span></code></pre></div>
<p>For this exercise, we will use the <code>epiWeek</code> variable as
an index of seasonality, and we will only work with observations from a
few sampling plots (labelled in the <code>plotID</code> column):</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a>plotIDs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;SCBI_013&#39;</span>,<span class="st">&#39;SCBI_002&#39;</span>,</span>
<span id="cb27-2"><a href="#cb27-2" tabindex="-1"></a>             <span class="st">&#39;SERC_001&#39;</span>,<span class="st">&#39;SERC_005&#39;</span>,</span>
<span id="cb27-3"><a href="#cb27-3" tabindex="-1"></a>             <span class="st">&#39;SERC_006&#39;</span>,<span class="st">&#39;SERC_012&#39;</span>,</span>
<span id="cb27-4"><a href="#cb27-4" tabindex="-1"></a>             <span class="st">&#39;BLAN_012&#39;</span>,<span class="st">&#39;BLAN_005&#39;</span>)</span></code></pre></div>
<p>Now we can select the target species we want (<em>I.
scapularis</em>), filter to the correct plot IDs and convert the
<code>epiWeek</code> variable from <code>character</code> to
<code>numeric</code>:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" tabindex="-1"></a>model_dat <span class="ot">&lt;-</span> all_neon_tick_data <span class="sc">%&gt;%</span></span>
<span id="cb28-2"><a href="#cb28-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb28-3"><a href="#cb28-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">target =</span> ixodes_scapularis) <span class="sc">%&gt;%</span></span>
<span id="cb28-4"><a href="#cb28-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(plotID <span class="sc">%in%</span> plotIDs) <span class="sc">%&gt;%</span></span>
<span id="cb28-5"><a href="#cb28-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(Year, epiWeek, plotID, target) <span class="sc">%&gt;%</span></span>
<span id="cb28-6"><a href="#cb28-6" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">epiWeek =</span> <span class="fu">as.numeric</span>(epiWeek))</span></code></pre></div>
<p>Now is the tricky part: we need to fill in missing observations with
<code>NA</code>s. The tick data are sparse in that field observers do
not go out and sample in each possible <code>epiWeek</code>. So there
are many particular weeks in which observations are not included in the
data. But we can use <code>expand.grid</code> again to take care of
this:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" tabindex="-1"></a>model_dat <span class="sc">%&gt;%</span></span>
<span id="cb29-2"><a href="#cb29-2" tabindex="-1"></a>  <span class="co"># Create all possible combos of plotID, Year and epiWeek; </span></span>
<span id="cb29-3"><a href="#cb29-3" tabindex="-1"></a>  <span class="co"># missing outcomes will be filled in as NA</span></span>
<span id="cb29-4"><a href="#cb29-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">full_join</span>(<span class="fu">expand.grid</span>(<span class="at">plotID =</span> <span class="fu">unique</span>(model_dat<span class="sc">$</span>plotID),</span>
<span id="cb29-5"><a href="#cb29-5" tabindex="-1"></a>                               <span class="at">Year =</span> <span class="fu">unique</span>(model_dat<span class="sc">$</span>Year),</span>
<span id="cb29-6"><a href="#cb29-6" tabindex="-1"></a>                               <span class="at">epiWeek =</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">52</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb29-7"><a href="#cb29-7" tabindex="-1"></a>  </span>
<span id="cb29-8"><a href="#cb29-8" tabindex="-1"></a>  <span class="co"># left_join back to original data so plotID and siteID will</span></span>
<span id="cb29-9"><a href="#cb29-9" tabindex="-1"></a>  <span class="co"># match up, in case you need the siteID for anything else later on</span></span>
<span id="cb29-10"><a href="#cb29-10" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(all_neon_tick_data <span class="sc">%&gt;%</span></span>
<span id="cb29-11"><a href="#cb29-11" tabindex="-1"></a>                     dplyr<span class="sc">::</span><span class="fu">select</span>(siteID, plotID) <span class="sc">%&gt;%</span></span>
<span id="cb29-12"><a href="#cb29-12" tabindex="-1"></a>                     dplyr<span class="sc">::</span><span class="fu">distinct</span>()) <span class="ot">-&gt;</span> model_dat</span>
<span id="cb29-13"><a href="#cb29-13" tabindex="-1"></a><span class="co">#&gt; Joining with `by = join_by(Year, epiWeek, plotID)`</span></span>
<span id="cb29-14"><a href="#cb29-14" tabindex="-1"></a><span class="co">#&gt; Joining with `by = join_by(plotID)`</span></span></code></pre></div>
<p>Create the <code>series</code> variable needed for <code>mvgam</code>
modelling:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" tabindex="-1"></a>model_dat <span class="sc">%&gt;%</span></span>
<span id="cb30-2"><a href="#cb30-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">series =</span> plotID,</span>
<span id="cb30-3"><a href="#cb30-3" tabindex="-1"></a>                <span class="at">y =</span> target) <span class="sc">%&gt;%</span></span>
<span id="cb30-4"><a href="#cb30-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">siteID =</span> <span class="fu">factor</span>(siteID),</span>
<span id="cb30-5"><a href="#cb30-5" tabindex="-1"></a>                <span class="at">series =</span> <span class="fu">factor</span>(series)) <span class="sc">%&gt;%</span></span>
<span id="cb30-6"><a href="#cb30-6" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>target, <span class="sc">-</span>plotID) <span class="sc">%&gt;%</span></span>
<span id="cb30-7"><a href="#cb30-7" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(Year, epiWeek, series) <span class="ot">-&gt;</span> model_dat </span></code></pre></div>
<p>Now create the <code>time</code> variable, which needs to track
<code>Year</code> and <code>epiWeek</code> for each unique series. The
<code>n</code> function from <code>dplyr</code> is often useful if
generating a <code>time</code> index for grouped dataframes:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" tabindex="-1"></a>model_dat <span class="sc">%&gt;%</span></span>
<span id="cb31-2"><a href="#cb31-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb31-3"><a href="#cb31-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(series) <span class="sc">%&gt;%</span></span>
<span id="cb31-4"><a href="#cb31-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(Year, epiWeek) <span class="sc">%&gt;%</span></span>
<span id="cb31-5"><a href="#cb31-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">time =</span> <span class="fu">seq</span>(<span class="dv">1</span>, dplyr<span class="sc">::</span><span class="fu">n</span>())) <span class="sc">%&gt;%</span></span>
<span id="cb31-6"><a href="#cb31-6" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="ot">-&gt;</span> model_dat</span></code></pre></div>
<p>Check factor levels for the <code>series</code>:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" tabindex="-1"></a><span class="fu">levels</span>(model_dat<span class="sc">$</span>series)</span>
<span id="cb32-2"><a href="#cb32-2" tabindex="-1"></a><span class="co">#&gt; [1] &quot;BLAN_005&quot; &quot;BLAN_012&quot; &quot;SCBI_002&quot; &quot;SCBI_013&quot; &quot;SERC_001&quot; &quot;SERC_005&quot; &quot;SERC_006&quot;</span></span>
<span id="cb32-3"><a href="#cb32-3" tabindex="-1"></a><span class="co">#&gt; [8] &quot;SERC_012&quot;</span></span></code></pre></div>
<p>This looks good, as does a more rigorous check using
<code>get_mvgam_priors</code>:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" tabindex="-1"></a><span class="fu">get_mvgam_priors</span>(y <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb33-2"><a href="#cb33-2" tabindex="-1"></a>                 <span class="at">data =</span> model_dat,</span>
<span id="cb33-3"><a href="#cb33-3" tabindex="-1"></a>                 <span class="at">family =</span> <span class="fu">poisson</span>())</span>
<span id="cb33-4"><a href="#cb33-4" tabindex="-1"></a><span class="co">#&gt;    param_name param_length  param_info                                  prior</span></span>
<span id="cb33-5"><a href="#cb33-5" tabindex="-1"></a><span class="co">#&gt; 1 (Intercept)            1 (Intercept) (Intercept) ~ student_t(3, -2.3, 2.5);</span></span>
<span id="cb33-6"><a href="#cb33-6" tabindex="-1"></a><span class="co">#&gt;                example_change new_lowerbound new_upperbound</span></span>
<span id="cb33-7"><a href="#cb33-7" tabindex="-1"></a><span class="co">#&gt; 1 (Intercept) ~ normal(0, 1);             NA             NA</span></span></code></pre></div>
<p>We can also set up a model in <code>mvgam</code> but use
<code>run_model = FALSE</code> to further ensure all of the necessary
steps for creating the modelling code and objects will run. It is
recommended that you use the <code>cmdstanr</code> backend if possible,
as the auto-formatting options available in this package are very useful
for checking the package-generated <code>Stan</code> code for any
inefficiencies that can be fixed to lead to sampling performance
improvements:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" tabindex="-1"></a>testmod <span class="ot">&lt;-</span> <span class="fu">mvgam</span>(y <span class="sc">~</span> <span class="fu">s</span>(epiWeek, <span class="at">by =</span> series, <span class="at">bs =</span> <span class="st">&#39;cc&#39;</span>) <span class="sc">+</span></span>
<span id="cb34-2"><a href="#cb34-2" tabindex="-1"></a>                   <span class="fu">s</span>(series, <span class="at">bs =</span> <span class="st">&#39;re&#39;</span>),</span>
<span id="cb34-3"><a href="#cb34-3" tabindex="-1"></a>                 <span class="at">trend_model =</span> <span class="st">&#39;AR1&#39;</span>,</span>
<span id="cb34-4"><a href="#cb34-4" tabindex="-1"></a>                 <span class="at">data =</span> model_dat,</span>
<span id="cb34-5"><a href="#cb34-5" tabindex="-1"></a>                 <span class="at">backend =</span> <span class="st">&#39;cmdstanr&#39;</span>,</span>
<span id="cb34-6"><a href="#cb34-6" tabindex="-1"></a>                 <span class="at">run_model =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p>This call runs without issue, and the resulting object now contains
the model code and data objects that are needed to initiate
sampling:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" tabindex="-1"></a><span class="fu">str</span>(testmod<span class="sc">$</span>model_data)</span>
<span id="cb35-2"><a href="#cb35-2" tabindex="-1"></a><span class="co">#&gt; List of 25</span></span>
<span id="cb35-3"><a href="#cb35-3" tabindex="-1"></a><span class="co">#&gt;  $ y           : num [1:416, 1:8] -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 ...</span></span>
<span id="cb35-4"><a href="#cb35-4" tabindex="-1"></a><span class="co">#&gt;  $ n           : int 416</span></span>
<span id="cb35-5"><a href="#cb35-5" tabindex="-1"></a><span class="co">#&gt;  $ X           : num [1:3328, 1:73] 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span id="cb35-6"><a href="#cb35-6" tabindex="-1"></a><span class="co">#&gt;   ..- attr(*, &quot;dimnames&quot;)=List of 2</span></span>
<span id="cb35-7"><a href="#cb35-7" tabindex="-1"></a><span class="co">#&gt;   .. ..$ : chr [1:3328] &quot;1&quot; &quot;2&quot; &quot;3&quot; &quot;4&quot; ...</span></span>
<span id="cb35-8"><a href="#cb35-8" tabindex="-1"></a><span class="co">#&gt;   .. ..$ : chr [1:73] &quot;X.Intercept.&quot; &quot;V2&quot; &quot;V3&quot; &quot;V4&quot; ...</span></span>
<span id="cb35-9"><a href="#cb35-9" tabindex="-1"></a><span class="co">#&gt;  $ S1          : num [1:8, 1:8] 1.037 -0.416 0.419 0.117 0.188 ...</span></span>
<span id="cb35-10"><a href="#cb35-10" tabindex="-1"></a><span class="co">#&gt;  $ zero        : num [1:73] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span id="cb35-11"><a href="#cb35-11" tabindex="-1"></a><span class="co">#&gt;  $ S2          : num [1:8, 1:8] 1.037 -0.416 0.419 0.117 0.188 ...</span></span>
<span id="cb35-12"><a href="#cb35-12" tabindex="-1"></a><span class="co">#&gt;  $ S3          : num [1:8, 1:8] 1.037 -0.416 0.419 0.117 0.188 ...</span></span>
<span id="cb35-13"><a href="#cb35-13" tabindex="-1"></a><span class="co">#&gt;  $ S4          : num [1:8, 1:8] 1.037 -0.416 0.419 0.117 0.188 ...</span></span>
<span id="cb35-14"><a href="#cb35-14" tabindex="-1"></a><span class="co">#&gt;  $ S5          : num [1:8, 1:8] 1.037 -0.416 0.419 0.117 0.188 ...</span></span>
<span id="cb35-15"><a href="#cb35-15" tabindex="-1"></a><span class="co">#&gt;  $ S6          : num [1:8, 1:8] 1.037 -0.416 0.419 0.117 0.188 ...</span></span>
<span id="cb35-16"><a href="#cb35-16" tabindex="-1"></a><span class="co">#&gt;  $ S7          : num [1:8, 1:8] 1.037 -0.416 0.419 0.117 0.188 ...</span></span>
<span id="cb35-17"><a href="#cb35-17" tabindex="-1"></a><span class="co">#&gt;  $ S8          : num [1:8, 1:8] 1.037 -0.416 0.419 0.117 0.188 ...</span></span>
<span id="cb35-18"><a href="#cb35-18" tabindex="-1"></a><span class="co">#&gt;  $ p_coefs     : Named num 0.775</span></span>
<span id="cb35-19"><a href="#cb35-19" tabindex="-1"></a><span class="co">#&gt;   ..- attr(*, &quot;names&quot;)= chr &quot;(Intercept)&quot;</span></span>
<span id="cb35-20"><a href="#cb35-20" tabindex="-1"></a><span class="co">#&gt;  $ p_taus      : num 3285</span></span>
<span id="cb35-21"><a href="#cb35-21" tabindex="-1"></a><span class="co">#&gt;  $ ytimes      : int [1:416, 1:8] 1 9 17 25 33 41 49 57 65 73 ...</span></span>
<span id="cb35-22"><a href="#cb35-22" tabindex="-1"></a><span class="co">#&gt;  $ n_series    : int 8</span></span>
<span id="cb35-23"><a href="#cb35-23" tabindex="-1"></a><span class="co">#&gt;  $ sp          : Named num [1:9] 5.46 8 28.79 5 2.65 ...</span></span>
<span id="cb35-24"><a href="#cb35-24" tabindex="-1"></a><span class="co">#&gt;   ..- attr(*, &quot;names&quot;)= chr [1:9] &quot;s(epiWeek):seriesBLAN_005&quot; &quot;s(epiWeek):seriesBLAN_012&quot; &quot;s(epiWeek):seriesSCBI_002&quot; &quot;s(epiWeek):seriesSCBI_013&quot; ...</span></span>
<span id="cb35-25"><a href="#cb35-25" tabindex="-1"></a><span class="co">#&gt;  $ y_observed  : num [1:416, 1:8] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span id="cb35-26"><a href="#cb35-26" tabindex="-1"></a><span class="co">#&gt;  $ total_obs   : int 3328</span></span>
<span id="cb35-27"><a href="#cb35-27" tabindex="-1"></a><span class="co">#&gt;  $ num_basis   : int 73</span></span>
<span id="cb35-28"><a href="#cb35-28" tabindex="-1"></a><span class="co">#&gt;  $ n_sp        : num 9</span></span>
<span id="cb35-29"><a href="#cb35-29" tabindex="-1"></a><span class="co">#&gt;  $ n_nonmissing: int 400</span></span>
<span id="cb35-30"><a href="#cb35-30" tabindex="-1"></a><span class="co">#&gt;  $ obs_ind     : int [1:400] 89 93 98 101 115 118 121 124 127 130 ...</span></span>
<span id="cb35-31"><a href="#cb35-31" tabindex="-1"></a><span class="co">#&gt;  $ flat_ys     : num [1:400] 2 0 0 0 0 0 0 25 36 14 ...</span></span>
<span id="cb35-32"><a href="#cb35-32" tabindex="-1"></a><span class="co">#&gt;  $ flat_xs     : num [1:400, 1:73] 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span id="cb35-33"><a href="#cb35-33" tabindex="-1"></a><span class="co">#&gt;   ..- attr(*, &quot;dimnames&quot;)=List of 2</span></span>
<span id="cb35-34"><a href="#cb35-34" tabindex="-1"></a><span class="co">#&gt;   .. ..$ : chr [1:400] &quot;705&quot; &quot;737&quot; &quot;777&quot; &quot;801&quot; ...</span></span>
<span id="cb35-35"><a href="#cb35-35" tabindex="-1"></a><span class="co">#&gt;   .. ..$ : chr [1:73] &quot;X.Intercept.&quot; &quot;V2&quot; &quot;V3&quot; &quot;V4&quot; ...</span></span>
<span id="cb35-36"><a href="#cb35-36" tabindex="-1"></a><span class="co">#&gt;  - attr(*, &quot;trend_model&quot;)= chr &quot;AR1&quot;</span></span></code></pre></div>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" tabindex="-1"></a><span class="fu">code</span>(testmod)</span>
<span id="cb36-2"><a href="#cb36-2" tabindex="-1"></a><span class="co">#&gt; // Stan model code generated by package mvgam</span></span>
<span id="cb36-3"><a href="#cb36-3" tabindex="-1"></a><span class="co">#&gt; data {</span></span>
<span id="cb36-4"><a href="#cb36-4" tabindex="-1"></a><span class="co">#&gt;   int&lt;lower=0&gt; total_obs; // total number of observations</span></span>
<span id="cb36-5"><a href="#cb36-5" tabindex="-1"></a><span class="co">#&gt;   int&lt;lower=0&gt; n; // number of timepoints per series</span></span>
<span id="cb36-6"><a href="#cb36-6" tabindex="-1"></a><span class="co">#&gt;   int&lt;lower=0&gt; n_sp; // number of smoothing parameters</span></span>
<span id="cb36-7"><a href="#cb36-7" tabindex="-1"></a><span class="co">#&gt;   int&lt;lower=0&gt; n_series; // number of series</span></span>
<span id="cb36-8"><a href="#cb36-8" tabindex="-1"></a><span class="co">#&gt;   int&lt;lower=0&gt; num_basis; // total number of basis coefficients</span></span>
<span id="cb36-9"><a href="#cb36-9" tabindex="-1"></a><span class="co">#&gt;   vector[num_basis] zero; // prior locations for basis coefficients</span></span>
<span id="cb36-10"><a href="#cb36-10" tabindex="-1"></a><span class="co">#&gt;   matrix[total_obs, num_basis] X; // mgcv GAM design matrix</span></span>
<span id="cb36-11"><a href="#cb36-11" tabindex="-1"></a><span class="co">#&gt;   array[n, n_series] int&lt;lower=0&gt; ytimes; // time-ordered matrix (which col in X belongs to each [time, series] observation?)</span></span>
<span id="cb36-12"><a href="#cb36-12" tabindex="-1"></a><span class="co">#&gt;   matrix[8, 8] S1; // mgcv smooth penalty matrix S1</span></span>
<span id="cb36-13"><a href="#cb36-13" tabindex="-1"></a><span class="co">#&gt;   matrix[8, 8] S2; // mgcv smooth penalty matrix S2</span></span>
<span id="cb36-14"><a href="#cb36-14" tabindex="-1"></a><span class="co">#&gt;   matrix[8, 8] S3; // mgcv smooth penalty matrix S3</span></span>
<span id="cb36-15"><a href="#cb36-15" tabindex="-1"></a><span class="co">#&gt;   matrix[8, 8] S4; // mgcv smooth penalty matrix S4</span></span>
<span id="cb36-16"><a href="#cb36-16" tabindex="-1"></a><span class="co">#&gt;   matrix[8, 8] S5; // mgcv smooth penalty matrix S5</span></span>
<span id="cb36-17"><a href="#cb36-17" tabindex="-1"></a><span class="co">#&gt;   matrix[8, 8] S6; // mgcv smooth penalty matrix S6</span></span>
<span id="cb36-18"><a href="#cb36-18" tabindex="-1"></a><span class="co">#&gt;   matrix[8, 8] S7; // mgcv smooth penalty matrix S7</span></span>
<span id="cb36-19"><a href="#cb36-19" tabindex="-1"></a><span class="co">#&gt;   matrix[8, 8] S8; // mgcv smooth penalty matrix S8</span></span>
<span id="cb36-20"><a href="#cb36-20" tabindex="-1"></a><span class="co">#&gt;   int&lt;lower=0&gt; n_nonmissing; // number of nonmissing observations</span></span>
<span id="cb36-21"><a href="#cb36-21" tabindex="-1"></a><span class="co">#&gt;   array[n_nonmissing] int&lt;lower=0&gt; flat_ys; // flattened nonmissing observations</span></span>
<span id="cb36-22"><a href="#cb36-22" tabindex="-1"></a><span class="co">#&gt;   matrix[n_nonmissing, num_basis] flat_xs; // X values for nonmissing observations</span></span>
<span id="cb36-23"><a href="#cb36-23" tabindex="-1"></a><span class="co">#&gt;   array[n_nonmissing] int&lt;lower=0&gt; obs_ind; // indices of nonmissing observations</span></span>
<span id="cb36-24"><a href="#cb36-24" tabindex="-1"></a><span class="co">#&gt; }</span></span>
<span id="cb36-25"><a href="#cb36-25" tabindex="-1"></a><span class="co">#&gt; parameters {</span></span>
<span id="cb36-26"><a href="#cb36-26" tabindex="-1"></a><span class="co">#&gt;   // raw basis coefficients</span></span>
<span id="cb36-27"><a href="#cb36-27" tabindex="-1"></a><span class="co">#&gt;   vector[num_basis] b_raw;</span></span>
<span id="cb36-28"><a href="#cb36-28" tabindex="-1"></a><span class="co">#&gt;   </span></span>
<span id="cb36-29"><a href="#cb36-29" tabindex="-1"></a><span class="co">#&gt;   // random effect variances</span></span>
<span id="cb36-30"><a href="#cb36-30" tabindex="-1"></a><span class="co">#&gt;   vector&lt;lower=0&gt;[1] sigma_raw;</span></span>
<span id="cb36-31"><a href="#cb36-31" tabindex="-1"></a><span class="co">#&gt;   </span></span>
<span id="cb36-32"><a href="#cb36-32" tabindex="-1"></a><span class="co">#&gt;   // random effect means</span></span>
<span id="cb36-33"><a href="#cb36-33" tabindex="-1"></a><span class="co">#&gt;   vector[1] mu_raw;</span></span>
<span id="cb36-34"><a href="#cb36-34" tabindex="-1"></a><span class="co">#&gt;   </span></span>
<span id="cb36-35"><a href="#cb36-35" tabindex="-1"></a><span class="co">#&gt;   // latent trend AR1 terms</span></span>
<span id="cb36-36"><a href="#cb36-36" tabindex="-1"></a><span class="co">#&gt;   vector&lt;lower=-1.5, upper=1.5&gt;[n_series] ar1;</span></span>
<span id="cb36-37"><a href="#cb36-37" tabindex="-1"></a><span class="co">#&gt;   </span></span>
<span id="cb36-38"><a href="#cb36-38" tabindex="-1"></a><span class="co">#&gt;   // latent trend variance parameters</span></span>
<span id="cb36-39"><a href="#cb36-39" tabindex="-1"></a><span class="co">#&gt;   vector&lt;lower=0&gt;[n_series] sigma;</span></span>
<span id="cb36-40"><a href="#cb36-40" tabindex="-1"></a><span class="co">#&gt;   </span></span>
<span id="cb36-41"><a href="#cb36-41" tabindex="-1"></a><span class="co">#&gt;   // latent trends</span></span>
<span id="cb36-42"><a href="#cb36-42" tabindex="-1"></a><span class="co">#&gt;   matrix[n, n_series] trend;</span></span>
<span id="cb36-43"><a href="#cb36-43" tabindex="-1"></a><span class="co">#&gt;   </span></span>
<span id="cb36-44"><a href="#cb36-44" tabindex="-1"></a><span class="co">#&gt;   // smoothing parameters</span></span>
<span id="cb36-45"><a href="#cb36-45" tabindex="-1"></a><span class="co">#&gt;   vector&lt;lower=0&gt;[n_sp] lambda;</span></span>
<span id="cb36-46"><a href="#cb36-46" tabindex="-1"></a><span class="co">#&gt; }</span></span>
<span id="cb36-47"><a href="#cb36-47" tabindex="-1"></a><span class="co">#&gt; transformed parameters {</span></span>
<span id="cb36-48"><a href="#cb36-48" tabindex="-1"></a><span class="co">#&gt;   // basis coefficients</span></span>
<span id="cb36-49"><a href="#cb36-49" tabindex="-1"></a><span class="co">#&gt;   vector[num_basis] b;</span></span>
<span id="cb36-50"><a href="#cb36-50" tabindex="-1"></a><span class="co">#&gt;   b[1 : 65] = b_raw[1 : 65];</span></span>
<span id="cb36-51"><a href="#cb36-51" tabindex="-1"></a><span class="co">#&gt;   b[66 : 73] = mu_raw[1] + b_raw[66 : 73] * sigma_raw[1];</span></span>
<span id="cb36-52"><a href="#cb36-52" tabindex="-1"></a><span class="co">#&gt; }</span></span>
<span id="cb36-53"><a href="#cb36-53" tabindex="-1"></a><span class="co">#&gt; model {</span></span>
<span id="cb36-54"><a href="#cb36-54" tabindex="-1"></a><span class="co">#&gt;   // prior for random effect population variances</span></span>
<span id="cb36-55"><a href="#cb36-55" tabindex="-1"></a><span class="co">#&gt;   sigma_raw ~ student_t(3, 0, 2.5);</span></span>
<span id="cb36-56"><a href="#cb36-56" tabindex="-1"></a><span class="co">#&gt;   </span></span>
<span id="cb36-57"><a href="#cb36-57" tabindex="-1"></a><span class="co">#&gt;   // prior for random effect population means</span></span>
<span id="cb36-58"><a href="#cb36-58" tabindex="-1"></a><span class="co">#&gt;   mu_raw ~ std_normal();</span></span>
<span id="cb36-59"><a href="#cb36-59" tabindex="-1"></a><span class="co">#&gt;   </span></span>
<span id="cb36-60"><a href="#cb36-60" tabindex="-1"></a><span class="co">#&gt;   // prior for (Intercept)...</span></span>
<span id="cb36-61"><a href="#cb36-61" tabindex="-1"></a><span class="co">#&gt;   b_raw[1] ~ student_t(3, -2.3, 2.5);</span></span>
<span id="cb36-62"><a href="#cb36-62" tabindex="-1"></a><span class="co">#&gt;   </span></span>
<span id="cb36-63"><a href="#cb36-63" tabindex="-1"></a><span class="co">#&gt;   // prior for s(epiWeek):seriesBLAN_005...</span></span>
<span id="cb36-64"><a href="#cb36-64" tabindex="-1"></a><span class="co">#&gt;   b_raw[2 : 9] ~ multi_normal_prec(zero[2 : 9], S1[1 : 8, 1 : 8] * lambda[1]);</span></span>
<span id="cb36-65"><a href="#cb36-65" tabindex="-1"></a><span class="co">#&gt;   </span></span>
<span id="cb36-66"><a href="#cb36-66" tabindex="-1"></a><span class="co">#&gt;   // prior for s(epiWeek):seriesBLAN_012...</span></span>
<span id="cb36-67"><a href="#cb36-67" tabindex="-1"></a><span class="co">#&gt;   b_raw[10 : 17] ~ multi_normal_prec(zero[10 : 17],</span></span>
<span id="cb36-68"><a href="#cb36-68" tabindex="-1"></a><span class="co">#&gt;                                      S2[1 : 8, 1 : 8] * lambda[2]);</span></span>
<span id="cb36-69"><a href="#cb36-69" tabindex="-1"></a><span class="co">#&gt;   </span></span>
<span id="cb36-70"><a href="#cb36-70" tabindex="-1"></a><span class="co">#&gt;   // prior for s(epiWeek):seriesSCBI_002...</span></span>
<span id="cb36-71"><a href="#cb36-71" tabindex="-1"></a><span class="co">#&gt;   b_raw[18 : 25] ~ multi_normal_prec(zero[18 : 25],</span></span>
<span id="cb36-72"><a href="#cb36-72" tabindex="-1"></a><span class="co">#&gt;                                      S3[1 : 8, 1 : 8] * lambda[3]);</span></span>
<span id="cb36-73"><a href="#cb36-73" tabindex="-1"></a><span class="co">#&gt;   </span></span>
<span id="cb36-74"><a href="#cb36-74" tabindex="-1"></a><span class="co">#&gt;   // prior for s(epiWeek):seriesSCBI_013...</span></span>
<span id="cb36-75"><a href="#cb36-75" tabindex="-1"></a><span class="co">#&gt;   b_raw[26 : 33] ~ multi_normal_prec(zero[26 : 33],</span></span>
<span id="cb36-76"><a href="#cb36-76" tabindex="-1"></a><span class="co">#&gt;                                      S4[1 : 8, 1 : 8] * lambda[4]);</span></span>
<span id="cb36-77"><a href="#cb36-77" tabindex="-1"></a><span class="co">#&gt;   </span></span>
<span id="cb36-78"><a href="#cb36-78" tabindex="-1"></a><span class="co">#&gt;   // prior for s(epiWeek):seriesSERC_001...</span></span>
<span id="cb36-79"><a href="#cb36-79" tabindex="-1"></a><span class="co">#&gt;   b_raw[34 : 41] ~ multi_normal_prec(zero[34 : 41],</span></span>
<span id="cb36-80"><a href="#cb36-80" tabindex="-1"></a><span class="co">#&gt;                                      S5[1 : 8, 1 : 8] * lambda[5]);</span></span>
<span id="cb36-81"><a href="#cb36-81" tabindex="-1"></a><span class="co">#&gt;   </span></span>
<span id="cb36-82"><a href="#cb36-82" tabindex="-1"></a><span class="co">#&gt;   // prior for s(epiWeek):seriesSERC_005...</span></span>
<span id="cb36-83"><a href="#cb36-83" tabindex="-1"></a><span class="co">#&gt;   b_raw[42 : 49] ~ multi_normal_prec(zero[42 : 49],</span></span>
<span id="cb36-84"><a href="#cb36-84" tabindex="-1"></a><span class="co">#&gt;                                      S6[1 : 8, 1 : 8] * lambda[6]);</span></span>
<span id="cb36-85"><a href="#cb36-85" tabindex="-1"></a><span class="co">#&gt;   </span></span>
<span id="cb36-86"><a href="#cb36-86" tabindex="-1"></a><span class="co">#&gt;   // prior for s(epiWeek):seriesSERC_006...</span></span>
<span id="cb36-87"><a href="#cb36-87" tabindex="-1"></a><span class="co">#&gt;   b_raw[50 : 57] ~ multi_normal_prec(zero[50 : 57],</span></span>
<span id="cb36-88"><a href="#cb36-88" tabindex="-1"></a><span class="co">#&gt;                                      S7[1 : 8, 1 : 8] * lambda[7]);</span></span>
<span id="cb36-89"><a href="#cb36-89" tabindex="-1"></a><span class="co">#&gt;   </span></span>
<span id="cb36-90"><a href="#cb36-90" tabindex="-1"></a><span class="co">#&gt;   // prior for s(epiWeek):seriesSERC_012...</span></span>
<span id="cb36-91"><a href="#cb36-91" tabindex="-1"></a><span class="co">#&gt;   b_raw[58 : 65] ~ multi_normal_prec(zero[58 : 65],</span></span>
<span id="cb36-92"><a href="#cb36-92" tabindex="-1"></a><span class="co">#&gt;                                      S8[1 : 8, 1 : 8] * lambda[8]);</span></span>
<span id="cb36-93"><a href="#cb36-93" tabindex="-1"></a><span class="co">#&gt;   </span></span>
<span id="cb36-94"><a href="#cb36-94" tabindex="-1"></a><span class="co">#&gt;   // prior (non-centred) for s(series)...</span></span>
<span id="cb36-95"><a href="#cb36-95" tabindex="-1"></a><span class="co">#&gt;   b_raw[66 : 73] ~ std_normal();</span></span>
<span id="cb36-96"><a href="#cb36-96" tabindex="-1"></a><span class="co">#&gt;   </span></span>
<span id="cb36-97"><a href="#cb36-97" tabindex="-1"></a><span class="co">#&gt;   // priors for AR parameters</span></span>
<span id="cb36-98"><a href="#cb36-98" tabindex="-1"></a><span class="co">#&gt;   ar1 ~ std_normal();</span></span>
<span id="cb36-99"><a href="#cb36-99" tabindex="-1"></a><span class="co">#&gt;   </span></span>
<span id="cb36-100"><a href="#cb36-100" tabindex="-1"></a><span class="co">#&gt;   // priors for smoothing parameters</span></span>
<span id="cb36-101"><a href="#cb36-101" tabindex="-1"></a><span class="co">#&gt;   lambda ~ normal(5, 30);</span></span>
<span id="cb36-102"><a href="#cb36-102" tabindex="-1"></a><span class="co">#&gt;   </span></span>
<span id="cb36-103"><a href="#cb36-103" tabindex="-1"></a><span class="co">#&gt;   // priors for latent trend variance parameters</span></span>
<span id="cb36-104"><a href="#cb36-104" tabindex="-1"></a><span class="co">#&gt;   sigma ~ student_t(3, 0, 2.5);</span></span>
<span id="cb36-105"><a href="#cb36-105" tabindex="-1"></a><span class="co">#&gt;   </span></span>
<span id="cb36-106"><a href="#cb36-106" tabindex="-1"></a><span class="co">#&gt;   // trend estimates</span></span>
<span id="cb36-107"><a href="#cb36-107" tabindex="-1"></a><span class="co">#&gt;   trend[1, 1 : n_series] ~ normal(0, sigma);</span></span>
<span id="cb36-108"><a href="#cb36-108" tabindex="-1"></a><span class="co">#&gt;   for (s in 1 : n_series) {</span></span>
<span id="cb36-109"><a href="#cb36-109" tabindex="-1"></a><span class="co">#&gt;     trend[2 : n, s] ~ normal(ar1[s] * trend[1 : (n - 1), s], sigma[s]);</span></span>
<span id="cb36-110"><a href="#cb36-110" tabindex="-1"></a><span class="co">#&gt;   }</span></span>
<span id="cb36-111"><a href="#cb36-111" tabindex="-1"></a><span class="co">#&gt;   {</span></span>
<span id="cb36-112"><a href="#cb36-112" tabindex="-1"></a><span class="co">#&gt;     // likelihood functions</span></span>
<span id="cb36-113"><a href="#cb36-113" tabindex="-1"></a><span class="co">#&gt;     vector[n_nonmissing] flat_trends;</span></span>
<span id="cb36-114"><a href="#cb36-114" tabindex="-1"></a><span class="co">#&gt;     flat_trends = to_vector(trend)[obs_ind];</span></span>
<span id="cb36-115"><a href="#cb36-115" tabindex="-1"></a><span class="co">#&gt;     flat_ys ~ poisson_log_glm(append_col(flat_xs, flat_trends), 0.0,</span></span>
<span id="cb36-116"><a href="#cb36-116" tabindex="-1"></a><span class="co">#&gt;                               append_row(b, 1.0));</span></span>
<span id="cb36-117"><a href="#cb36-117" tabindex="-1"></a><span class="co">#&gt;   }</span></span>
<span id="cb36-118"><a href="#cb36-118" tabindex="-1"></a><span class="co">#&gt; }</span></span>
<span id="cb36-119"><a href="#cb36-119" tabindex="-1"></a><span class="co">#&gt; generated quantities {</span></span>
<span id="cb36-120"><a href="#cb36-120" tabindex="-1"></a><span class="co">#&gt;   vector[total_obs] eta;</span></span>
<span id="cb36-121"><a href="#cb36-121" tabindex="-1"></a><span class="co">#&gt;   matrix[n, n_series] mus;</span></span>
<span id="cb36-122"><a href="#cb36-122" tabindex="-1"></a><span class="co">#&gt;   vector[n_sp] rho;</span></span>
<span id="cb36-123"><a href="#cb36-123" tabindex="-1"></a><span class="co">#&gt;   vector[n_series] tau;</span></span>
<span id="cb36-124"><a href="#cb36-124" tabindex="-1"></a><span class="co">#&gt;   array[n, n_series] int ypred;</span></span>
<span id="cb36-125"><a href="#cb36-125" tabindex="-1"></a><span class="co">#&gt;   rho = log(lambda);</span></span>
<span id="cb36-126"><a href="#cb36-126" tabindex="-1"></a><span class="co">#&gt;   for (s in 1 : n_series) {</span></span>
<span id="cb36-127"><a href="#cb36-127" tabindex="-1"></a><span class="co">#&gt;     tau[s] = pow(sigma[s], -2.0);</span></span>
<span id="cb36-128"><a href="#cb36-128" tabindex="-1"></a><span class="co">#&gt;   }</span></span>
<span id="cb36-129"><a href="#cb36-129" tabindex="-1"></a><span class="co">#&gt;   </span></span>
<span id="cb36-130"><a href="#cb36-130" tabindex="-1"></a><span class="co">#&gt;   // posterior predictions</span></span>
<span id="cb36-131"><a href="#cb36-131" tabindex="-1"></a><span class="co">#&gt;   eta = X * b;</span></span>
<span id="cb36-132"><a href="#cb36-132" tabindex="-1"></a><span class="co">#&gt;   for (s in 1 : n_series) {</span></span>
<span id="cb36-133"><a href="#cb36-133" tabindex="-1"></a><span class="co">#&gt;     mus[1 : n, s] = eta[ytimes[1 : n, s]] + trend[1 : n, s];</span></span>
<span id="cb36-134"><a href="#cb36-134" tabindex="-1"></a><span class="co">#&gt;     ypred[1 : n, s] = poisson_log_rng(mus[1 : n, s]);</span></span>
<span id="cb36-135"><a href="#cb36-135" tabindex="-1"></a><span class="co">#&gt;   }</span></span>
<span id="cb36-136"><a href="#cb36-136" tabindex="-1"></a><span class="co">#&gt; }</span></span></code></pre></div>
</div>
<div id="interested-in-contributing" class="section level2">
<h2>Interested in contributing?</h2>
<p>I’m actively seeking PhD students and other researchers to work in
the areas of ecological forecasting, multivariate model evaluation and
development of <code>mvgam</code>. Please reach out if you are
interested (n.clark’at’uq.edu.au)</p>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
