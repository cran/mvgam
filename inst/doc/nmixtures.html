<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Nicholas J Clark" />

<meta name="date" content="2024-09-04" />

<title>N-mixtures in mvgam</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">N-mixtures in mvgam</h1>
<h4 class="author">Nicholas J Clark</h4>
<h4 class="date">2024-09-04</h4>



<p>The purpose of this vignette is to show how the <code>mvgam</code>
package can be used to fit and interrogate N-mixture models for
population abundance counts made with imperfect detection.</p>
<div id="n-mixture-models" class="section level2">
<h2>N-mixture models</h2>
<p>An N-mixture model is a fairly recent addition to the ecological
modeller’s toolkit that is designed to make inferences about variation
in the abundance of species when observations are imperfect (<a href="https://onlinelibrary.wiley.com/doi/10.1111/j.0006-341X.2004.00142.x" target="_blank">Royle 2004</a>). Briefly, assume <span class="math inline">\(\boldsymbol{Y_{i,r}}\)</span> is the number of
individuals recorded at site <span class="math inline">\(i\)</span>
during replicate sampling observation <span class="math inline">\(r\)</span> (recorded as a non-negative integer).
If multiple replicate surveys are done within a short enough period to
satisfy the assumption that the population remained closed (i.e. there
was no substantial change in true population size between replicate
surveys), we can account for the fact that observations aren’t perfect.
This is done by assuming that these replicate observations are Binomial
random variables that are parameterized by the true “latent” abundance
<span class="math inline">\(N\)</span> and a detection probability <span class="math inline">\(p\)</span>:</p>
<p><span class="math display">\[\begin{align*}
\boldsymbol{Y_{i,r}} &amp; \sim \text{Binomial}(N_i, p_r) \\
N_{i} &amp; \sim \text{Poisson}(\lambda_i)  \end{align*}\]</span></p>
<p>Using a set of linear predictors, we can estimate effects of
covariates <span class="math inline">\(\boldsymbol{X}\)</span> on the
expected latent abundance (with a log link for <span class="math inline">\(\lambda\)</span>) and, jointly, effects of
possibly different covariates (call them <span class="math inline">\(\boldsymbol{Q}\)</span>) on detection probability
(with a logit link for <span class="math inline">\(p\)</span>):</p>
<p><span class="math display">\[\begin{align*}
log(\lambda) &amp; = \beta \boldsymbol{X} \\
logit(p) &amp; = \gamma \boldsymbol{Q}\end{align*}\]</span></p>
<p><code>mvgam</code> can handle this type of model because it is
designed to propagate unobserved temporal processes that evolve
independently of the observation process in a State-space format. This
setup adapts well to N-mixture models because they can be thought of as
State-space models in which the latent state is a discrete variable
representing the “true” but unknown population size. This is very
convenient because we can incorporate any of the package’s diverse
effect types (i.e. multidimensional splines, time-varying effects,
monotonic effects, random effects etc…) into the linear predictors. All
that is required for this to work is a marginalization trick that allows
<code>Stan</code>’s sampling algorithms to handle discrete parameters
(see more about how this method of “integrating out” discrete parameters
works in <a href="https://mbjoseph.github.io/posts/2020-04-28-a-step-by-step-guide-to-marginalizing-over-discrete-parameters-for-ecologists-using-stan/" target="_blank">this nice blog post by Maxwell Joseph</a>).</p>
<p>The family <code>nmix()</code> is used to set up N-mixture models in
<code>mvgam</code>, but we still need to do a little bit of data
wrangling to ensure the data are set up in the correct format (this is
especially true when we have more than one replicate survey per time
period). The most important aspects are: (1) how we set up the
observation <code>series</code> and <code>trend_map</code> arguments to
ensure replicate surveys are mapped to the correct latent abundance
model and (2) the inclusion of a <code>cap</code> variable that defines
the maximum possible integer value to use for each observation when
estimating latent abundance. The two examples below give a reasonable
overview of how this can be done.</p>
</div>
<div id="example-1-a-two-species-system-with-nonlinear-trends" class="section level2">
<h2>Example 1: a two-species system with nonlinear trends</h2>
<p>First we will use a simple simulation in which multiple replicate
observations are taken at each timepoint for two different species. The
simulation produces observations at a single site over six years, with
five replicate surveys per year. Each species is simulated to have
different nonlinear temporal trends and different detection
probabilities. For now, detection probability is fixed (i.e. it does not
change over time or in association with any covariates). Notice that we
add the <code>cap</code> variable, which does not need to be static, to
define the maximum possible value that we think the latent abundance
could be for each timepoint. This simply needs to be large enough that
we get a reasonable idea of which latent N values are most likely,
without adding too much computational cost:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">999</span>)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="co"># Simulate observations for species 1, which shows a declining trend and 0.7 detection probability</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">site =</span> <span class="dv">1</span>,</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>           <span class="co"># five replicates per year; six years</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>           <span class="at">replicate =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="dv">6</span>),</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a>           <span class="at">time =</span> <span class="fu">sort</span>(<span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>, <span class="dv">5</span>)),</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a>           <span class="at">species =</span> <span class="st">&#39;sp_1&#39;</span>,</span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a>           <span class="co"># true abundance declines nonlinearly</span></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a>           <span class="at">truth =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">28</span>, <span class="dv">5</span>),</span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a>                     <span class="fu">rep</span>(<span class="dv">26</span>, <span class="dv">5</span>),</span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a>                     <span class="fu">rep</span>(<span class="dv">23</span>, <span class="dv">5</span>),</span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a>                     <span class="fu">rep</span>(<span class="dv">16</span>, <span class="dv">5</span>),</span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a>                     <span class="fu">rep</span>(<span class="dv">14</span>, <span class="dv">5</span>),</span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a>                     <span class="fu">rep</span>(<span class="dv">14</span>, <span class="dv">5</span>)),</span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a>           <span class="co"># observations are taken with detection prob = 0.7</span></span>
<span id="cb1-16"><a href="#cb1-16" tabindex="-1"></a>           <span class="at">obs =</span> <span class="fu">c</span>(<span class="fu">rbinom</span>(<span class="dv">5</span>, <span class="dv">28</span>, <span class="fl">0.7</span>),</span>
<span id="cb1-17"><a href="#cb1-17" tabindex="-1"></a>                   <span class="fu">rbinom</span>(<span class="dv">5</span>, <span class="dv">26</span>, <span class="fl">0.7</span>),</span>
<span id="cb1-18"><a href="#cb1-18" tabindex="-1"></a>                   <span class="fu">rbinom</span>(<span class="dv">5</span>, <span class="dv">23</span>, <span class="fl">0.7</span>),</span>
<span id="cb1-19"><a href="#cb1-19" tabindex="-1"></a>                   <span class="fu">rbinom</span>(<span class="dv">5</span>, <span class="dv">15</span>, <span class="fl">0.7</span>),</span>
<span id="cb1-20"><a href="#cb1-20" tabindex="-1"></a>                   <span class="fu">rbinom</span>(<span class="dv">5</span>, <span class="dv">14</span>, <span class="fl">0.7</span>),</span>
<span id="cb1-21"><a href="#cb1-21" tabindex="-1"></a>                   <span class="fu">rbinom</span>(<span class="dv">5</span>, <span class="dv">14</span>, <span class="fl">0.7</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb1-22"><a href="#cb1-22" tabindex="-1"></a>  <span class="co"># add &#39;series&#39; information, which is an identifier of site, replicate and species</span></span>
<span id="cb1-23"><a href="#cb1-23" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">series =</span> <span class="fu">paste0</span>(<span class="st">&#39;site_&#39;</span>, site,</span>
<span id="cb1-24"><a href="#cb1-24" tabindex="-1"></a>                                <span class="st">&#39;_&#39;</span>, species,</span>
<span id="cb1-25"><a href="#cb1-25" tabindex="-1"></a>                                <span class="st">&#39;_rep_&#39;</span>, replicate),</span>
<span id="cb1-26"><a href="#cb1-26" tabindex="-1"></a>                <span class="at">time =</span> <span class="fu">as.numeric</span>(time),</span>
<span id="cb1-27"><a href="#cb1-27" tabindex="-1"></a>                <span class="co"># add a &#39;cap&#39; variable that defines the maximum latent N to </span></span>
<span id="cb1-28"><a href="#cb1-28" tabindex="-1"></a>                <span class="co"># marginalize over when estimating latent abundance; in other words</span></span>
<span id="cb1-29"><a href="#cb1-29" tabindex="-1"></a>                <span class="co"># how large do we realistically think the true abundance could be?</span></span>
<span id="cb1-30"><a href="#cb1-30" tabindex="-1"></a>                <span class="at">cap =</span> <span class="dv">100</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-31"><a href="#cb1-31" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span> replicate) <span class="ot">-&gt;</span> testdat</span>
<span id="cb1-32"><a href="#cb1-32" tabindex="-1"></a></span>
<span id="cb1-33"><a href="#cb1-33" tabindex="-1"></a><span class="co"># Now add another species that has a different temporal trend and a smaller </span></span>
<span id="cb1-34"><a href="#cb1-34" tabindex="-1"></a><span class="co"># detection probability (0.45 for this species)</span></span>
<span id="cb1-35"><a href="#cb1-35" tabindex="-1"></a>testdat <span class="ot">=</span> testdat <span class="sc">%&gt;%</span></span>
<span id="cb1-36"><a href="#cb1-36" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(<span class="fu">data.frame</span>(<span class="at">site =</span> <span class="dv">1</span>,</span>
<span id="cb1-37"><a href="#cb1-37" tabindex="-1"></a>                              <span class="at">replicate =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="dv">6</span>),</span>
<span id="cb1-38"><a href="#cb1-38" tabindex="-1"></a>                              <span class="at">time =</span> <span class="fu">sort</span>(<span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>, <span class="dv">5</span>)),</span>
<span id="cb1-39"><a href="#cb1-39" tabindex="-1"></a>                              <span class="at">species =</span> <span class="st">&#39;sp_2&#39;</span>,</span>
<span id="cb1-40"><a href="#cb1-40" tabindex="-1"></a>                              <span class="at">truth =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">4</span>, <span class="dv">5</span>),</span>
<span id="cb1-41"><a href="#cb1-41" tabindex="-1"></a>                                        <span class="fu">rep</span>(<span class="dv">7</span>, <span class="dv">5</span>),</span>
<span id="cb1-42"><a href="#cb1-42" tabindex="-1"></a>                                        <span class="fu">rep</span>(<span class="dv">15</span>, <span class="dv">5</span>),</span>
<span id="cb1-43"><a href="#cb1-43" tabindex="-1"></a>                                        <span class="fu">rep</span>(<span class="dv">16</span>, <span class="dv">5</span>),</span>
<span id="cb1-44"><a href="#cb1-44" tabindex="-1"></a>                                        <span class="fu">rep</span>(<span class="dv">19</span>, <span class="dv">5</span>),</span>
<span id="cb1-45"><a href="#cb1-45" tabindex="-1"></a>                                        <span class="fu">rep</span>(<span class="dv">18</span>, <span class="dv">5</span>)),</span>
<span id="cb1-46"><a href="#cb1-46" tabindex="-1"></a>                              <span class="at">obs =</span> <span class="fu">c</span>(<span class="fu">rbinom</span>(<span class="dv">5</span>, <span class="dv">4</span>, <span class="fl">0.45</span>),</span>
<span id="cb1-47"><a href="#cb1-47" tabindex="-1"></a>                                      <span class="fu">rbinom</span>(<span class="dv">5</span>, <span class="dv">7</span>, <span class="fl">0.45</span>),</span>
<span id="cb1-48"><a href="#cb1-48" tabindex="-1"></a>                                      <span class="fu">rbinom</span>(<span class="dv">5</span>, <span class="dv">15</span>, <span class="fl">0.45</span>),</span>
<span id="cb1-49"><a href="#cb1-49" tabindex="-1"></a>                                      <span class="fu">rbinom</span>(<span class="dv">5</span>, <span class="dv">16</span>, <span class="fl">0.45</span>),</span>
<span id="cb1-50"><a href="#cb1-50" tabindex="-1"></a>                                      <span class="fu">rbinom</span>(<span class="dv">5</span>, <span class="dv">19</span>, <span class="fl">0.45</span>),</span>
<span id="cb1-51"><a href="#cb1-51" tabindex="-1"></a>                                      <span class="fu">rbinom</span>(<span class="dv">5</span>, <span class="dv">18</span>, <span class="fl">0.45</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb1-52"><a href="#cb1-52" tabindex="-1"></a>                     dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">series =</span> <span class="fu">paste0</span>(<span class="st">&#39;site_&#39;</span>, site,</span>
<span id="cb1-53"><a href="#cb1-53" tabindex="-1"></a>                                                   <span class="st">&#39;_&#39;</span>, species,</span>
<span id="cb1-54"><a href="#cb1-54" tabindex="-1"></a>                                                   <span class="st">&#39;_rep_&#39;</span>, replicate),</span>
<span id="cb1-55"><a href="#cb1-55" tabindex="-1"></a>                                   <span class="at">time =</span> <span class="fu">as.numeric</span>(time),</span>
<span id="cb1-56"><a href="#cb1-56" tabindex="-1"></a>                                   <span class="at">cap =</span> <span class="dv">50</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-57"><a href="#cb1-57" tabindex="-1"></a>                     dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>replicate))</span></code></pre></div>
<p>This data format isn’t too difficult to set up, but it does differ
from the traditional multidimensional array setup that is commonly used
for fitting N-mixture models in other software packages. Next we ensure
that species and series IDs are included as factor variables, in case
we’d like to allow certain effects to vary by species</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>testdat<span class="sc">$</span>species <span class="ot">&lt;-</span> <span class="fu">factor</span>(testdat<span class="sc">$</span>species,</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>                          <span class="at">levels =</span> <span class="fu">unique</span>(testdat<span class="sc">$</span>species))</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>testdat<span class="sc">$</span>series <span class="ot">&lt;-</span> <span class="fu">factor</span>(testdat<span class="sc">$</span>series,</span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>                         <span class="at">levels =</span> <span class="fu">unique</span>(testdat<span class="sc">$</span>series))</span></code></pre></div>
<p>Preview the dataset to get an idea of how it is structured:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">glimpse</span>(testdat)</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="co">#&gt; Rows: 60</span></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a><span class="co">#&gt; Columns: 7</span></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a><span class="co">#&gt; $ site    &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…</span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a><span class="co">#&gt; $ time    &lt;dbl&gt; 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 4, 4, 4, 4, 4, 5,…</span></span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a><span class="co">#&gt; $ species &lt;fct&gt; sp_1, sp_1, sp_1, sp_1, sp_1, sp_1, sp_1, sp_1, sp_1, sp_1, sp…</span></span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a><span class="co">#&gt; $ truth   &lt;dbl&gt; 28, 28, 28, 28, 28, 26, 26, 26, 26, 26, 23, 23, 23, 23, 23, 16…</span></span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a><span class="co">#&gt; $ obs     &lt;int&gt; 20, 19, 23, 17, 18, 21, 18, 21, 19, 18, 17, 16, 20, 11, 19, 9,…</span></span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a><span class="co">#&gt; $ series  &lt;fct&gt; site_1_sp_1_rep_1, site_1_sp_1_rep_2, site_1_sp_1_rep_3, site_…</span></span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a><span class="co">#&gt; $ cap     &lt;dbl&gt; 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 10…</span></span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a><span class="fu">head</span>(testdat, <span class="dv">12</span>)</span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a><span class="co">#&gt;    site time species truth obs            series cap</span></span>
<span id="cb3-13"><a href="#cb3-13" tabindex="-1"></a><span class="co">#&gt; 1     1    1    sp_1    28  20 site_1_sp_1_rep_1 100</span></span>
<span id="cb3-14"><a href="#cb3-14" tabindex="-1"></a><span class="co">#&gt; 2     1    1    sp_1    28  19 site_1_sp_1_rep_2 100</span></span>
<span id="cb3-15"><a href="#cb3-15" tabindex="-1"></a><span class="co">#&gt; 3     1    1    sp_1    28  23 site_1_sp_1_rep_3 100</span></span>
<span id="cb3-16"><a href="#cb3-16" tabindex="-1"></a><span class="co">#&gt; 4     1    1    sp_1    28  17 site_1_sp_1_rep_4 100</span></span>
<span id="cb3-17"><a href="#cb3-17" tabindex="-1"></a><span class="co">#&gt; 5     1    1    sp_1    28  18 site_1_sp_1_rep_5 100</span></span>
<span id="cb3-18"><a href="#cb3-18" tabindex="-1"></a><span class="co">#&gt; 6     1    2    sp_1    26  21 site_1_sp_1_rep_1 100</span></span>
<span id="cb3-19"><a href="#cb3-19" tabindex="-1"></a><span class="co">#&gt; 7     1    2    sp_1    26  18 site_1_sp_1_rep_2 100</span></span>
<span id="cb3-20"><a href="#cb3-20" tabindex="-1"></a><span class="co">#&gt; 8     1    2    sp_1    26  21 site_1_sp_1_rep_3 100</span></span>
<span id="cb3-21"><a href="#cb3-21" tabindex="-1"></a><span class="co">#&gt; 9     1    2    sp_1    26  19 site_1_sp_1_rep_4 100</span></span>
<span id="cb3-22"><a href="#cb3-22" tabindex="-1"></a><span class="co">#&gt; 10    1    2    sp_1    26  18 site_1_sp_1_rep_5 100</span></span>
<span id="cb3-23"><a href="#cb3-23" tabindex="-1"></a><span class="co">#&gt; 11    1    3    sp_1    23  17 site_1_sp_1_rep_1 100</span></span>
<span id="cb3-24"><a href="#cb3-24" tabindex="-1"></a><span class="co">#&gt; 12    1    3    sp_1    23  16 site_1_sp_1_rep_2 100</span></span></code></pre></div>
<div id="setting-up-the-trend_map" class="section level3">
<h3>Setting up the <code>trend_map</code></h3>
<p>Finally, we need to set up the <code>trend_map</code> object. This is
crucial for allowing multiple observations to be linked to the same
latent process model (see more information about this argument in the <a href="https://nicholasjclark.github.io/mvgam/articles/shared_states.html" target="_blank">Shared latent states vignette</a>). In this case, the
mapping operates by species and site to state that each set of replicate
observations from the same time point should all share the exact same
latent abundance model:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>testdat <span class="sc">%&gt;%</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>  <span class="co"># each unique combination of site*species is a separate process</span></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">trend =</span> <span class="fu">as.numeric</span>(<span class="fu">factor</span>(<span class="fu">paste0</span>(site, species)))) <span class="sc">%&gt;%</span></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(trend, series) <span class="sc">%&gt;%</span></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">distinct</span>() <span class="ot">-&gt;</span> trend_map</span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a>trend_map</span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a><span class="co">#&gt;    trend            series</span></span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a><span class="co">#&gt; 1      1 site_1_sp_1_rep_1</span></span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a><span class="co">#&gt; 2      1 site_1_sp_1_rep_2</span></span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a><span class="co">#&gt; 3      1 site_1_sp_1_rep_3</span></span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a><span class="co">#&gt; 4      1 site_1_sp_1_rep_4</span></span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a><span class="co">#&gt; 5      1 site_1_sp_1_rep_5</span></span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a><span class="co">#&gt; 6      2 site_1_sp_2_rep_1</span></span>
<span id="cb4-14"><a href="#cb4-14" tabindex="-1"></a><span class="co">#&gt; 7      2 site_1_sp_2_rep_2</span></span>
<span id="cb4-15"><a href="#cb4-15" tabindex="-1"></a><span class="co">#&gt; 8      2 site_1_sp_2_rep_3</span></span>
<span id="cb4-16"><a href="#cb4-16" tabindex="-1"></a><span class="co">#&gt; 9      2 site_1_sp_2_rep_4</span></span>
<span id="cb4-17"><a href="#cb4-17" tabindex="-1"></a><span class="co">#&gt; 10     2 site_1_sp_2_rep_5</span></span></code></pre></div>
<p>Notice how all of the replicates for species 1 in site 1 share the
same process (i.e. the same <code>trend</code>). This will ensure that
all replicates are Binomial draws of the same latent N.</p>
</div>
<div id="modelling-with-the-nmix-family" class="section level3">
<h3>Modelling with the <code>nmix()</code> family</h3>
<p>Now we are ready to fit a model using <code>mvgam()</code>. This
model will allow each species to have different detection probabilities
and different temporal trends. We will use <code>Cmdstan</code> as the
backend, which by default will use Hamiltonian Monte Carlo for full
Bayesian inference</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>mod <span class="ot">&lt;-</span> <span class="fu">mvgam</span>(</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>  <span class="co"># the observation formula sets up linear predictors for</span></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>  <span class="co"># detection probability on the logit scale</span></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a>  <span class="at">formula =</span> obs <span class="sc">~</span> species <span class="sc">-</span> <span class="dv">1</span>,</span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>  </span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a>  <span class="co"># the trend_formula sets up the linear predictors for </span></span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a>  <span class="co"># the latent abundance processes on the log scale</span></span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a>  <span class="at">trend_formula =</span> <span class="sc">~</span> <span class="fu">s</span>(time, <span class="at">by =</span> trend, <span class="at">k =</span> <span class="dv">4</span>) <span class="sc">+</span> species,</span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a>  </span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a>  <span class="co"># the trend_map takes care of the mapping</span></span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a>  <span class="at">trend_map =</span> trend_map,</span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a>  </span>
<span id="cb5-13"><a href="#cb5-13" tabindex="-1"></a>  <span class="co"># nmix() family and data</span></span>
<span id="cb5-14"><a href="#cb5-14" tabindex="-1"></a>  <span class="at">family =</span> <span class="fu">nmix</span>(),</span>
<span id="cb5-15"><a href="#cb5-15" tabindex="-1"></a>  <span class="at">data =</span> testdat,</span>
<span id="cb5-16"><a href="#cb5-16" tabindex="-1"></a>  </span>
<span id="cb5-17"><a href="#cb5-17" tabindex="-1"></a>  <span class="co"># priors can be set in the usual way</span></span>
<span id="cb5-18"><a href="#cb5-18" tabindex="-1"></a>  <span class="at">priors =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">std_normal</span>(), <span class="at">class =</span> b),</span>
<span id="cb5-19"><a href="#cb5-19" tabindex="-1"></a>             <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">1</span>, <span class="fl">1.5</span>), <span class="at">class =</span> Intercept_trend)),</span>
<span id="cb5-20"><a href="#cb5-20" tabindex="-1"></a>  <span class="at">samples =</span> <span class="dv">1000</span>)</span></code></pre></div>
<p>View the automatically-generated <code>Stan</code> code to get a
sense of how the marginalization over latent N works</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="fu">code</span>(mod)</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a><span class="co">#&gt; // Stan model code generated by package mvgam</span></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a><span class="co">#&gt; data {</span></span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a><span class="co">#&gt;   int&lt;lower=0&gt; total_obs; // total number of observations</span></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a><span class="co">#&gt;   int&lt;lower=0&gt; n; // number of timepoints per series</span></span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a><span class="co">#&gt;   int&lt;lower=0&gt; n_sp_trend; // number of trend smoothing parameters</span></span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a><span class="co">#&gt;   int&lt;lower=0&gt; n_lv; // number of dynamic factors</span></span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a><span class="co">#&gt;   int&lt;lower=0&gt; n_series; // number of series</span></span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a><span class="co">#&gt;   matrix[n_series, n_lv] Z; // matrix mapping series to latent states</span></span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a><span class="co">#&gt;   int&lt;lower=0&gt; num_basis; // total number of basis coefficients</span></span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a><span class="co">#&gt;   int&lt;lower=0&gt; num_basis_trend; // number of trend basis coefficients</span></span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a><span class="co">#&gt;   vector[num_basis_trend] zero_trend; // prior locations for trend basis coefficients</span></span>
<span id="cb6-13"><a href="#cb6-13" tabindex="-1"></a><span class="co">#&gt;   matrix[total_obs, num_basis] X; // mgcv GAM design matrix</span></span>
<span id="cb6-14"><a href="#cb6-14" tabindex="-1"></a><span class="co">#&gt;   matrix[n * n_lv, num_basis_trend] X_trend; // trend model design matrix</span></span>
<span id="cb6-15"><a href="#cb6-15" tabindex="-1"></a><span class="co">#&gt;   array[n, n_series] int&lt;lower=0&gt; ytimes; // time-ordered matrix (which col in X belongs to each [time, series] observation?)</span></span>
<span id="cb6-16"><a href="#cb6-16" tabindex="-1"></a><span class="co">#&gt;   array[n, n_lv] int ytimes_trend;</span></span>
<span id="cb6-17"><a href="#cb6-17" tabindex="-1"></a><span class="co">#&gt;   int&lt;lower=0&gt; n_nonmissing; // number of nonmissing observations</span></span>
<span id="cb6-18"><a href="#cb6-18" tabindex="-1"></a><span class="co">#&gt;   array[total_obs] int&lt;lower=0&gt; cap; // upper limits of latent abundances</span></span>
<span id="cb6-19"><a href="#cb6-19" tabindex="-1"></a><span class="co">#&gt;   array[total_obs] int ytimes_array; // sorted ytimes</span></span>
<span id="cb6-20"><a href="#cb6-20" tabindex="-1"></a><span class="co">#&gt;   array[n, n_series] int&lt;lower=0&gt; ytimes_pred; // time-ordered matrix for prediction</span></span>
<span id="cb6-21"><a href="#cb6-21" tabindex="-1"></a><span class="co">#&gt;   int&lt;lower=0&gt; K_groups; // number of unique replicated observations</span></span>
<span id="cb6-22"><a href="#cb6-22" tabindex="-1"></a><span class="co">#&gt;   int&lt;lower=0&gt; K_reps; // maximum number of replicate observations</span></span>
<span id="cb6-23"><a href="#cb6-23" tabindex="-1"></a><span class="co">#&gt;   array[K_groups] int&lt;lower=0&gt; K_starts; // col of K_inds where each group starts</span></span>
<span id="cb6-24"><a href="#cb6-24" tabindex="-1"></a><span class="co">#&gt;   array[K_groups] int&lt;lower=0&gt; K_stops; // col of K_inds where each group ends</span></span>
<span id="cb6-25"><a href="#cb6-25" tabindex="-1"></a><span class="co">#&gt;   array[K_groups, K_reps] int&lt;lower=0&gt; K_inds; // indices of replicated observations</span></span>
<span id="cb6-26"><a href="#cb6-26" tabindex="-1"></a><span class="co">#&gt;   matrix[3, 6] S_trend1; // mgcv smooth penalty matrix S_trend1</span></span>
<span id="cb6-27"><a href="#cb6-27" tabindex="-1"></a><span class="co">#&gt;   matrix[3, 6] S_trend2; // mgcv smooth penalty matrix S_trend2</span></span>
<span id="cb6-28"><a href="#cb6-28" tabindex="-1"></a><span class="co">#&gt;   array[total_obs] int&lt;lower=0&gt; flat_ys; // flattened observations</span></span>
<span id="cb6-29"><a href="#cb6-29" tabindex="-1"></a><span class="co">#&gt; }</span></span>
<span id="cb6-30"><a href="#cb6-30" tabindex="-1"></a><span class="co">#&gt; transformed data {</span></span>
<span id="cb6-31"><a href="#cb6-31" tabindex="-1"></a><span class="co">#&gt;   matrix[total_obs, num_basis] X_ordered = X[ytimes_array,  : ];</span></span>
<span id="cb6-32"><a href="#cb6-32" tabindex="-1"></a><span class="co">#&gt;   array[K_groups] int&lt;lower=0&gt; Y_max;</span></span>
<span id="cb6-33"><a href="#cb6-33" tabindex="-1"></a><span class="co">#&gt;   array[K_groups] int&lt;lower=0&gt; N_max;</span></span>
<span id="cb6-34"><a href="#cb6-34" tabindex="-1"></a><span class="co">#&gt;   for (k in 1 : K_groups) {</span></span>
<span id="cb6-35"><a href="#cb6-35" tabindex="-1"></a><span class="co">#&gt;     Y_max[k] = max(flat_ys[K_inds[k, K_starts[k] : K_stops[k]]]);</span></span>
<span id="cb6-36"><a href="#cb6-36" tabindex="-1"></a><span class="co">#&gt;     N_max[k] = max(cap[K_inds[k, K_starts[k] : K_stops[k]]]);</span></span>
<span id="cb6-37"><a href="#cb6-37" tabindex="-1"></a><span class="co">#&gt;   }</span></span>
<span id="cb6-38"><a href="#cb6-38" tabindex="-1"></a><span class="co">#&gt; }</span></span>
<span id="cb6-39"><a href="#cb6-39" tabindex="-1"></a><span class="co">#&gt; parameters {</span></span>
<span id="cb6-40"><a href="#cb6-40" tabindex="-1"></a><span class="co">#&gt;   // raw basis coefficients</span></span>
<span id="cb6-41"><a href="#cb6-41" tabindex="-1"></a><span class="co">#&gt;   vector[num_basis] b_raw;</span></span>
<span id="cb6-42"><a href="#cb6-42" tabindex="-1"></a><span class="co">#&gt;   vector[num_basis_trend] b_raw_trend;</span></span>
<span id="cb6-43"><a href="#cb6-43" tabindex="-1"></a><span class="co">#&gt;   </span></span>
<span id="cb6-44"><a href="#cb6-44" tabindex="-1"></a><span class="co">#&gt;   // smoothing parameters</span></span>
<span id="cb6-45"><a href="#cb6-45" tabindex="-1"></a><span class="co">#&gt;   vector&lt;lower=0&gt;[n_sp_trend] lambda_trend;</span></span>
<span id="cb6-46"><a href="#cb6-46" tabindex="-1"></a><span class="co">#&gt; }</span></span>
<span id="cb6-47"><a href="#cb6-47" tabindex="-1"></a><span class="co">#&gt; transformed parameters {</span></span>
<span id="cb6-48"><a href="#cb6-48" tabindex="-1"></a><span class="co">#&gt;   // detection probability</span></span>
<span id="cb6-49"><a href="#cb6-49" tabindex="-1"></a><span class="co">#&gt;   vector[total_obs] p;</span></span>
<span id="cb6-50"><a href="#cb6-50" tabindex="-1"></a><span class="co">#&gt;   </span></span>
<span id="cb6-51"><a href="#cb6-51" tabindex="-1"></a><span class="co">#&gt;   // latent states</span></span>
<span id="cb6-52"><a href="#cb6-52" tabindex="-1"></a><span class="co">#&gt;   matrix[n, n_lv] LV;</span></span>
<span id="cb6-53"><a href="#cb6-53" tabindex="-1"></a><span class="co">#&gt;   </span></span>
<span id="cb6-54"><a href="#cb6-54" tabindex="-1"></a><span class="co">#&gt;   // latent states and loading matrix</span></span>
<span id="cb6-55"><a href="#cb6-55" tabindex="-1"></a><span class="co">#&gt;   vector[n * n_lv] trend_mus;</span></span>
<span id="cb6-56"><a href="#cb6-56" tabindex="-1"></a><span class="co">#&gt;   matrix[n, n_series] trend;</span></span>
<span id="cb6-57"><a href="#cb6-57" tabindex="-1"></a><span class="co">#&gt;   </span></span>
<span id="cb6-58"><a href="#cb6-58" tabindex="-1"></a><span class="co">#&gt;   // basis coefficients</span></span>
<span id="cb6-59"><a href="#cb6-59" tabindex="-1"></a><span class="co">#&gt;   vector[num_basis] b;</span></span>
<span id="cb6-60"><a href="#cb6-60" tabindex="-1"></a><span class="co">#&gt;   vector[num_basis_trend] b_trend;</span></span>
<span id="cb6-61"><a href="#cb6-61" tabindex="-1"></a><span class="co">#&gt;   </span></span>
<span id="cb6-62"><a href="#cb6-62" tabindex="-1"></a><span class="co">#&gt;   // observation model basis coefficients</span></span>
<span id="cb6-63"><a href="#cb6-63" tabindex="-1"></a><span class="co">#&gt;   b[1 : num_basis] = b_raw[1 : num_basis];</span></span>
<span id="cb6-64"><a href="#cb6-64" tabindex="-1"></a><span class="co">#&gt;   </span></span>
<span id="cb6-65"><a href="#cb6-65" tabindex="-1"></a><span class="co">#&gt;   // process model basis coefficients</span></span>
<span id="cb6-66"><a href="#cb6-66" tabindex="-1"></a><span class="co">#&gt;   b_trend[1 : num_basis_trend] = b_raw_trend[1 : num_basis_trend];</span></span>
<span id="cb6-67"><a href="#cb6-67" tabindex="-1"></a><span class="co">#&gt;   </span></span>
<span id="cb6-68"><a href="#cb6-68" tabindex="-1"></a><span class="co">#&gt;   // detection probability</span></span>
<span id="cb6-69"><a href="#cb6-69" tabindex="-1"></a><span class="co">#&gt;   p = X_ordered * b;</span></span>
<span id="cb6-70"><a href="#cb6-70" tabindex="-1"></a><span class="co">#&gt;   </span></span>
<span id="cb6-71"><a href="#cb6-71" tabindex="-1"></a><span class="co">#&gt;   // latent process linear predictors</span></span>
<span id="cb6-72"><a href="#cb6-72" tabindex="-1"></a><span class="co">#&gt;   trend_mus = X_trend * b_trend;</span></span>
<span id="cb6-73"><a href="#cb6-73" tabindex="-1"></a><span class="co">#&gt;   for (j in 1 : n_lv) {</span></span>
<span id="cb6-74"><a href="#cb6-74" tabindex="-1"></a><span class="co">#&gt;     LV[1 : n, j] = trend_mus[ytimes_trend[1 : n, j]];</span></span>
<span id="cb6-75"><a href="#cb6-75" tabindex="-1"></a><span class="co">#&gt;   }</span></span>
<span id="cb6-76"><a href="#cb6-76" tabindex="-1"></a><span class="co">#&gt;   </span></span>
<span id="cb6-77"><a href="#cb6-77" tabindex="-1"></a><span class="co">#&gt;   // derived latent states</span></span>
<span id="cb6-78"><a href="#cb6-78" tabindex="-1"></a><span class="co">#&gt;   for (i in 1 : n) {</span></span>
<span id="cb6-79"><a href="#cb6-79" tabindex="-1"></a><span class="co">#&gt;     for (s in 1 : n_series) {</span></span>
<span id="cb6-80"><a href="#cb6-80" tabindex="-1"></a><span class="co">#&gt;       trend[i, s] = dot_product(Z[s,  : ], LV[i,  : ]);</span></span>
<span id="cb6-81"><a href="#cb6-81" tabindex="-1"></a><span class="co">#&gt;     }</span></span>
<span id="cb6-82"><a href="#cb6-82" tabindex="-1"></a><span class="co">#&gt;   }</span></span>
<span id="cb6-83"><a href="#cb6-83" tabindex="-1"></a><span class="co">#&gt; }</span></span>
<span id="cb6-84"><a href="#cb6-84" tabindex="-1"></a><span class="co">#&gt; model {</span></span>
<span id="cb6-85"><a href="#cb6-85" tabindex="-1"></a><span class="co">#&gt;   // prior for speciessp_1...</span></span>
<span id="cb6-86"><a href="#cb6-86" tabindex="-1"></a><span class="co">#&gt;   b_raw[1] ~ std_normal();</span></span>
<span id="cb6-87"><a href="#cb6-87" tabindex="-1"></a><span class="co">#&gt;   </span></span>
<span id="cb6-88"><a href="#cb6-88" tabindex="-1"></a><span class="co">#&gt;   // prior for speciessp_2...</span></span>
<span id="cb6-89"><a href="#cb6-89" tabindex="-1"></a><span class="co">#&gt;   b_raw[2] ~ std_normal();</span></span>
<span id="cb6-90"><a href="#cb6-90" tabindex="-1"></a><span class="co">#&gt;   </span></span>
<span id="cb6-91"><a href="#cb6-91" tabindex="-1"></a><span class="co">#&gt;   // dynamic process models</span></span>
<span id="cb6-92"><a href="#cb6-92" tabindex="-1"></a><span class="co">#&gt;   </span></span>
<span id="cb6-93"><a href="#cb6-93" tabindex="-1"></a><span class="co">#&gt;   // prior for (Intercept)_trend...</span></span>
<span id="cb6-94"><a href="#cb6-94" tabindex="-1"></a><span class="co">#&gt;   b_raw_trend[1] ~ normal(1, 1.5);</span></span>
<span id="cb6-95"><a href="#cb6-95" tabindex="-1"></a><span class="co">#&gt;   </span></span>
<span id="cb6-96"><a href="#cb6-96" tabindex="-1"></a><span class="co">#&gt;   // prior for speciessp_2_trend...</span></span>
<span id="cb6-97"><a href="#cb6-97" tabindex="-1"></a><span class="co">#&gt;   b_raw_trend[2] ~ std_normal();</span></span>
<span id="cb6-98"><a href="#cb6-98" tabindex="-1"></a><span class="co">#&gt;   </span></span>
<span id="cb6-99"><a href="#cb6-99" tabindex="-1"></a><span class="co">#&gt;   // prior for s(time):trendtrend1_trend...</span></span>
<span id="cb6-100"><a href="#cb6-100" tabindex="-1"></a><span class="co">#&gt;   b_raw_trend[3 : 5] ~ multi_normal_prec(zero_trend[3 : 5],</span></span>
<span id="cb6-101"><a href="#cb6-101" tabindex="-1"></a><span class="co">#&gt;                                          S_trend1[1 : 3, 1 : 3]</span></span>
<span id="cb6-102"><a href="#cb6-102" tabindex="-1"></a><span class="co">#&gt;                                          * lambda_trend[1]</span></span>
<span id="cb6-103"><a href="#cb6-103" tabindex="-1"></a><span class="co">#&gt;                                          + S_trend1[1 : 3, 4 : 6]</span></span>
<span id="cb6-104"><a href="#cb6-104" tabindex="-1"></a><span class="co">#&gt;                                            * lambda_trend[2]);</span></span>
<span id="cb6-105"><a href="#cb6-105" tabindex="-1"></a><span class="co">#&gt;   </span></span>
<span id="cb6-106"><a href="#cb6-106" tabindex="-1"></a><span class="co">#&gt;   // prior for s(time):trendtrend2_trend...</span></span>
<span id="cb6-107"><a href="#cb6-107" tabindex="-1"></a><span class="co">#&gt;   b_raw_trend[6 : 8] ~ multi_normal_prec(zero_trend[6 : 8],</span></span>
<span id="cb6-108"><a href="#cb6-108" tabindex="-1"></a><span class="co">#&gt;                                          S_trend2[1 : 3, 1 : 3]</span></span>
<span id="cb6-109"><a href="#cb6-109" tabindex="-1"></a><span class="co">#&gt;                                          * lambda_trend[3]</span></span>
<span id="cb6-110"><a href="#cb6-110" tabindex="-1"></a><span class="co">#&gt;                                          + S_trend2[1 : 3, 4 : 6]</span></span>
<span id="cb6-111"><a href="#cb6-111" tabindex="-1"></a><span class="co">#&gt;                                            * lambda_trend[4]);</span></span>
<span id="cb6-112"><a href="#cb6-112" tabindex="-1"></a><span class="co">#&gt;   lambda_trend ~ normal(5, 30);</span></span>
<span id="cb6-113"><a href="#cb6-113" tabindex="-1"></a><span class="co">#&gt;   {</span></span>
<span id="cb6-114"><a href="#cb6-114" tabindex="-1"></a><span class="co">#&gt;     // likelihood functions</span></span>
<span id="cb6-115"><a href="#cb6-115" tabindex="-1"></a><span class="co">#&gt;     array[total_obs] real flat_trends;</span></span>
<span id="cb6-116"><a href="#cb6-116" tabindex="-1"></a><span class="co">#&gt;     array[total_obs] real flat_ps;</span></span>
<span id="cb6-117"><a href="#cb6-117" tabindex="-1"></a><span class="co">#&gt;     flat_trends = to_array_1d(trend);</span></span>
<span id="cb6-118"><a href="#cb6-118" tabindex="-1"></a><span class="co">#&gt;     flat_ps = to_array_1d(p);</span></span>
<span id="cb6-119"><a href="#cb6-119" tabindex="-1"></a><span class="co">#&gt;     </span></span>
<span id="cb6-120"><a href="#cb6-120" tabindex="-1"></a><span class="co">#&gt;     // loop over replicate sampling window (each site*time*species combination)</span></span>
<span id="cb6-121"><a href="#cb6-121" tabindex="-1"></a><span class="co">#&gt;     for (k in 1 : K_groups) {</span></span>
<span id="cb6-122"><a href="#cb6-122" tabindex="-1"></a><span class="co">#&gt;       // all log_lambdas are identical because they represent site*time</span></span>
<span id="cb6-123"><a href="#cb6-123" tabindex="-1"></a><span class="co">#&gt;       // covariates; so just use the first measurement</span></span>
<span id="cb6-124"><a href="#cb6-124" tabindex="-1"></a><span class="co">#&gt;       real log_lambda = flat_trends[K_inds[k, 1]];</span></span>
<span id="cb6-125"><a href="#cb6-125" tabindex="-1"></a><span class="co">#&gt;       vector[N_max[k] - Y_max[k] + 1] terms;</span></span>
<span id="cb6-126"><a href="#cb6-126" tabindex="-1"></a><span class="co">#&gt;       int l = 0;</span></span>
<span id="cb6-127"><a href="#cb6-127" tabindex="-1"></a><span class="co">#&gt;       </span></span>
<span id="cb6-128"><a href="#cb6-128" tabindex="-1"></a><span class="co">#&gt;       // marginalize over latent abundance</span></span>
<span id="cb6-129"><a href="#cb6-129" tabindex="-1"></a><span class="co">#&gt;       for (Ni in Y_max[k] : N_max[k]) {</span></span>
<span id="cb6-130"><a href="#cb6-130" tabindex="-1"></a><span class="co">#&gt;         l = l + 1;</span></span>
<span id="cb6-131"><a href="#cb6-131" tabindex="-1"></a><span class="co">#&gt;         // factor for poisson prob of latent Ni; compute</span></span>
<span id="cb6-132"><a href="#cb6-132" tabindex="-1"></a><span class="co">#&gt;         </span></span>
<span id="cb6-133"><a href="#cb6-133" tabindex="-1"></a><span class="co">#&gt;         // only once per sampling window</span></span>
<span id="cb6-134"><a href="#cb6-134" tabindex="-1"></a><span class="co">#&gt;         terms[l] = poisson_log_lpmf(Ni | log_lambda)</span></span>
<span id="cb6-135"><a href="#cb6-135" tabindex="-1"></a><span class="co">#&gt;                    + // for each replicate observation, binomial prob observed is</span></span>
<span id="cb6-136"><a href="#cb6-136" tabindex="-1"></a><span class="co">#&gt;                    // computed in a vectorized statement</span></span>
<span id="cb6-137"><a href="#cb6-137" tabindex="-1"></a><span class="co">#&gt;                    binomial_logit_lpmf(flat_ys[K_inds[k, K_starts[k] : K_stops[k]]] | Ni, flat_ps[K_inds[k, K_starts[k] : K_stops[k]]]);</span></span>
<span id="cb6-138"><a href="#cb6-138" tabindex="-1"></a><span class="co">#&gt;       }</span></span>
<span id="cb6-139"><a href="#cb6-139" tabindex="-1"></a><span class="co">#&gt;       target += log_sum_exp(terms);</span></span>
<span id="cb6-140"><a href="#cb6-140" tabindex="-1"></a><span class="co">#&gt;     }</span></span>
<span id="cb6-141"><a href="#cb6-141" tabindex="-1"></a><span class="co">#&gt;   }</span></span>
<span id="cb6-142"><a href="#cb6-142" tabindex="-1"></a><span class="co">#&gt; }</span></span>
<span id="cb6-143"><a href="#cb6-143" tabindex="-1"></a><span class="co">#&gt; generated quantities {</span></span>
<span id="cb6-144"><a href="#cb6-144" tabindex="-1"></a><span class="co">#&gt;   vector[n_lv] penalty = rep_vector(1e12, n_lv);</span></span>
<span id="cb6-145"><a href="#cb6-145" tabindex="-1"></a><span class="co">#&gt;   vector[n_sp_trend] rho_trend = log(lambda_trend);</span></span>
<span id="cb6-146"><a href="#cb6-146" tabindex="-1"></a><span class="co">#&gt; }</span></span></code></pre></div>
<p>The posterior summary of this model shows that it has converged
nicely</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="fu">summary</span>(mod)</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a><span class="co">#&gt; GAM observation formula:</span></span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a><span class="co">#&gt; obs ~ species - 1</span></span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a><span class="co">#&gt; &lt;environment: 0x0000025edbcf4058&gt;</span></span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a><span class="co">#&gt; GAM process formula:</span></span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a><span class="co">#&gt; ~s(time, by = trend, k = 4) + species</span></span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a><span class="co">#&gt; &lt;environment: 0x0000025edbcf4058&gt;</span></span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a><span class="co">#&gt; Family:</span></span>
<span id="cb7-11"><a href="#cb7-11" tabindex="-1"></a><span class="co">#&gt; nmix</span></span>
<span id="cb7-12"><a href="#cb7-12" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-13"><a href="#cb7-13" tabindex="-1"></a><span class="co">#&gt; Link function:</span></span>
<span id="cb7-14"><a href="#cb7-14" tabindex="-1"></a><span class="co">#&gt; log</span></span>
<span id="cb7-15"><a href="#cb7-15" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-16"><a href="#cb7-16" tabindex="-1"></a><span class="co">#&gt; Trend model:</span></span>
<span id="cb7-17"><a href="#cb7-17" tabindex="-1"></a><span class="co">#&gt; None</span></span>
<span id="cb7-18"><a href="#cb7-18" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-19"><a href="#cb7-19" tabindex="-1"></a><span class="co">#&gt; N process models:</span></span>
<span id="cb7-20"><a href="#cb7-20" tabindex="-1"></a><span class="co">#&gt; 2 </span></span>
<span id="cb7-21"><a href="#cb7-21" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-22"><a href="#cb7-22" tabindex="-1"></a><span class="co">#&gt; N series:</span></span>
<span id="cb7-23"><a href="#cb7-23" tabindex="-1"></a><span class="co">#&gt; 10 </span></span>
<span id="cb7-24"><a href="#cb7-24" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-25"><a href="#cb7-25" tabindex="-1"></a><span class="co">#&gt; N timepoints:</span></span>
<span id="cb7-26"><a href="#cb7-26" tabindex="-1"></a><span class="co">#&gt; 6 </span></span>
<span id="cb7-27"><a href="#cb7-27" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-28"><a href="#cb7-28" tabindex="-1"></a><span class="co">#&gt; Status:</span></span>
<span id="cb7-29"><a href="#cb7-29" tabindex="-1"></a><span class="co">#&gt; Fitted using Stan </span></span>
<span id="cb7-30"><a href="#cb7-30" tabindex="-1"></a><span class="co">#&gt; 4 chains, each with iter = 1500; warmup = 500; thin = 1 </span></span>
<span id="cb7-31"><a href="#cb7-31" tabindex="-1"></a><span class="co">#&gt; Total post-warmup draws = 4000</span></span>
<span id="cb7-32"><a href="#cb7-32" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-33"><a href="#cb7-33" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-34"><a href="#cb7-34" tabindex="-1"></a><span class="co">#&gt; GAM observation model coefficient (beta) estimates:</span></span>
<span id="cb7-35"><a href="#cb7-35" tabindex="-1"></a><span class="co">#&gt;              2.5%   50% 97.5% Rhat n_eff</span></span>
<span id="cb7-36"><a href="#cb7-36" tabindex="-1"></a><span class="co">#&gt; speciessp_1 -0.29 0.710  1.40    1  1582</span></span>
<span id="cb7-37"><a href="#cb7-37" tabindex="-1"></a><span class="co">#&gt; speciessp_2 -1.20 0.012  0.89    1  2164</span></span>
<span id="cb7-38"><a href="#cb7-38" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-39"><a href="#cb7-39" tabindex="-1"></a><span class="co">#&gt; GAM process model coefficient (beta) estimates:</span></span>
<span id="cb7-40"><a href="#cb7-40" tabindex="-1"></a><span class="co">#&gt;                               2.5%     50%  97.5% Rhat n_eff</span></span>
<span id="cb7-41"><a href="#cb7-41" tabindex="-1"></a><span class="co">#&gt; (Intercept)_trend            2.700  3.0000  3.400    1  1397</span></span>
<span id="cb7-42"><a href="#cb7-42" tabindex="-1"></a><span class="co">#&gt; speciessp_2_trend           -1.200 -0.6200  0.140    1  1532</span></span>
<span id="cb7-43"><a href="#cb7-43" tabindex="-1"></a><span class="co">#&gt; s(time):trendtrend1.1_trend -0.078  0.0160  0.210    1   760</span></span>
<span id="cb7-44"><a href="#cb7-44" tabindex="-1"></a><span class="co">#&gt; s(time):trendtrend1.2_trend -0.240  0.0043  0.260    1  2660</span></span>
<span id="cb7-45"><a href="#cb7-45" tabindex="-1"></a><span class="co">#&gt; s(time):trendtrend1.3_trend -0.460 -0.2500 -0.038    1  1621</span></span>
<span id="cb7-46"><a href="#cb7-46" tabindex="-1"></a><span class="co">#&gt; s(time):trendtrend2.1_trend -0.210 -0.0140  0.082    1   915</span></span>
<span id="cb7-47"><a href="#cb7-47" tabindex="-1"></a><span class="co">#&gt; s(time):trendtrend2.2_trend -0.190  0.0280  0.410    1  1079</span></span>
<span id="cb7-48"><a href="#cb7-48" tabindex="-1"></a><span class="co">#&gt; s(time):trendtrend2.3_trend  0.061  0.3300  0.630    1  2273</span></span>
<span id="cb7-49"><a href="#cb7-49" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-50"><a href="#cb7-50" tabindex="-1"></a><span class="co">#&gt; Approximate significance of GAM process smooths:</span></span>
<span id="cb7-51"><a href="#cb7-51" tabindex="-1"></a><span class="co">#&gt;                        edf Ref.df Chi.sq p-value</span></span>
<span id="cb7-52"><a href="#cb7-52" tabindex="-1"></a><span class="co">#&gt; s(time):seriestrend1 1.042      3   1.69    0.83</span></span>
<span id="cb7-53"><a href="#cb7-53" tabindex="-1"></a><span class="co">#&gt; s(time):seriestrend2 0.937      3   4.33    0.86</span></span>
<span id="cb7-54"><a href="#cb7-54" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-55"><a href="#cb7-55" tabindex="-1"></a><span class="co">#&gt; Stan MCMC diagnostics:</span></span>
<span id="cb7-56"><a href="#cb7-56" tabindex="-1"></a><span class="co">#&gt; n_eff / iter looks reasonable for all parameters</span></span>
<span id="cb7-57"><a href="#cb7-57" tabindex="-1"></a><span class="co">#&gt; Rhat looks reasonable for all parameters</span></span>
<span id="cb7-58"><a href="#cb7-58" tabindex="-1"></a><span class="co">#&gt; 0 of 4000 iterations ended with a divergence (0%)</span></span>
<span id="cb7-59"><a href="#cb7-59" tabindex="-1"></a><span class="co">#&gt; 0 of 4000 iterations saturated the maximum tree depth of 12 (0%)</span></span>
<span id="cb7-60"><a href="#cb7-60" tabindex="-1"></a><span class="co">#&gt; E-FMI indicated no pathological behavior</span></span>
<span id="cb7-61"><a href="#cb7-61" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-62"><a href="#cb7-62" tabindex="-1"></a><span class="co">#&gt; Samples were drawn using NUTS(diag_e) at Wed Sep 04 12:03:41 PM 2024.</span></span>
<span id="cb7-63"><a href="#cb7-63" tabindex="-1"></a><span class="co">#&gt; For each parameter, n_eff is a crude measure of effective sample size,</span></span>
<span id="cb7-64"><a href="#cb7-64" tabindex="-1"></a><span class="co">#&gt; and Rhat is the potential scale reduction factor on split MCMC chains</span></span>
<span id="cb7-65"><a href="#cb7-65" tabindex="-1"></a><span class="co">#&gt; (at convergence, Rhat = 1)</span></span></code></pre></div>
<p><code>loo()</code> functionality works just as it does for all
<code>mvgam</code> models to aid in model comparison / selection (though
note that Pareto K values often give warnings for mixture models so
these may not be too helpful)</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="fu">loo</span>(mod)</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a><span class="co">#&gt; Computed from 4000 by 60 log-likelihood matrix</span></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a><span class="co">#&gt;          Estimate   SE</span></span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a><span class="co">#&gt; elpd_loo   -225.7 13.2</span></span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a><span class="co">#&gt; p_loo        79.1 12.2</span></span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a><span class="co">#&gt; looic       451.5 26.5</span></span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a><span class="co">#&gt; ------</span></span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a><span class="co">#&gt; Monte Carlo SE of elpd_loo is NA.</span></span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb8-12"><a href="#cb8-12" tabindex="-1"></a><span class="co">#&gt; Pareto k diagnostic values:</span></span>
<span id="cb8-13"><a href="#cb8-13" tabindex="-1"></a><span class="co">#&gt;                          Count Pct.    Min. n_eff</span></span>
<span id="cb8-14"><a href="#cb8-14" tabindex="-1"></a><span class="co">#&gt; (-Inf, 0.5]   (good)     25    41.7%   1649      </span></span>
<span id="cb8-15"><a href="#cb8-15" tabindex="-1"></a><span class="co">#&gt;  (0.5, 0.7]   (ok)        4     6.7%   579       </span></span>
<span id="cb8-16"><a href="#cb8-16" tabindex="-1"></a><span class="co">#&gt;    (0.7, 1]   (bad)       6    10.0%   17        </span></span>
<span id="cb8-17"><a href="#cb8-17" tabindex="-1"></a><span class="co">#&gt;    (1, Inf)   (very bad) 25    41.7%   2         </span></span>
<span id="cb8-18"><a href="#cb8-18" tabindex="-1"></a><span class="co">#&gt; See help(&#39;pareto-k-diagnostic&#39;) for details.</span></span></code></pre></div>
<p>Plot the estimated smooths of time from each species’ latent
abundance process (on the log scale)</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="fu">plot</span>(mod, <span class="at">type =</span> <span class="st">&#39;smooths&#39;</span>, <span class="at">trend_effects =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="data:image/png;base64,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" width="60%" style="display: block; margin: auto;" /></p>
<p><code>marginaleffects</code> support allows for more useful
prediction-based interrogations on different scales (though note that at
the time of writing this Vignette, you must have the development version
of <code>marginaleffects</code> installed for <code>nmix()</code> models
to be supported; use
<code>remotes::install_github(&#39;vincentarelbundock/marginaleffects&#39;)</code>
to install). Objects that use family <code>nmix()</code> have a few
additional prediction scales that can be used (i.e. <code>link</code>,
<code>response</code>, <code>detection</code> or <code>latent_N</code>).
For example, here are the estimated detection probabilities per species,
which show that the model has done a nice job of estimating these
parameters:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a>marginaleffects<span class="sc">::</span><span class="fu">plot_predictions</span>(mod, <span class="at">condition =</span> <span class="st">&#39;species&#39;</span>,</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>                 <span class="at">type =</span> <span class="st">&#39;detection&#39;</span>) <span class="sc">+</span></span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&#39;Pr(detection)&#39;</span>) <span class="sc">+</span></span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&#39;none&#39;</span>)</span></code></pre></div>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAlgAAAHgCAMAAABOyeNrAAAApVBMVEUAAAAAADoAAGYAOpAAZrYzMzM6AAA6ADo6AGY6kNtNTU1NTW5NTY5NbqtNjshmAABmAGZmtv9uTU1uTW5uTY5ubqtuq+SOTU2OTW6OTY6Ojm6OyP+QOgCQkGaQ2/+rbk2rbm6rbo6rq26ryKur5P+2ZgC2///Ijk3I///bkDrb/7bb///kq27k////tmb/yI7/25D/5Kv//7b//8j//9v//+T////xq/pWAAAACXBIWXMAAA9hAAAPYQGoP6dpAAANLklEQVR4nO3di1LbWBaFYedCpiMCNLkYMs6EZNoJZgIxxrHe/9FGR7Z8SYgs073Q2tb/VXVBu1DV2Zy/ZFkY0ssBgV7bC8B+IixIEBYkCAsShAUJwoLEw8MiSdQgLEgQFiQICxKEBQnCggRhQYKwIEFYkCAsSBAWJAgLEoQFCcKCBGFBgrAgQViQqM9j8nZUfpyeZUc3yw9NjkTH1eYxzl6VYc0uBvn1cfWhyZHouro8Lg//mp+xpu9H6eS1+NDgSHReo6fCybubfHo+XHwoHjgoEBZqNAprfFQWtfjQ6Eh03MPOWNuPRMc1CotrLOyqUVizi/78VWGfV4VoZntY6T/uY2FH3HmHBGFBgrAgQViQICxIEBYkCAsShAUJwoIEYUGCsCBBWJAgLEgQFiQICxKEBQnCggRhQYKwIEFYkCAsSBAWJAgLEoQFCcKCBGFBgrAgQViQICxIEBYkCAsShAUJwoIEYUGCsCBBWJAgLEgQFiQICxKEBQnCggRhQYKwIEFYkCAsSBAWJAgLEoQFCcKCBGFBgrAgQViQICxIEBYkCAsShAUJwoIEYUGCsCBBWJAgLEgQFiQICxKEBQnCggRhQYKwIEFYkCAsSOxTWH4r6jDCggRhQYKwIEFYkCAsSBAWJAgLEoQFCcKCBGFBgrAgQViQICxIEBYkCAsShAUJwoIEYUGibjOmZ9nRTfrkOksG5cdXowZHtsNvRR1WsxmziyKl4+r/xkVjl4NmR7bEb0UdVrMZ0/ejfPJ2cYKang/z2adhsyNb4reiDqvZjMm7m7KnUjp1FU+N6QmxcFDw20a/FXVYzWakJ78qrPLj5M36WctvG/1W1GENz1jj+VV8YXmd5beNfivqsIbXWJf96lHCQhO1rwr71avC+RNgOm3NPnO7AQ1sv4+VTlqLZ8TrLDtcvjD020a/FXUYd94hQViQICxIEBYkCAsShAUJwoIEYUGCsCBBWKH5jkxYofmOTFih+Y5MWKH5jkxYofmOTFih+Y5MWKH5jkxYofmOTFih+Y5MWKH5jkxYofmOTFih+Y68R2H17Fak5zvy3oTVK7W9isfmOzBhheY78L6E1et1sizfeQkrNN959yUsngrNEFZovgPvTVjcbvCyR2EZrkjOd2TCCs13ZMIKzXdkwgrNd2TCCs13ZMIKzXdkwgrNd2TCCs13ZMIKzXdkwgrNd2TCCs13ZMIKzXdkwgrNd2TCCs13ZMIKzXdkwgrNd2TCCs13ZMIKzXdkwgrNd2TCCs13ZMIKzXfkjZVdzX+H6uXuR1rwW5Gc78irld2dVEVd9Z583OVIF34rkvMdebmyuz+/rh7d+J9tR9rwW5Gc78hcY4XmOzJhheY78sbKbl+UF+9Ptz8P/nykBb8VyfmOvL6yHx+eP/BID34rkvMdeX1ldyenDzzSg9+K5HxH3jxjEVYwviNvrOx7s6ure4604LciOd+RN58Ke1y8x+I7MrcbQvMdmbBC8x15c2VXzX8GbTiT34rkfEfefHdDurq6O+HdDWH4jnzPfayGrw39ZvJbkZzvyIQVmu/IPBWG5jsyF++h+Y7M7YbQfEcmrNB8R169NfnklB/phOM7Mmes0HxH5nZDaL4jE1ZoviOvVnZV/SOlvWZvUPabyW9Fcr4j89bk0HxH5uI9NN+RN1b248PL5r+q4zeT34rkfEfeWNmX1FTTsvxm8luRnO/IvCoMzXdkwgrNd2TeNhOa78ibK/vO22Zi8R2Z2w2h+Y5MWJH1fEf+5R2kp1fPvj3gSAd+K9Ka/wCu7VX8xuZ9rGf/OznlPlYUYcIq3+t3urrdMD3Ljm7Kz66zLHs1Wnsgd9xGvxVJVe8ZaHsd96sJa3YxyK+Py08vBz89kDtuo9+KpOKElV+lp8Llfazp+1E+eTsqPpt9Gm4+8MuRFvxWpOXcVd19rMm7m3x6npIqngKzbLD2wEHBbyK/FWkFCmvD+KjqaPJmmM5aqwe2HNkSvxWp2WZV+7PC1QmqdDnYfMBvJr8VyfmOXBPW5iVVERbXWHZ8R655z/vsor94EZieA2efR6sHNo904bciOd+R697zPr9tlc5R11l2OMy5j2XHd2R+Vhia78j8rDA035H5WWFoviPX/ayw+ZEe/FYk5zsyYYXmO3LNzwp3OdKC34rkfEfmPe+h+Y7M7YbQfEcmrNB8R16urPo7kfypyEh8R77vF1ab/TEjv5n8ViTnOzK/Yh+a78iEFZrvyPzthtB8R77nPlbDvxfpN5PfiuR8R+Z2Q2i+IxNWaL4jr+5j/bl2yb7xP9uOtOG3IjnfkVcruzuprq6uek8+7nKkC78VyfmOvPlGv/mdd14VhuE7MtdYofmOvL6yHx9i/8sUHeS7CXW//tX8SLTEdxN+egdps1/Q+fVItMN3EzbPWLHfNtNBvpuwTxfvHeS7CYQVmu8mrK3sS9MnwV+ORFt8N2G1si/FlfvVDmX5ztQhvpuwXFl5E2uXO1m+M3WI7yas/TLF6fxfwtz5SLTHdxMIKzTfTSCs0Hw3gbBC892EffqF1Q7y3QRukIbmuwmEFZrvJhBWaL6bQFih+W4CYYXmuwmEFZrvJhBWaL6bQFih+W4CYYXmuwmEFZrvJhBWaL6bQFih+W4CYYXmuwmEFZrvJhBWaL6bQFih+W4CYYXmuwmEFZrvJhBWaL6bQFih+W4CYYXmuwmEFZrvJhBWaL6bQFih+W4CYYXmuwmEFZrvJhBWaL6bQFih+W4CYYXmuwmEFZrvJhBWaL6bQFih+W4CYYXmuwmEFZrvJhBWaL6bQFih+W4CYYXmuwmEFZrvJhBWaL6bQFih+W4CYYXmuwmEFZrvJhBWaL6bQFih+W4CYYXmuwmEFZrvJhBWaL6bQFih+W4CYYXmuwmEFZrvJhBWaL6bQFih+W4CYYXmuwl1K5ueZUc35WeT11k2yPPrLMtejRociUfiuwk1K5tdDPLr4/TZ9HyYT94M88tBsyPxWHw3oWZl0/ejfPI2naDGKa/LwezTsNmReCy+m1Czssm7m/JcNVd8Vjw1ls+IeX5Q8J2pQ3w3oWZl46O1sGYX/fLZcHXW8p2pQ3w3oeEZa3rWXzy6vM7ynalDfDeh0TVW8apwedlOWE58N6H2VWF/8apw0VV6bpx95naDEd9N2H4fqzhppftX6bK9+Hg4bHIkHonvJnDnPTTfTSAsSBAWJAgLEoQFCcKCBGFBgrAgQViQICxIEBYkCAsShAUJwoIEYUGCsCBBWJAgLEgQFiQICxKEBQnCggRhQYKwIEFYkCAsSBAWJAgLEoQFCcKCBGFBgrAgQViQICxIEBYkCAsShAUJwoIEYUGCsCBBWJAgLEgQFiQICxKEBQnCggRhQYKwIEFYkCAsSBAWJAgLEoQFCcKCBGFBgrAgQViQICxIEBYkCAsShAUJwoIEYUGCsCBBWJAgLEgQFiQICxKEBQnCggRhQYKwIEFYkCAsSBAWJAgLEoQFCcKCBGFBgrAgQViQICxIEBYkCAsShAUJwoIEYUGCsCBRl8f0LDu6Wf9s9cCWI9F5NXnMLgb59fHaZ6sHthwJ1OQxfT/KJ29Hq89WD2w5EqjJY/LuJp+eD1efrR44KBAWatTkMT6qOlp8tnpgy5HAw85YW44EuMaCRO2rwv7yVWF//qqwz6tCNLP9PlY6R3EfCzvizjskCAsShAUJwoIEYUGCsCBBWJAgLEgQFiQICxKEBQnCggRhQeJvhGXnoO0FPD6/kf9+WH4O2l7A4/MdmbBC8x2ZsELzHXmfwoIRwoIEYUGCsCBBWJDYz7BWv1bbEZPXWTZoexEb9jKscfaqW2GlP3wweTPc/oWPJ3hY4yw1NH3/3+xw9W29PPxrj89Y9408Tr+ffml1yoodVvprEtfH+fTs6Ga8fpLa46fC34289udaLAQPa/7NnJ4N8tmnte/rPof1m5HTH9ZwEjusdNFaPCGU3+z1Z4I9Dus3I0/P+q2t6F7Bw8rLvwqXvstdOWMlv448eW11gZVHDyv9jcH0XT47Lj9d2uOw7h3Zr6vgYeWX85dI5/9ef1W412HdO/J1lljFFTysObMXRI/BfuQ9CivdfS4cmn/H/xn2I+9FWPBDWJAgLEgQFiQICxKE9Y+5/dfHtpdghLAgQViQIKzmbl/0er3T4invP73es295/uNDr/f06/zj8/lTYfXQ4ks7jLAaK6+hbl+c3r54+vXHh+d5+i+/evYtfbw7ScF9rB6qvrTtJbeIsBq7/ePr/GMKpkjnezo1FUVVF+3rDy2+tMMIq7kv5TPe/MxV1HM1/7s9L8ua5o9XD1Vf2mGEtYu7k+IKahlWus4qrIe1eKj60nZWaYGwdpOe58qnwj++fn+yfAqsPlYPVV/axgpNEFZj5ZmpqGd18V6cn4qUqgv58uJ9/lD1pW0vuUWE1dz34vKpOCWVtxvSFVS6t5BOUT/dbkgPLb60wwhrZ90+EzVFWDsjrCYIa2eE1QRhQYKwIEFYkCAsSBAWJAgLEoQFif8D5LGQYkiCtKkAAAAASUVORK5CYII=" width="60%" style="display: block; margin: auto;" /></p>
<p>A common goal in N-mixture modelling is to estimate the true latent
abundance. The model has automatically generated predictions for the
unknown latent abundance that are conditional on the observations. We
can extract these and produce decent plots using a small function</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a>hc <span class="ot">&lt;-</span> <span class="fu">hindcast</span>(mod, <span class="at">type =</span> <span class="st">&#39;latent_N&#39;</span>)</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a><span class="co"># Function to plot latent abundance estimates vs truth</span></span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a>plot_latentN <span class="ot">=</span> <span class="cf">function</span>(hindcasts, data, <span class="at">species =</span> <span class="st">&#39;sp_1&#39;</span>){</span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a>  all_series <span class="ot">&lt;-</span> <span class="fu">unique</span>(data <span class="sc">%&gt;%</span></span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a>                         dplyr<span class="sc">::</span><span class="fu">filter</span>(species <span class="sc">==</span> <span class="sc">!!</span>species) <span class="sc">%&gt;%</span></span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a>                         dplyr<span class="sc">::</span><span class="fu">pull</span>(series))</span>
<span id="cb11-8"><a href="#cb11-8" tabindex="-1"></a>  </span>
<span id="cb11-9"><a href="#cb11-9" tabindex="-1"></a>  <span class="co"># Grab the first replicate that represents this series</span></span>
<span id="cb11-10"><a href="#cb11-10" tabindex="-1"></a>  <span class="co"># so we can get the true simulated values</span></span>
<span id="cb11-11"><a href="#cb11-11" tabindex="-1"></a>  series <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(all_series[<span class="dv">1</span>])</span>
<span id="cb11-12"><a href="#cb11-12" tabindex="-1"></a>  truths <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb11-13"><a href="#cb11-13" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">arrange</span>(time, series) <span class="sc">%&gt;%</span></span>
<span id="cb11-14"><a href="#cb11-14" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(series <span class="sc">==</span> <span class="sc">!!</span><span class="fu">levels</span>(data<span class="sc">$</span>series)[series]) <span class="sc">%&gt;%</span></span>
<span id="cb11-15"><a href="#cb11-15" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">pull</span>(truth)</span>
<span id="cb11-16"><a href="#cb11-16" tabindex="-1"></a>  </span>
<span id="cb11-17"><a href="#cb11-17" tabindex="-1"></a>  <span class="co"># In case some replicates have missing observations,</span></span>
<span id="cb11-18"><a href="#cb11-18" tabindex="-1"></a>  <span class="co"># pull out predictions for ALL replicates and average over them</span></span>
<span id="cb11-19"><a href="#cb11-19" tabindex="-1"></a>  hcs <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, <span class="fu">lapply</span>(all_series, <span class="cf">function</span>(x){</span>
<span id="cb11-20"><a href="#cb11-20" tabindex="-1"></a>    ind <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">names</span>(hindcasts<span class="sc">$</span>hindcasts) <span class="sc">%in%</span> <span class="fu">as.character</span>(x))</span>
<span id="cb11-21"><a href="#cb11-21" tabindex="-1"></a>    hindcasts<span class="sc">$</span>hindcasts[[ind]]</span>
<span id="cb11-22"><a href="#cb11-22" tabindex="-1"></a>  }))</span>
<span id="cb11-23"><a href="#cb11-23" tabindex="-1"></a>  </span>
<span id="cb11-24"><a href="#cb11-24" tabindex="-1"></a>  <span class="co"># Calculate posterior empirical quantiles of predictions</span></span>
<span id="cb11-25"><a href="#cb11-25" tabindex="-1"></a>  pred_quantiles <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">t</span>(<span class="fu">apply</span>(hcs, <span class="dv">2</span>, <span class="cf">function</span>(x) </span>
<span id="cb11-26"><a href="#cb11-26" tabindex="-1"></a>    <span class="fu">quantile</span>(x, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.2</span>, <span class="fl">0.3</span>, <span class="fl">0.4</span>, </span>
<span id="cb11-27"><a href="#cb11-27" tabindex="-1"></a>                          <span class="fl">0.5</span>, <span class="fl">0.6</span>, <span class="fl">0.7</span>, <span class="fl">0.8</span>, <span class="fl">0.95</span>)))))</span>
<span id="cb11-28"><a href="#cb11-28" tabindex="-1"></a>  pred_quantiles<span class="sc">$</span>time <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">NROW</span>(pred_quantiles)</span>
<span id="cb11-29"><a href="#cb11-29" tabindex="-1"></a>  pred_quantiles<span class="sc">$</span>truth <span class="ot">&lt;-</span> truths</span>
<span id="cb11-30"><a href="#cb11-30" tabindex="-1"></a>  </span>
<span id="cb11-31"><a href="#cb11-31" tabindex="-1"></a>  <span class="co"># Grab observations</span></span>
<span id="cb11-32"><a href="#cb11-32" tabindex="-1"></a>  data <span class="sc">%&gt;%</span></span>
<span id="cb11-33"><a href="#cb11-33" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(series <span class="sc">%in%</span> all_series) <span class="sc">%&gt;%</span></span>
<span id="cb11-34"><a href="#cb11-34" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(time, obs) <span class="ot">-&gt;</span> observations</span>
<span id="cb11-35"><a href="#cb11-35" tabindex="-1"></a>  </span>
<span id="cb11-36"><a href="#cb11-36" tabindex="-1"></a>  <span class="co"># Plot</span></span>
<span id="cb11-37"><a href="#cb11-37" tabindex="-1"></a>  <span class="fu">ggplot</span>(pred_quantiles, <span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">group =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb11-38"><a href="#cb11-38" tabindex="-1"></a>    <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> X5., <span class="at">ymax =</span> X95.), <span class="at">fill =</span> <span class="st">&quot;#DCBCBC&quot;</span>) <span class="sc">+</span> </span>
<span id="cb11-39"><a href="#cb11-39" tabindex="-1"></a>    <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> X30., <span class="at">ymax =</span> X70.), <span class="at">fill =</span> <span class="st">&quot;#B97C7C&quot;</span>) <span class="sc">+</span></span>
<span id="cb11-40"><a href="#cb11-40" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> truth),</span>
<span id="cb11-41"><a href="#cb11-41" tabindex="-1"></a>              <span class="at">colour =</span> <span class="st">&#39;black&#39;</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb11-42"><a href="#cb11-42" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> truth),</span>
<span id="cb11-43"><a href="#cb11-43" tabindex="-1"></a>               <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">colour =</span> <span class="st">&#39;white&#39;</span>, <span class="at">fill =</span> <span class="st">&#39;black&#39;</span>,</span>
<span id="cb11-44"><a href="#cb11-44" tabindex="-1"></a>               <span class="at">size =</span> <span class="fl">2.5</span>) <span class="sc">+</span></span>
<span id="cb11-45"><a href="#cb11-45" tabindex="-1"></a>    <span class="fu">geom_jitter</span>(<span class="at">data =</span> observations, <span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> obs),</span>
<span id="cb11-46"><a href="#cb11-46" tabindex="-1"></a>                <span class="at">width =</span> <span class="fl">0.06</span>, </span>
<span id="cb11-47"><a href="#cb11-47" tabindex="-1"></a>                <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">fill =</span> <span class="st">&#39;darkred&#39;</span>, <span class="at">colour =</span> <span class="st">&#39;white&#39;</span>, <span class="at">size =</span> <span class="fl">2.5</span>) <span class="sc">+</span></span>
<span id="cb11-48"><a href="#cb11-48" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&#39;Latent abundance (N)&#39;</span>,</span>
<span id="cb11-49"><a href="#cb11-49" tabindex="-1"></a>         <span class="at">x =</span> <span class="st">&#39;Time&#39;</span>,</span>
<span id="cb11-50"><a href="#cb11-50" tabindex="-1"></a>         <span class="at">title =</span> species)</span>
<span id="cb11-51"><a href="#cb11-51" tabindex="-1"></a>}</span></code></pre></div>
<p>Latent abundance plots vs the simulated truths for each species are
shown below. Here, the red points show the imperfect observations, the
black line shows the true latent abundance, and the ribbons show
credible intervals of our estimates:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="fu">plot_latentN</span>(hc, testdat, <span class="at">species =</span> <span class="st">&#39;sp_1&#39;</span>)</span></code></pre></div>
<p><img src="data:image/png;base64,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" width="60%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="fu">plot_latentN</span>(hc, testdat, <span class="at">species =</span> <span class="st">&#39;sp_2&#39;</span>)</span></code></pre></div>
<p><img src="data:image/png;base64,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" width="60%" style="display: block; margin: auto;" /></p>
<p>We can see that estimates for both species have correctly captured
the true temporal variation and magnitudes in abundance</p>
</div>
</div>
<div id="example-2-a-larger-survey-with-possible-nonlinear-effects" class="section level2">
<h2>Example 2: a larger survey with possible nonlinear effects</h2>
<p>Now for another example with a larger dataset. We will use data from
<a href="https://doserlab.com/files/spabundance-web/articles/nmixturemodels" target="_blank">Jeff Doser’s simulation example from the wonderful
<code>spAbundance</code> package</a>. The simulated data include one
continuous site-level covariate, one factor site-level covariate and two
continuous sample-level covariates. This example will allow us to
examine how we can include possibly nonlinear effects in the latent
process and detection probability models.</p>
<p>Download the data and grab observations / covariate measurements for
one species</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="co"># Date link</span></span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a><span class="fu">load</span>(<span class="fu">url</span>(<span class="st">&#39;https://github.com/doserjef/spAbundance/raw/main/data/dataNMixSim.rda&#39;</span>))</span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a>data.one.sp <span class="ot">&lt;-</span> dataNMixSim</span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a><span class="co"># Pull out observations for one species</span></span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a>data.one.sp<span class="sc">$</span>y <span class="ot">&lt;-</span> data.one.sp<span class="sc">$</span>y[<span class="dv">1</span>, , ]</span>
<span id="cb14-7"><a href="#cb14-7" tabindex="-1"></a></span>
<span id="cb14-8"><a href="#cb14-8" tabindex="-1"></a><span class="co"># Abundance covariates that don&#39;t change across repeat sampling observations</span></span>
<span id="cb14-9"><a href="#cb14-9" tabindex="-1"></a>abund.cov <span class="ot">&lt;-</span> dataNMixSim<span class="sc">$</span>abund.covs[, <span class="dv">1</span>]</span>
<span id="cb14-10"><a href="#cb14-10" tabindex="-1"></a>abund.factor <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(dataNMixSim<span class="sc">$</span>abund.covs[, <span class="dv">2</span>])</span>
<span id="cb14-11"><a href="#cb14-11" tabindex="-1"></a></span>
<span id="cb14-12"><a href="#cb14-12" tabindex="-1"></a><span class="co"># Detection covariates that can change across repeat sampling observations</span></span>
<span id="cb14-13"><a href="#cb14-13" tabindex="-1"></a><span class="co"># Note that `NA`s are not allowed for covariates in mvgam, so we randomly</span></span>
<span id="cb14-14"><a href="#cb14-14" tabindex="-1"></a><span class="co"># impute them here</span></span>
<span id="cb14-15"><a href="#cb14-15" tabindex="-1"></a>det.cov <span class="ot">&lt;-</span> dataNMixSim<span class="sc">$</span>det.covs<span class="sc">$</span>det.cov<span class="fl">.1</span>[,]</span>
<span id="cb14-16"><a href="#cb14-16" tabindex="-1"></a>det.cov[<span class="fu">is.na</span>(det.cov)] <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="fu">length</span>(<span class="fu">which</span>(<span class="fu">is.na</span>(det.cov))))</span>
<span id="cb14-17"><a href="#cb14-17" tabindex="-1"></a>det.cov2 <span class="ot">&lt;-</span> dataNMixSim<span class="sc">$</span>det.covs<span class="sc">$</span>det.cov<span class="fl">.2</span></span>
<span id="cb14-18"><a href="#cb14-18" tabindex="-1"></a>det.cov2[<span class="fu">is.na</span>(det.cov2)] <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="fu">length</span>(<span class="fu">which</span>(<span class="fu">is.na</span>(det.cov2))))</span></code></pre></div>
<p>Next we wrangle into the appropriate ‘long’ data format, adding
indicators of <code>time</code> and <code>series</code> for working in
<code>mvgam</code>. We also add the <code>cap</code> variable to
represent the maximum latent N to marginalize over for each
observation</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a>mod_data <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind,</span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a>                    <span class="fu">lapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">NROW</span>(data.one.sp<span class="sc">$</span>y), <span class="cf">function</span>(x){</span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a>                      <span class="fu">data.frame</span>(<span class="at">y =</span> data.one.sp<span class="sc">$</span>y[x,],</span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a>                                 <span class="at">abund_cov =</span> abund.cov[x],</span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a>                                 <span class="at">abund_fac =</span> abund.factor[x],</span>
<span id="cb15-6"><a href="#cb15-6" tabindex="-1"></a>                                 <span class="at">det_cov =</span> det.cov[x,],</span>
<span id="cb15-7"><a href="#cb15-7" tabindex="-1"></a>                                 <span class="at">det_cov2 =</span> det.cov2[x,],</span>
<span id="cb15-8"><a href="#cb15-8" tabindex="-1"></a>                                 <span class="at">replicate =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">NCOL</span>(data.one.sp<span class="sc">$</span>y),</span>
<span id="cb15-9"><a href="#cb15-9" tabindex="-1"></a>                                 <span class="at">site =</span> <span class="fu">paste0</span>(<span class="st">&#39;site&#39;</span>, x))</span>
<span id="cb15-10"><a href="#cb15-10" tabindex="-1"></a>                    })) <span class="sc">%&gt;%</span></span>
<span id="cb15-11"><a href="#cb15-11" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">species =</span> <span class="st">&#39;sp_1&#39;</span>,</span>
<span id="cb15-12"><a href="#cb15-12" tabindex="-1"></a>                <span class="at">series =</span> <span class="fu">as.factor</span>(<span class="fu">paste0</span>(site, <span class="st">&#39;_&#39;</span>, species, <span class="st">&#39;_&#39;</span>, replicate))) <span class="sc">%&gt;%</span></span>
<span id="cb15-13"><a href="#cb15-13" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">site =</span> <span class="fu">factor</span>(site, <span class="at">levels =</span> <span class="fu">unique</span>(site)),</span>
<span id="cb15-14"><a href="#cb15-14" tabindex="-1"></a>                <span class="at">species =</span> <span class="fu">factor</span>(species, <span class="at">levels =</span> <span class="fu">unique</span>(species)),</span>
<span id="cb15-15"><a href="#cb15-15" tabindex="-1"></a>                <span class="at">time =</span> <span class="dv">1</span>,</span>
<span id="cb15-16"><a href="#cb15-16" tabindex="-1"></a>                <span class="at">cap =</span> <span class="fu">max</span>(data.one.sp<span class="sc">$</span>y, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">+</span> <span class="dv">20</span>)</span></code></pre></div>
<p>The data include observations for 225 sites with three replicates per
site, though some observations are missing</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="fu">NROW</span>(mod_data)</span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a><span class="co">#&gt; [1] 675</span></span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">glimpse</span>(mod_data)</span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a><span class="co">#&gt; Rows: 675</span></span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a><span class="co">#&gt; Columns: 11</span></span>
<span id="cb16-6"><a href="#cb16-6" tabindex="-1"></a><span class="co">#&gt; $ y         &lt;int&gt; 1, NA, NA, NA, 2, 2, NA, 1, NA, NA, 0, 1, 0, 0, 0, 0, NA, NA…</span></span>
<span id="cb16-7"><a href="#cb16-7" tabindex="-1"></a><span class="co">#&gt; $ abund_cov &lt;dbl&gt; -0.3734384, -0.3734384, -0.3734384, 0.7064305, 0.7064305, 0.…</span></span>
<span id="cb16-8"><a href="#cb16-8" tabindex="-1"></a><span class="co">#&gt; $ abund_fac &lt;fct&gt; 3, 3, 3, 4, 4, 4, 9, 9, 9, 2, 2, 2, 3, 3, 3, 2, 2, 2, 1, 1, …</span></span>
<span id="cb16-9"><a href="#cb16-9" tabindex="-1"></a><span class="co">#&gt; $ det_cov   &lt;dbl&gt; -1.2827999, -0.9044467, -1.7369637, -3.0537476, 0.1954809, 0…</span></span>
<span id="cb16-10"><a href="#cb16-10" tabindex="-1"></a><span class="co">#&gt; $ det_cov2  &lt;dbl&gt; 2.03047314, -0.08574977, -2.06259523, -0.69356429, 1.0455536…</span></span>
<span id="cb16-11"><a href="#cb16-11" tabindex="-1"></a><span class="co">#&gt; $ replicate &lt;int&gt; 1, 2, 3, 1, 2, 3, 1, 2, 3, 1, 2, 3, 1, 2, 3, 1, 2, 3, 1, 2, …</span></span>
<span id="cb16-12"><a href="#cb16-12" tabindex="-1"></a><span class="co">#&gt; $ site      &lt;fct&gt; site1, site1, site1, site2, site2, site2, site3, site3, site…</span></span>
<span id="cb16-13"><a href="#cb16-13" tabindex="-1"></a><span class="co">#&gt; $ species   &lt;fct&gt; sp_1, sp_1, sp_1, sp_1, sp_1, sp_1, sp_1, sp_1, sp_1, sp_1, …</span></span>
<span id="cb16-14"><a href="#cb16-14" tabindex="-1"></a><span class="co">#&gt; $ series    &lt;fct&gt; site1_sp_1_1, site1_sp_1_2, site1_sp_1_3, site2_sp_1_1, site…</span></span>
<span id="cb16-15"><a href="#cb16-15" tabindex="-1"></a><span class="co">#&gt; $ time      &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, …</span></span>
<span id="cb16-16"><a href="#cb16-16" tabindex="-1"></a><span class="co">#&gt; $ cap       &lt;dbl&gt; 33, 33, 33, 33, 33, 33, 33, 33, 33, 33, 33, 33, 33, 33, 33, …</span></span>
<span id="cb16-17"><a href="#cb16-17" tabindex="-1"></a><span class="fu">head</span>(mod_data)</span>
<span id="cb16-18"><a href="#cb16-18" tabindex="-1"></a><span class="co">#&gt;    y  abund_cov abund_fac    det_cov    det_cov2 replicate  site species</span></span>
<span id="cb16-19"><a href="#cb16-19" tabindex="-1"></a><span class="co">#&gt; 1  1 -0.3734384         3 -1.2827999  2.03047314         1 site1    sp_1</span></span>
<span id="cb16-20"><a href="#cb16-20" tabindex="-1"></a><span class="co">#&gt; 2 NA -0.3734384         3 -0.9044467 -0.08574977         2 site1    sp_1</span></span>
<span id="cb16-21"><a href="#cb16-21" tabindex="-1"></a><span class="co">#&gt; 3 NA -0.3734384         3 -1.7369637 -2.06259523         3 site1    sp_1</span></span>
<span id="cb16-22"><a href="#cb16-22" tabindex="-1"></a><span class="co">#&gt; 4 NA  0.7064305         4 -3.0537476 -0.69356429         1 site2    sp_1</span></span>
<span id="cb16-23"><a href="#cb16-23" tabindex="-1"></a><span class="co">#&gt; 5  2  0.7064305         4  0.1954809  1.04555361         2 site2    sp_1</span></span>
<span id="cb16-24"><a href="#cb16-24" tabindex="-1"></a><span class="co">#&gt; 6  2  0.7064305         4  0.9673034  1.91971178         3 site2    sp_1</span></span>
<span id="cb16-25"><a href="#cb16-25" tabindex="-1"></a><span class="co">#&gt;         series time cap</span></span>
<span id="cb16-26"><a href="#cb16-26" tabindex="-1"></a><span class="co">#&gt; 1 site1_sp_1_1    1  33</span></span>
<span id="cb16-27"><a href="#cb16-27" tabindex="-1"></a><span class="co">#&gt; 2 site1_sp_1_2    1  33</span></span>
<span id="cb16-28"><a href="#cb16-28" tabindex="-1"></a><span class="co">#&gt; 3 site1_sp_1_3    1  33</span></span>
<span id="cb16-29"><a href="#cb16-29" tabindex="-1"></a><span class="co">#&gt; 4 site2_sp_1_1    1  33</span></span>
<span id="cb16-30"><a href="#cb16-30" tabindex="-1"></a><span class="co">#&gt; 5 site2_sp_1_2    1  33</span></span>
<span id="cb16-31"><a href="#cb16-31" tabindex="-1"></a><span class="co">#&gt; 6 site2_sp_1_3    1  33</span></span></code></pre></div>
<p>The final step for data preparation is of course the
<code>trend_map</code>, which sets up the mapping between observation
replicates and the latent abundance models. This is done in the same way
as in the example above</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a>mod_data <span class="sc">%&gt;%</span></span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a>  <span class="co"># each unique combination of site*species is a separate process</span></span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">trend =</span> <span class="fu">as.numeric</span>(<span class="fu">factor</span>(<span class="fu">paste0</span>(site, species)))) <span class="sc">%&gt;%</span></span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(trend, series) <span class="sc">%&gt;%</span></span>
<span id="cb17-5"><a href="#cb17-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">distinct</span>() <span class="ot">-&gt;</span> trend_map</span>
<span id="cb17-6"><a href="#cb17-6" tabindex="-1"></a></span>
<span id="cb17-7"><a href="#cb17-7" tabindex="-1"></a>trend_map <span class="sc">%&gt;%</span></span>
<span id="cb17-8"><a href="#cb17-8" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(trend) <span class="sc">%&gt;%</span></span>
<span id="cb17-9"><a href="#cb17-9" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">12</span>)</span>
<span id="cb17-10"><a href="#cb17-10" tabindex="-1"></a><span class="co">#&gt;    trend         series</span></span>
<span id="cb17-11"><a href="#cb17-11" tabindex="-1"></a><span class="co">#&gt; 1      1 site100_sp_1_1</span></span>
<span id="cb17-12"><a href="#cb17-12" tabindex="-1"></a><span class="co">#&gt; 2      1 site100_sp_1_2</span></span>
<span id="cb17-13"><a href="#cb17-13" tabindex="-1"></a><span class="co">#&gt; 3      1 site100_sp_1_3</span></span>
<span id="cb17-14"><a href="#cb17-14" tabindex="-1"></a><span class="co">#&gt; 4      2 site101_sp_1_1</span></span>
<span id="cb17-15"><a href="#cb17-15" tabindex="-1"></a><span class="co">#&gt; 5      2 site101_sp_1_2</span></span>
<span id="cb17-16"><a href="#cb17-16" tabindex="-1"></a><span class="co">#&gt; 6      2 site101_sp_1_3</span></span>
<span id="cb17-17"><a href="#cb17-17" tabindex="-1"></a><span class="co">#&gt; 7      3 site102_sp_1_1</span></span>
<span id="cb17-18"><a href="#cb17-18" tabindex="-1"></a><span class="co">#&gt; 8      3 site102_sp_1_2</span></span>
<span id="cb17-19"><a href="#cb17-19" tabindex="-1"></a><span class="co">#&gt; 9      3 site102_sp_1_3</span></span>
<span id="cb17-20"><a href="#cb17-20" tabindex="-1"></a><span class="co">#&gt; 10     4 site103_sp_1_1</span></span>
<span id="cb17-21"><a href="#cb17-21" tabindex="-1"></a><span class="co">#&gt; 11     4 site103_sp_1_2</span></span>
<span id="cb17-22"><a href="#cb17-22" tabindex="-1"></a><span class="co">#&gt; 12     4 site103_sp_1_3</span></span></code></pre></div>
<p>Now we are ready to fit a model using <code>mvgam()</code>. Here we
will use penalized splines for each of the continuous covariate effects
to detect possible nonlinear associations. We also showcase how
<code>mvgam</code> can make use of the different approximation
algorithms available in <code>Stan</code> by using the meanfield
variational Bayes approximator (this reduces computation time to around
12 seconds for this example)</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a>mod <span class="ot">&lt;-</span> <span class="fu">mvgam</span>(</span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a>  <span class="co"># effects of covariates on detection probability;</span></span>
<span id="cb18-3"><a href="#cb18-3" tabindex="-1"></a>  <span class="co"># here we use penalized splines for both continuous covariates</span></span>
<span id="cb18-4"><a href="#cb18-4" tabindex="-1"></a>  <span class="at">formula =</span> y <span class="sc">~</span> <span class="fu">s</span>(det_cov, <span class="at">k =</span> <span class="dv">4</span>) <span class="sc">+</span> <span class="fu">s</span>(det_cov2, <span class="at">k =</span> <span class="dv">4</span>),</span>
<span id="cb18-5"><a href="#cb18-5" tabindex="-1"></a>  </span>
<span id="cb18-6"><a href="#cb18-6" tabindex="-1"></a>  <span class="co"># effects of the covariates on latent abundance;</span></span>
<span id="cb18-7"><a href="#cb18-7" tabindex="-1"></a>  <span class="co"># here we use a penalized spline for the continuous covariate and</span></span>
<span id="cb18-8"><a href="#cb18-8" tabindex="-1"></a>  <span class="co"># hierarchical intercepts for the factor covariate</span></span>
<span id="cb18-9"><a href="#cb18-9" tabindex="-1"></a>  <span class="at">trend_formula =</span> <span class="sc">~</span> <span class="fu">s</span>(abund_cov, <span class="at">k =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb18-10"><a href="#cb18-10" tabindex="-1"></a>    <span class="fu">s</span>(abund_fac, <span class="at">bs =</span> <span class="st">&#39;re&#39;</span>),</span>
<span id="cb18-11"><a href="#cb18-11" tabindex="-1"></a>  </span>
<span id="cb18-12"><a href="#cb18-12" tabindex="-1"></a>  <span class="co"># link multiple observations to each site</span></span>
<span id="cb18-13"><a href="#cb18-13" tabindex="-1"></a>  <span class="at">trend_map =</span> trend_map,</span>
<span id="cb18-14"><a href="#cb18-14" tabindex="-1"></a>  </span>
<span id="cb18-15"><a href="#cb18-15" tabindex="-1"></a>  <span class="co"># nmix() family and supplied data</span></span>
<span id="cb18-16"><a href="#cb18-16" tabindex="-1"></a>  <span class="at">family =</span> <span class="fu">nmix</span>(),</span>
<span id="cb18-17"><a href="#cb18-17" tabindex="-1"></a>  <span class="at">data =</span> mod_data,</span>
<span id="cb18-18"><a href="#cb18-18" tabindex="-1"></a>  </span>
<span id="cb18-19"><a href="#cb18-19" tabindex="-1"></a>  <span class="co"># standard normal priors on key regression parameters</span></span>
<span id="cb18-20"><a href="#cb18-20" tabindex="-1"></a>  <span class="at">priors =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">std_normal</span>(), <span class="at">class =</span> <span class="st">&#39;b&#39;</span>),</span>
<span id="cb18-21"><a href="#cb18-21" tabindex="-1"></a>             <span class="fu">prior</span>(<span class="fu">std_normal</span>(), <span class="at">class =</span> <span class="st">&#39;Intercept&#39;</span>),</span>
<span id="cb18-22"><a href="#cb18-22" tabindex="-1"></a>             <span class="fu">prior</span>(<span class="fu">std_normal</span>(), <span class="at">class =</span> <span class="st">&#39;Intercept_trend&#39;</span>),</span>
<span id="cb18-23"><a href="#cb18-23" tabindex="-1"></a>             <span class="fu">prior</span>(<span class="fu">std_normal</span>(), <span class="at">class =</span> <span class="st">&#39;sigma_raw_trend&#39;</span>)),</span>
<span id="cb18-24"><a href="#cb18-24" tabindex="-1"></a>  </span>
<span id="cb18-25"><a href="#cb18-25" tabindex="-1"></a>  <span class="co"># use Stan&#39;s variational inference for quicker results</span></span>
<span id="cb18-26"><a href="#cb18-26" tabindex="-1"></a>  <span class="at">algorithm =</span> <span class="st">&#39;meanfield&#39;</span>,</span>
<span id="cb18-27"><a href="#cb18-27" tabindex="-1"></a>  </span>
<span id="cb18-28"><a href="#cb18-28" tabindex="-1"></a>  <span class="co"># no need to compute &quot;series-level&quot; residuals</span></span>
<span id="cb18-29"><a href="#cb18-29" tabindex="-1"></a>  <span class="at">residuals =</span> <span class="cn">FALSE</span>,</span>
<span id="cb18-30"><a href="#cb18-30" tabindex="-1"></a>  <span class="at">samples =</span> <span class="dv">1000</span>)</span></code></pre></div>
<p>Inspect the model summary but don’t bother looking at estimates for
all individual spline coefficients. Notice how we no longer receive
information on convergence because we did not use MCMC sampling for this
model</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="fu">summary</span>(mod, <span class="at">include_betas =</span> <span class="cn">FALSE</span>)</span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a><span class="co">#&gt; GAM observation formula:</span></span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a><span class="co">#&gt; y ~ s(det_cov, k = 3) + s(det_cov2, k = 3)</span></span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a><span class="co">#&gt; &lt;environment: 0x0000025edbcf4058&gt;</span></span>
<span id="cb19-5"><a href="#cb19-5" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb19-6"><a href="#cb19-6" tabindex="-1"></a><span class="co">#&gt; GAM process formula:</span></span>
<span id="cb19-7"><a href="#cb19-7" tabindex="-1"></a><span class="co">#&gt; ~s(abund_cov, k = 3) + s(abund_fac, bs = &quot;re&quot;)</span></span>
<span id="cb19-8"><a href="#cb19-8" tabindex="-1"></a><span class="co">#&gt; &lt;environment: 0x0000025edbcf4058&gt;</span></span>
<span id="cb19-9"><a href="#cb19-9" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb19-10"><a href="#cb19-10" tabindex="-1"></a><span class="co">#&gt; Family:</span></span>
<span id="cb19-11"><a href="#cb19-11" tabindex="-1"></a><span class="co">#&gt; nmix</span></span>
<span id="cb19-12"><a href="#cb19-12" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb19-13"><a href="#cb19-13" tabindex="-1"></a><span class="co">#&gt; Link function:</span></span>
<span id="cb19-14"><a href="#cb19-14" tabindex="-1"></a><span class="co">#&gt; log</span></span>
<span id="cb19-15"><a href="#cb19-15" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb19-16"><a href="#cb19-16" tabindex="-1"></a><span class="co">#&gt; Trend model:</span></span>
<span id="cb19-17"><a href="#cb19-17" tabindex="-1"></a><span class="co">#&gt; None</span></span>
<span id="cb19-18"><a href="#cb19-18" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb19-19"><a href="#cb19-19" tabindex="-1"></a><span class="co">#&gt; N process models:</span></span>
<span id="cb19-20"><a href="#cb19-20" tabindex="-1"></a><span class="co">#&gt; 225 </span></span>
<span id="cb19-21"><a href="#cb19-21" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb19-22"><a href="#cb19-22" tabindex="-1"></a><span class="co">#&gt; N series:</span></span>
<span id="cb19-23"><a href="#cb19-23" tabindex="-1"></a><span class="co">#&gt; 675 </span></span>
<span id="cb19-24"><a href="#cb19-24" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb19-25"><a href="#cb19-25" tabindex="-1"></a><span class="co">#&gt; N timepoints:</span></span>
<span id="cb19-26"><a href="#cb19-26" tabindex="-1"></a><span class="co">#&gt; 1 </span></span>
<span id="cb19-27"><a href="#cb19-27" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb19-28"><a href="#cb19-28" tabindex="-1"></a><span class="co">#&gt; Status:</span></span>
<span id="cb19-29"><a href="#cb19-29" tabindex="-1"></a><span class="co">#&gt; Fitted using Stan </span></span>
<span id="cb19-30"><a href="#cb19-30" tabindex="-1"></a><span class="co">#&gt; 1 chains, each with iter = 1000; warmup = ; thin = 1 </span></span>
<span id="cb19-31"><a href="#cb19-31" tabindex="-1"></a><span class="co">#&gt; Total post-warmup draws = 1000</span></span>
<span id="cb19-32"><a href="#cb19-32" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb19-33"><a href="#cb19-33" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb19-34"><a href="#cb19-34" tabindex="-1"></a><span class="co">#&gt; GAM observation model coefficient (beta) estimates:</span></span>
<span id="cb19-35"><a href="#cb19-35" tabindex="-1"></a><span class="co">#&gt;              2.5%  50% 97.5% Rhat n.eff</span></span>
<span id="cb19-36"><a href="#cb19-36" tabindex="-1"></a><span class="co">#&gt; (Intercept) 0.066 0.38  0.68  NaN   NaN</span></span>
<span id="cb19-37"><a href="#cb19-37" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb19-38"><a href="#cb19-38" tabindex="-1"></a><span class="co">#&gt; Approximate significance of GAM observation smooths:</span></span>
<span id="cb19-39"><a href="#cb19-39" tabindex="-1"></a><span class="co">#&gt;              edf Ref.df Chi.sq p-value    </span></span>
<span id="cb19-40"><a href="#cb19-40" tabindex="-1"></a><span class="co">#&gt; s(det_cov)  1.20      2    155 1.8e-05 ***</span></span>
<span id="cb19-41"><a href="#cb19-41" tabindex="-1"></a><span class="co">#&gt; s(det_cov2) 1.05      2    606 &lt; 2e-16 ***</span></span>
<span id="cb19-42"><a href="#cb19-42" tabindex="-1"></a><span class="co">#&gt; ---</span></span>
<span id="cb19-43"><a href="#cb19-43" tabindex="-1"></a><span class="co">#&gt; Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></span>
<span id="cb19-44"><a href="#cb19-44" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb19-45"><a href="#cb19-45" tabindex="-1"></a><span class="co">#&gt; GAM process model coefficient (beta) estimates:</span></span>
<span id="cb19-46"><a href="#cb19-46" tabindex="-1"></a><span class="co">#&gt;                   2.5%  50% 97.5% Rhat n.eff</span></span>
<span id="cb19-47"><a href="#cb19-47" tabindex="-1"></a><span class="co">#&gt; (Intercept)_trend 0.14 0.28  0.42  NaN   NaN</span></span>
<span id="cb19-48"><a href="#cb19-48" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb19-49"><a href="#cb19-49" tabindex="-1"></a><span class="co">#&gt; GAM process model group-level estimates:</span></span>
<span id="cb19-50"><a href="#cb19-50" tabindex="-1"></a><span class="co">#&gt;                           2.5%   50% 97.5% Rhat n.eff</span></span>
<span id="cb19-51"><a href="#cb19-51" tabindex="-1"></a><span class="co">#&gt; mean(s(abund_fac))_trend -0.65 -0.52 -0.37  NaN   NaN</span></span>
<span id="cb19-52"><a href="#cb19-52" tabindex="-1"></a><span class="co">#&gt; sd(s(abund_fac))_trend    0.28  0.41  0.64  NaN   NaN</span></span>
<span id="cb19-53"><a href="#cb19-53" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb19-54"><a href="#cb19-54" tabindex="-1"></a><span class="co">#&gt; Approximate significance of GAM process smooths:</span></span>
<span id="cb19-55"><a href="#cb19-55" tabindex="-1"></a><span class="co">#&gt;               edf Ref.df Chi.sq p-value    </span></span>
<span id="cb19-56"><a href="#cb19-56" tabindex="-1"></a><span class="co">#&gt; s(abund_cov) 1.08      2   1.13 0.21268    </span></span>
<span id="cb19-57"><a href="#cb19-57" tabindex="-1"></a><span class="co">#&gt; s(abund_fac) 8.84     10  30.62 0.00034 ***</span></span>
<span id="cb19-58"><a href="#cb19-58" tabindex="-1"></a><span class="co">#&gt; ---</span></span>
<span id="cb19-59"><a href="#cb19-59" tabindex="-1"></a><span class="co">#&gt; Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></span>
<span id="cb19-60"><a href="#cb19-60" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb19-61"><a href="#cb19-61" tabindex="-1"></a><span class="co">#&gt; Posterior approximation used: no diagnostics to compute</span></span></code></pre></div>
<p>Again we can make use of <code>marginaleffects</code> support for
interrogating the model through targeted predictions. First, we can
inspect the estimated average detection probability</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a>marginaleffects<span class="sc">::</span><span class="fu">avg_predictions</span>(mod, <span class="at">type =</span> <span class="st">&#39;detection&#39;</span>)</span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb20-3"><a href="#cb20-3" tabindex="-1"></a><span class="co">#&gt;  Estimate 2.5 % 97.5 %</span></span>
<span id="cb20-4"><a href="#cb20-4" tabindex="-1"></a><span class="co">#&gt;     0.576 0.512  0.634</span></span>
<span id="cb20-5"><a href="#cb20-5" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb20-6"><a href="#cb20-6" tabindex="-1"></a><span class="co">#&gt; Columns: estimate, conf.low, conf.high </span></span>
<span id="cb20-7"><a href="#cb20-7" tabindex="-1"></a><span class="co">#&gt; Type:  detection</span></span></code></pre></div>
<p>Next investigate estimated effects of covariates on latent abundance
using the <code>conditional_effects()</code> function and specifying
<code>type = &#39;link&#39;</code>; this will return plots on the expectation
scale</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a>abund_plots <span class="ot">&lt;-</span> <span class="fu">plot</span>(<span class="fu">conditional_effects</span>(mod,</span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a>                                        <span class="at">type =</span> <span class="st">&#39;link&#39;</span>,</span>
<span id="cb21-3"><a href="#cb21-3" tabindex="-1"></a>                                        <span class="at">effects =</span> <span class="fu">c</span>(<span class="st">&#39;abund_cov&#39;</span>,</span>
<span id="cb21-4"><a href="#cb21-4" tabindex="-1"></a>                                                    <span class="st">&#39;abund_fac&#39;</span>)),</span>
<span id="cb21-5"><a href="#cb21-5" tabindex="-1"></a>                    <span class="at">plot =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p>The effect of the continuous covariate on expected latent
abundance</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a>abund_plots[[<span class="dv">1</span>]] <span class="sc">+</span></span>
<span id="cb22-2"><a href="#cb22-2" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&#39;Expected latent abundance&#39;</span>)</span></code></pre></div>
<p><img src="data:image/png;base64,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" width="60%" style="display: block; margin: auto;" /></p>
<p>The effect of the factor covariate on expected latent abundance,
estimated as a hierarchical random effect</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a>abund_plots[[<span class="dv">2</span>]] <span class="sc">+</span></span>
<span id="cb23-2"><a href="#cb23-2" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&#39;Expected latent abundance&#39;</span>)</span></code></pre></div>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAlgAAAHgCAMAAABOyeNrAAAAyVBMVEUAAAAAADoAAGYAOpAAZrYzMzM6AAA6ADo6AGY6kNtNTU1NTW5NTY5NbqtNjshmAABmADpmZrZmtrZmtv9uTU1uTW5uTY5ubo5ubqtuq8huq+SOTU2OTW6OTY6Obk2ObquOyP+QOgCQOmaQkGaQtpCQ27aQ2/+rbk2rbm6rbo6rjk2ryKur5OSr5P+2ZgC2Zma2///Ijk3I///bkDrb2//b/7bb///kq27k////tmb/yI7/25D/29v/5Kv//7b//8j//9v//+T///+5S6TPAAAACXBIWXMAAA9hAAAPYQGoP6dpAAAQw0lEQVR4nO2dDV/byBGHzeXlGieEa0nSNCQtadqQ6xUaoBfeaoz9/T9UJdlyMI4t7WhnNZ59nl9zQOE/Wo0eJHkticEUQIFB3wMAnyAWqIBYoAJigQqIBSogFqggEAsXoRnEAhUQC1RALFABsUAFxAIVEAtUQCxQAbFABcQCFRALVEAsUAGxQAXEAhUQC1RALFABsUAFxAIVEAtUQCxQAbGs4aS9iGUNJ+1FLGs4aS9iWcNJexHLGk7ai1jWcNJexLKGk/YiljWctBexrOGkvYhlDSftRSxrOGkvYlnDSXsRyxpO2otY1nDSXsSyhpP2IpY1nLQXsazhpL2IZQ0n7UUsazhpL2JZw0l7EcsaTtqLWNZw0l7EsoaT9iKWNZy0F7Gs4aS9iGUNJ+3dtBqjV8PhYfXZ+GC4e9kmAp1x0t4NqzF+fzwdvT4uPpscHU4vXraIQHectHfDalyXKp2Wu6zxh7Pp6M1ZcwS646S9DatR7rWKY+Lby/lnTwqcrLlVnLR382pMjt6VH653a7GaI9ARJ+3duBrjg8qre3usxgh0xUl7N78qnL0m5BwrJU7au2E1Fl5VR0ReFSbCSXs3rMbFsOSw3FUxj5UOJ+1l5t0aTtqLWNZw0l7EsoaT9iKWNZy0F7Gs4aS9iGUNJ+1FLGs4aS9iWcNJexHLGk7ai1jWcNJexLKGk/YiljWctBexrOGkvYhlDSftRSxrOGkvYlnDSXsRyxpO2otY1nDSXsSyhpP2IpY1nLQXsazhpL2IZQ0n7UUsazhpL2JZw0l7EcsaTtqLWNZw0l7EsoaT9iKWNZy0F7Gs4aS9iGUNJ+1FLGs4aS9iWcNJexFLD1mjnLQXsfRALPVIniCWeiRPEEs9kieIpR7JE8RSj+QJYqlH8gSx1CN5gljqkTxBLPVIniCWeiRPEEs9kieIpR7JE8RSj+QJYqlH8gSx1CN5gljqkTxBLPVIniCWeiRPEEs9kieIpR7JE8RSj+QJYqlH8gSx1CN5gljqkTxBLPVIniCWeiRPEEs9kieIpR7JE8RSj+QJYqlH8gSx1CN5gljqkTxBLPVIniCWeiRPEEs9kieIpR7JE8RSj+QJYqlH8gSxFpwPBvvnj76FRGAtiFVz8uj3vf27j48DIrAexJpzu7df/G969dPX1hHYAGLNQay4IFbNeXkovN17FhCB9SDWgqtBQYNXXtZcH8RSj+QJYqlH8gSxau4+Pps2zjZ4WXN9EKvmpHSKeaxYINaccq6hgOmGSCDWHMSKC2LVnJdKMY8VC8RawDxWTBBLPZIniKUeyRPEqrl5Wh4KB99P3kdvzqqPF8Ph8MXZjyKwHsSaszKDdV3bdHq4JpILonVGrDnz6YYFp89/m+2xJl+O10RyAbFCWd5j7T/47vxQOD4oDoXVTutJgZM1DwKxQllajZWp0blYo9fH9/ZaTtY8CMQKZflQOFhz8l6yOM9ysuZBIFYom1cDseYgViitxLrevZxOfs15ugGxQmmexyr/XQyHz49/GMkExApl+VXhs+KF4cNJh42RXECsUB7OY508m1413ArtZM2DQKxQHop1/pjrsX4AYoXy8NLkwqqmhzc4WfMgECuUlZspTgY7nwMimYBYoXDZTCsQKxTEaoVLsVSXtChev5+zNI+VfjxGQaxOxec3UzCPtQJidSnO7V9rQawuxRFrLYjVqTj3Fa4DsboVr+4rbDjFQizVkE+xtCJbD2IlKI5YmiGXYq1cj5V+PEZBrC7Fm5+5thLJBcTqUrxxanQ1kguI1aX46n2FjZFcQKxOxZumRn8QyQTrYiUcn6D46n2F6cdjFMRKUFxlPMZtRawExRFLM+RRrD4PhYiVflGJ91i3v/RxzTtipV9U6kNhL/cVIlb6RSUXi0PhCogVofgJe6wVEKtL8fnJey/3FSJW+kUx3dA/iJWgOGJphnyK1d+lyYiVflHpxOrxZgrESr+o1NdjMd2wCmJ1KY5Ya0GsTsWv+rvFHrHSLyqNWD0/FASx0i+K6Yb+QawExRFLM+RSrB7vK0SsOuRQrD6f855OLNMbbnaSm2RRiacb+nrOO2LNIm7F6us574hVJQZCs2yL1edz3hGrSjgVq8fnvCPWLOLyUKgX6alovCUhVoLiiKUaMj4+xeKIpRkyPz694oilGTI/Pr3iiKUZMj8+QfE8rseyvuGsj09QHLEMhMyPL7j4+eJ6rIYnkSKWZsj8+ATF+3wGKWKlXxQn7/0vCbE6Fc/ieizrG876+ATF+3zOO2KlXxTnWP0vCbG6FO/zOe+IlX5R6c6xenzOO2KlX1TCQ2EO9xVa33DWx6dXHLE0Q+bHp1ccsTRD5scnKn4+GOw3XfKOWKoh8+OTFD959PvefuNsFmJphsyPT1D8dq+6W5WrG/oMmR+foDhiGQiZH5+k+Hl5KPT+qEjrG876+ETFq4fbNniFWKoh8+PTK45YmiHz4xMU59JkAyHz4xMURywDIfPjCy7ONe8mQubHJyjO9VgGQubHp1ccsTRD5scnKc417zFDssd7eBSLZ5BGDEkfSORRLJ5BGjGEWN/hGaTxQuKHPnoUi2eQxgsh1v0veAZpvBCHwhSRnorGWxJiJSiOWC0zTDeUZPNn5axvOOvj0yuOWJoh8+PTK45YmiHz49MrbkcsjyHz49MrjliaIfPj0yuOWJoh8+OLUnz05qz6OD4Y7l6qjsd4OxFLXPxH0w3XwxeVWJOjw+nFS9XxGG8nYnUqfl4q9f2ymdPnv832WOMPZ4udF2LphsyPT1B89WaKuU2jt5fT8fvj4rMnBYilGTI/PkHxtWJd79ZiqY3HeDsRq1Px+aHw+63QK3sstfHYbmfCPyJovBPC4tUt9veuTB5xjlUmUl5ZZboT0YrPbZocvcv5VSFiRS9eilX+y3oeK+2flrfcCXnxLXtUJGKlD4mKb9ujIjkUpg9Jim/dE/0QK31IUhyx1maYbuhUfNseFekxZH58ouJb9qhIjyHz49Mr3hQx3hnjIfPjExSP9EQ/450xHjI/PkFxxDIQMj++4OLRHhVpvDPGQ+bHJyge6VGRxjtjPGR+fHrFEUszZH1yrnX1+1+UT5tp/lP2iKUZsv52Quv69784KZ3q/F6h8S1nPORRLF4VGgglWpT8wXBtF3Dv8x7FSvhmnPGQR7FWr3lvjgi+/4OEz6cqWhYr7TlWnPcKEatLKNUOP61YUSLpdsvGHUkllrR77uexEKtbKu2FiKLiUa55N94Z4yHrv5ei4nGueUesLiGPYkW6NJnphi4h67+XkuI9ikWoQ8q8WJGueTe+5YyHrO/wZcV7msci1Mui3E83EOpnUYiVU8j8+ETFq8uTmy4jRSzNkPnxSYr39SY0oV4WlXK6ofzAdEOfIRn2xodYxkIy7I1vqfhV+cdVORT2GpJhb3zLe6zFrYWbdlqIpRmSYW98TDcYC8mwN777xe/+GxyRfJ9QfOyNb/lQWJ1d3f2dk/f+QjLsjW/55H3w6FvxH14V9hiSYW98y8Wr03fuhO4zJMPe+B4Uv3naeHEDYqmGZNgb31Lxu4+Dx9XhsNN4jG854yEZ9sa3fPI+myDlHKvHkAx741sS64+zj//xLJb1q+tl2BtfZhOk9u8HkmFvfIvi1TvQ1fvPnt+ERqyuoeDiWYi1Bfdcy7A3PsTSWZI4JMPe+PISi0Nh51BwccSKuyRpSIa98WUmFtMNXUPBxXMRy3pIhr3x3ROr1eWjLcZjfMsZD8mwN77MJkjth2TYGx9iGQvJsDc+xNILJcTeSiGWXigh9lYKsfRCCbG3UoilF0qIvZXaZrF8znWKsLdS2yuW13dnRNhbKcTSCyXE3kptrVg2n27eF/ZOChDLBYgVL2Ty6eZ9gVjxQoh1D8SKGTL42Py+QKwtDVnHXvsQywX22odYLrDXPsRygb32IZYL7LUPsVxgr32I5QJ77UMsF9hrH2K5wF77EMsF9tqHWC6w1z7EcoG99iGWC+y1D7FcYK99iJUviNV/CGq2TSwRiJUexIoagpr+xJJdMCwCsdLTl1jSWxxEIFZ6ECtqCGp6Ekt8G6kIxEpPDLHGB8Pdy+qzi+Fw+OKsRQSxvBNBrMnR4fTiZfXp6WHb0hwKnRNBrPGHs+noTbmfmnw5blsasZwTQazR28vp+H2pVHFMHA6rndaTAqYbciaCWNe7tVij18f39lpMkOZM1D1WxeI8C7FyJuo5VgViwTTSq8J381eF5UFx8mub6YaQRXcHsdITbx6r3GldDIfPj9tEQhbdHcRKD1c3RA1BDWJFDUENYkUNQQ1iRQ1BDWJFDUENYkUNQQ1iRQ1BDWJFDUENYoEKiAUqIBaogFigAmKBCogFKiAWqIBYoEIWYkF6EAtUQCxQAbFAg9a3IyMWtCfgAQqIBe1BLNAg5CFViAWtQSzQgUMhqIBYoATTDaADYoEKiAUqIBaogFigAmKBCogFKiAWqIBYoAJigQqIBSogFqiAWKACYoEKPYoFnkEsUAGxQAXEAhUQC1RALFABsUAFxAIVEAtUQCxQAbFABcQCFRALVEAsUAGxQAXEAhUQC1RALFABsUAFxAIVEAt6BbFABcQCFRALVEAsUAGxQAXEAhUQC1RALFABsUAFxAIVEAtUQCxQAbFABcQCFRALVEAsUAGxQAXEAhUkYjXwpOkHCNlYlEqog1hNPCHUIWR9fG1DiGUsZH18iLWlIevj61EsAMQCJRALVEAsUAGxQIX4Yo3enAVHXg2Hh6Gh6+HwRfCSptPJUfCSLoaCRU2Ohs+PJUsKb0XRvvBOSELVph0fDHcvm382uljX4eMdvz+ejl4HboVyJS9eBi5pWm67YLFOgxOz0HWbDbBCcKps30Vw6OAwOFRt2vIXs03fY4t1+vy34D3WdTlOydaT7Bz//NfQBU2+BO95ig33QbA3rYLvQ5c2ensZvrgqFLao2aYtl9Sm7yYOhVNJPwvC91iTL/8OPhQW+37B4entvwSHwqlknUR7LIFYs03bNmhErMnRu/AFvRKcxLwLP8cqj9LBe63Rq8NqG4Qi+QVredbzIFMc0UL7V27a8ki9PWKND8K9mgq2QrGpBSfvJaFHatEeYSo4w5qJfx1+Iv5q+Jfg35Zt22OVv94iQjf37FWXROLQJY3/JhPrNHxwbfchK4SfmG3ZOZbIK2k7w/dY5ZImv4au1KnoUCh5oSDaY1UnZqGnc+WmLU9a+nhVKBFLNntTpCRnx7J5rPAlFSc+gmk20Z7nWjK+IhR81O11HgugBLFABcQCFRALVEAsUAGxQAXEAhUQqx03P39e/82rn74uPj8f7Gz4yXxArHa0Fet2bz/FcOyDWO1oK9bGn8sJxGrg5ulgMHhWCPNpMHj0bSZO8Z+bn/9RfGO/3EUNdj4txCp/+nGdmd59LL/KE8TaTHVoO//p683TR9/uPj7+Llbxdfn/3+49K35meY9VZ8qfz/bQiFib+d+36Vyk/fme6vPS19VR8HxZrEUm58MiYjVxVRzWdj7f/OFrtfv6fiicfTwvdlzT6pszZjLNMvdfLGYHYm3mdm/ncyVSgFh1BrFgLVelOFc7nx8KVX+s5HnwqnApkyuItZmrcufzdOdzffJenqzfffwu2u3e45WT9zpT/nz5L0sQq4GT4mzpn+Uh8NNs6qCcSvjTLwuxHkw3zM6x5hmmGwBig1igAmJFoZprr+YY+h6JFRALVEAsUAGxQAXEAhUQC1RALFABsUCF/wO1uvb2lpkVegAAAABJRU5ErkJggg==" width="60%" style="display: block; margin: auto;" /></p>
<p>Now we can investigate estimated effects of covariates on detection
probability using <code>type = &#39;detection&#39;</code></p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a>det_plots <span class="ot">&lt;-</span> <span class="fu">plot</span>(<span class="fu">conditional_effects</span>(mod,</span>
<span id="cb24-2"><a href="#cb24-2" tabindex="-1"></a>                                      <span class="at">type =</span> <span class="st">&#39;detection&#39;</span>,</span>
<span id="cb24-3"><a href="#cb24-3" tabindex="-1"></a>                                      <span class="at">effects =</span> <span class="fu">c</span>(<span class="st">&#39;det_cov&#39;</span>,</span>
<span id="cb24-4"><a href="#cb24-4" tabindex="-1"></a>                                                  <span class="st">&#39;det_cov2&#39;</span>)),</span>
<span id="cb24-5"><a href="#cb24-5" tabindex="-1"></a>                  <span class="at">plot =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p>The covariate smooths were estimated to be somewhat nonlinear on the
logit scale according to the model summary (based on their approximate
significances). But inspecting conditional effects of each covariate on
the probability scale is more intuitive and useful</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a>det_plots[[<span class="dv">1</span>]] <span class="sc">+</span></span>
<span id="cb25-2"><a href="#cb25-2" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&#39;Pr(detection)&#39;</span>)</span></code></pre></div>
<p><img src="data:image/png;base64,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" width="60%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a>det_plots[[<span class="dv">2</span>]] <span class="sc">+</span></span>
<span id="cb26-2"><a href="#cb26-2" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&#39;Pr(detection)&#39;</span>)</span></code></pre></div>
<p><img src="data:image/png;base64,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" width="60%" style="display: block; margin: auto;" /></p>
<p>More targeted predictions are also easy with
<code>marginaleffects</code> support. For example, we can ask: How does
detection probability change as we change <em>both</em> detection
covariates?</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a>fivenum_round <span class="ot">=</span> <span class="cf">function</span>(x)<span class="fu">round</span>(<span class="fu">fivenum</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="dv">2</span>)</span>
<span id="cb27-2"><a href="#cb27-2" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" tabindex="-1"></a>marginaleffects<span class="sc">::</span><span class="fu">plot_predictions</span>(mod, </span>
<span id="cb27-4"><a href="#cb27-4" tabindex="-1"></a>                 <span class="at">newdata =</span> marginaleffects<span class="sc">::</span><span class="fu">datagrid</span>(<span class="at">det_cov =</span> unique,</span>
<span id="cb27-5"><a href="#cb27-5" tabindex="-1"></a>                                    <span class="at">det_cov2 =</span> fivenum_round),</span>
<span id="cb27-6"><a href="#cb27-6" tabindex="-1"></a>                 <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&#39;det_cov&#39;</span>, <span class="st">&#39;det_cov2&#39;</span>),</span>
<span id="cb27-7"><a href="#cb27-7" tabindex="-1"></a>                 <span class="at">type =</span> <span class="st">&#39;detection&#39;</span>) <span class="sc">+</span></span>
<span id="cb27-8"><a href="#cb27-8" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb27-9"><a href="#cb27-9" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&#39;Pr(detection)&#39;</span>)</span></code></pre></div>
<p><img src="data:image/png;base64,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" width="60%" style="display: block; margin: auto;" /></p>
<p>The model has found support for some important covariate effects, but
of course we’d want to interrogate how well the model predicts and think
about possible spatial effects to capture unmodelled variation in latent
abundance (which can easily be incorporated into both linear predictors
using spatial smooths).</p>
</div>
<div id="further-reading" class="section level2">
<h2>Further reading</h2>
<p>The following papers and resources offer useful material about
N-mixture models for ecological population dynamics investigations:</p>
<p>Guélat, Jérôme, and Kéry, Marc. “<a href="https://besjournals.onlinelibrary.wiley.com/doi/full/10.1111/2041-210X.12983">Effects
of Spatial Autocorrelation and Imperfect Detection on Species
Distribution Models.</a>” <em>Methods in Ecology and Evolution</em> 9
(2018): 1614–25.</p>
<p>Kéry, Marc, and Royle Andrew J. “<a href="https://shop.elsevier.com/books/applied-hierarchical-modeling-in-ecology-analysis-of-distribution-abundance-and-species-richness-in-r-and-bugs/kery/978-0-12-809585-0">Applied
hierarchical modeling in ecology: Analysis of distribution, abundance
and species richness in R and BUGS: Volume 2: Dynamic and advanced
models</a>”. London, UK: Academic Press (2020).</p>
<p>Royle, Andrew J. “<a href="https://onlinelibrary.wiley.com/doi/full/10.1111/j.0006-341X.2004.00142.x">N‐mixture
models for estimating population size from spatially replicated
counts.</a>” <em>Biometrics</em> 60.1 (2004): 108-115.</p>
</div>
<div id="interested-in-contributing" class="section level2">
<h2>Interested in contributing?</h2>
<p>I’m actively seeking PhD students and other researchers to work in
the areas of ecological forecasting, multivariate model evaluation and
development of <code>mvgam</code>. Please reach out if you are
interested (n.clark’at’uq.edu.au)</p>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
